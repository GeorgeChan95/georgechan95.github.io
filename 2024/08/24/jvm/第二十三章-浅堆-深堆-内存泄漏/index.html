<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>第二十三章-浅堆-深堆-内存泄漏 | George&#39;s Blog</title>
  <meta name="google-site-verification" content="RobLWkyyFziZxPJ4I887QROdX8XrYthcJwWTcuH0wwQ" />
  <meta name="msvalidate.01" content="626D541C48E5D151F52CECC2C6714BD4" />
  <meta name="360-site-verification" content="c838adf8357ca2f614d08ad5235a1717" />
  <meta name="keywords" content=" jvm , java ">
  <meta name="description" content="第二十三章-浅堆-深堆-内存泄漏 | George&#39;s Blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="个人简介目前人在合肥，从事后端开发工作。 联系方式 邮箱：&#103;&#101;&#111;&#114;&#x67;&#x65;&#x5f;&#57;&#x35;&#x40;&#x31;&#50;&#x36;&#x2e;&#99;&#x6f;&#x6d;  邮件可能几天才看一次，如有联系，请耐心等待。">
<meta property="og:type" content="website">
<meta property="og:title" content="关于">
<meta property="og:url" content="https://georgechan95.github.io/about/index.html">
<meta property="og:site_name" content="George&#39;s Blog">
<meta property="og:description" content="个人简介目前人在合肥，从事后端开发工作。 联系方式 邮箱：&#103;&#101;&#111;&#114;&#x67;&#x65;&#x5f;&#57;&#x35;&#x40;&#x31;&#50;&#x36;&#x2e;&#99;&#x6f;&#x6d;  邮件可能几天才看一次，如有联系，请耐心等待。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-11-21T02:29:45.000Z">
<meta property="article:modified_time" content="2024-06-22T10:36:12.823Z">
<meta property="article:author" content="George">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/favicon.png">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/sublime.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="George's Blog" type="application/atom+xml">
</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>George</span>
</div>

<div class="icon">
    
        
            <a title="rss"
               href="/atom.xml"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-rss"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="github"
               href="https://github.com/GeorgeChan95"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <a title="email"
               href="mailto:george_95@126.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(35)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="算法">
            
            算法
            <small>(5)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Hexo">
            <i class="fold iconfont icon-right"></i>
            Hexo
            <small>(5)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Hexo&lt;---&gt;Typora">
            
            Typora
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JVM">
            
            JVM
            <small>(24)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="linux">
            
            linux
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  site_url"
               
               href="/about">关于</a>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="35">
<input type="hidden" id="yelog_site_word_count" value="189.5k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>插入排序</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>二分法</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>二进制</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>合并有序链表</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>链表</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>冒泡排序</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>双亲委派机制</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>算法</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>位运算</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>选择排序</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>github</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>github pages</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hexo</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jenkins</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jvm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>sitemap</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>typora</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="全部文章 JVM "
           href="/2024/08/24/jvm/%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%89%E7%AB%A0-%E6%B5%85%E5%A0%86-%E6%B7%B1%E5%A0%86-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第二十三章-浅堆-深堆-内存泄漏">第二十三章-浅堆-深堆-内存泄漏</span>
            <span class="post-date" title="2024-08-24 13:04:37">2024/08/24</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/08/16/jvm/%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%89%E7%AB%A0-JVM%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7-GUI%E7%AF%87/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第二十三章-JVM监控及诊断工具-GUI篇">第二十三章-JVM监控及诊断工具-GUI篇</span>
            <span class="post-date" title="2024-08-16 21:00:00">2024/08/16</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/08/12/jvm/%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%BA%8C%E7%AB%A0-JVM%E7%9B%91%E6%8E%A7%E5%8F%8A%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7-%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AF%87/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第二十二章-JVM监控及诊断工具-命令行篇">第二十二章-JVM监控及诊断工具-命令行篇</span>
            <span class="post-date" title="2024-08-12 19:36:32">2024/08/12</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/08/12/jvm/%E7%AC%AC%E4%BA%8C%E5%8D%81%E4%B8%80%E7%AB%A0-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%B0%83%E4%BC%98%E6%A6%82%E8%BF%B0/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第二十一章-性能监控与调优概述">第二十一章-性能监控与调优概述</span>
            <span class="post-date" title="2024-08-12 19:13:06">2024/08/12</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/08/10/jvm/%E7%AC%AC%E4%BA%8C%E5%8D%81%E7%AB%A0-%E5%86%8D%E8%B0%88%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%99%A8/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第二十章-再谈类的加载器">第二十章-再谈类的加载器</span>
            <span class="post-date" title="2024-08-10 13:43:10">2024/08/10</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/08/02/jvm/%E7%AC%AC%E5%8D%81%E4%B9%9D%E7%AB%A0-%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十九章-类的加载过程详解">第十九章-类的加载过程详解</span>
            <span class="post-date" title="2024-08-02 19:33:27">2024/08/02</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/08/01/jvm/%E7%AC%AC%E5%8D%81%E5%85%AB%E7%AB%A0-%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E9%9B%86%E4%B8%8E%E8%A7%A3%E6%9E%90%E4%B8%BE%E4%BE%8B/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十八章-字节码指令集与解析指令">第十八章-字节码指令集与解析指令</span>
            <span class="post-date" title="2024-08-01 01:40:02">2024/08/01</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/07/22/jvm/%E7%AC%AC%E5%8D%81%E4%B8%83%E7%AB%A0-%E4%BD%BF%E7%94%A8javap%E6%8C%87%E4%BB%A4%E8%A7%A3%E6%9E%90class%E6%96%87%E4%BB%B6/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十七章-使用javap指令解析class文件">第十七章-使用javap指令解析class文件</span>
            <span class="post-date" title="2024-07-22 23:54:00">2024/07/22</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/07/15/jvm/%E7%AC%AC%E5%8D%81%E5%85%AD%E7%AB%A0-Class%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十六章-Class文件结构">第十六章-Class文件结构</span>
            <span class="post-date" title="2024-07-15 19:54:50">2024/07/15</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/07/13/jvm/%E7%AC%AC%E5%8D%81%E4%BA%94%E7%AB%A0-GC%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十五章-GC日志分析">第十五章-GC日志分析</span>
            <span class="post-date" title="2024-07-13 08:34:00">2024/07/13</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/07/10/jvm/%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十四章-垃圾收集器">第十四章-垃圾收集器</span>
            <span class="post-date" title="2024-07-10 19:27:00">2024/07/10</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/2024/07/06/algorithm/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/"
           data-tag="算法,合并有序链表"
           data-author="" >
            <span class="post-title" title="合并两个有序链表">合并两个有序链表</span>
            <span class="post-date" title="2024-07-06 09:11:00">2024/07/06</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/2024/07/05/algorithm/%E9%93%BE%E8%A1%A8%E5%8F%8D%E8%BD%AC/"
           data-tag="算法,链表"
           data-author="" >
            <span class="post-title" title="链表反转">链表反转</span>
            <span class="post-date" title="2024-07-05 19:45:45">2024/07/05</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/2024/07/03/algorithm/%E9%80%89%E6%8B%A9-%E5%86%92%E6%B3%A1-%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/"
           data-tag="算法,选择排序,冒泡排序,插入排序"
           data-author="" >
            <span class="post-title" title="选择-冒泡-插入排序">选择-冒泡-插入排序</span>
            <span class="post-date" title="2024-07-03 11:02:16">2024/07/03</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/2024/06/29/algorithm/%E4%BA%8C%E5%88%86%E6%90%9C%E7%B4%A2/"
           data-tag="算法,二分法"
           data-author="" >
            <span class="post-title" title="二分搜索">二分搜索</span>
            <span class="post-date" title="2024-06-29 10:04:10">2024/06/29</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/2024/06/20/algorithm/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%92%8C%E4%BD%8D%E8%BF%90%E7%AE%97/"
           data-tag="算法,二进制,位运算"
           data-author="" >
            <span class="post-title" title="二进制和位运算">二进制和位运算</span>
            <span class="post-date" title="2024-06-20 08:04:00">2024/06/20</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/01/14/jvm/%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十三章-垃圾回收相关概念">第十三章-垃圾回收相关概念</span>
            <span class="post-date" title="2024-01-14 14:27:00">2024/01/14</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2024/01/06/jvm/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%A6%82%E8%BF%B0/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十二章-垃圾回收概述和相关算法">第十二章-垃圾回收概述和相关算法</span>
            <span class="post-date" title="2024-01-06 16:28:00">2024/01/06</span>
        </a>
        
        
        <a  class="全部文章 linux "
           href="/2024/01/05/linux/Jenkins%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"
           data-tag="linux,jenkins"
           data-author="" >
            <span class="post-title" title="Jenkins的安装和搭建自动化部署平台">Jenkins的安装和搭建自动化部署平台</span>
            <span class="post-date" title="2024-01-05 16:00:00">2024/01/05</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/12/25/jvm/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0-StringTable/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十一章-StringTable(字符串常量池)">第十一章-StringTable(字符串常量池)</span>
            <span class="post-date" title="2023-12-25 17:27:06">2023/12/25</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/12/23/jvm/%E7%AC%AC%E5%8D%81%E7%AB%A0-%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第十章-执行引擎">第十章-执行引擎</span>
            <span class="post-date" title="2023-12-23 20:03:00">2023/12/23</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/12/21/jvm/%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80%E4%B8%8E%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第九章-对象的实例化内存布局与访问定位">第九章-对象的实例化内存布局与访问定位</span>
            <span class="post-date" title="2023-12-21 11:50:00">2023/12/21</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/12/20/jvm/%E7%AC%AC%E5%85%AB%E7%AB%A0-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第八章-直接内存">第八章-直接内存</span>
            <span class="post-date" title="2023-12-20 17:03:00">2023/12/20</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/12/14/jvm/%E7%AC%AC%E4%B8%83%E7%AB%A0-%E6%96%B9%E6%B3%95%E5%8C%BA/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第七章-方法区">第七章-方法区</span>
            <span class="post-date" title="2023-12-14 18:24:00">2023/12/14</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/12/02/jvm/%E7%AC%AC%E5%85%AD%E7%AB%A0-JVM%E5%A0%86/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第六章-JVM堆">第六章-JVM堆</span>
            <span class="post-date" title="2023-12-02 08:01:00">2023/12/02</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/11/30/jvm/%E7%AC%AC%E4%BA%94%E7%AB%A0-%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%8E%A5%E5%8F%A3/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第五章-本地方法接口">第五章-本地方法接口</span>
            <span class="post-date" title="2023-11-30 17:55:00">2023/11/30</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/11/28/jvm/%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第四章-虚拟机栈">第四章-虚拟机栈</span>
            <span class="post-date" title="2023-11-28 20:55:00">2023/11/28</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/11/28/jvm/%E7%AC%AC%E4%B8%89%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第三章-运行时数据区">第三章-运行时数据区</span>
            <span class="post-date" title="2023-11-28 19:31:00">2023/11/28</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/11/25/jvm/%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F/"
           data-tag="jvm,java,双亲委派机制"
           data-author="" >
            <span class="post-title" title="第二章-JVM类加载子系统">第二章-JVM类加载子系统</span>
            <span class="post-date" title="2023-11-25 14:35:00">2023/11/25</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/2023/11/25/jvm/%E7%AC%AC%E4%B8%80%E7%AB%A0-JVM%E5%92%8CJava%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/"
           data-tag="jvm,java"
           data-author="" >
            <span class="post-title" title="第一章-JVM和Java体系结构">第一章-JVM和Java体系结构</span>
            <span class="post-date" title="2023-11-25 10:00:00">2023/11/25</span>
        </a>
        
        
        <a  class="全部文章 Hexo "
           href="/2023/11/21/hexo/%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Sitemap/"
           data-tag="hexo,github pages,sitemap"
           data-author="" >
            <span class="post-title" title="给博客网站添加站点地图-sitemap">给博客网站添加站点地图-sitemap</span>
            <span class="post-date" title="2023-11-21 20:00:00">2023/11/21</span>
        </a>
        
        
        <a  class="全部文章 Hexo Typora "
           href="/2023/11/20/hexo/Typora%E8%AE%BE%E7%BD%AE%E5%9B%BE%E7%89%87%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0Github/"
           data-tag="hexo,typora,github"
           data-author="" >
            <span class="post-title" title="Typora设置图片自动上传Github">Typora设置图片自动上传Github</span>
            <span class="post-date" title="2023-11-20 20:30:00">2023/11/20</span>
        </a>
        
        
        <a  class="全部文章 Hexo "
           href="/2023/11/20/hexo/3-Hexo%E4%B8%BB%E9%A2%98%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9/"
           data-tag="hexo,github pages"
           data-author="" >
            <span class="post-title" title="Hexo主题常用配置">Hexo主题常用配置</span>
            <span class="post-date" title="2023-11-20 00:00:01">2023/11/20</span>
        </a>
        
        
        <a  class="全部文章 Hexo "
           href="/2023/11/20/hexo/Hexo%E5%8D%9A%E5%AE%A2%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98/"
           data-tag="hexo,github pages"
           data-author="" >
            <span class="post-title" title="Hexo博客安装主题">Hexo博客安装主题</span>
            <span class="post-date" title="2023-11-20 00:00:01">2023/11/20</span>
        </a>
        
        
        <a  class="全部文章 Hexo "
           href="/2023/11/18/hexo/%E5%9F%BA%E4%BA%8EHexo%E5%92%8CGithub-Pages%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"
           data-tag="hexo,github pages"
           data-author="" >
            <span class="post-title" title="基于Hexo和Github Pages搭建个人博客">基于Hexo和Github Pages搭建个人博客</span>
            <span class="post-date" title="2023-11-18 15:40:20">2023/11/18</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-jvm/第二十三章-浅堆-深堆-内存泄漏" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">第二十三章-浅堆-深堆-内存泄漏</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="JVM">JVM</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color4">jvm</a>
            
            <a class="color5">java</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2024-08-24 14:57:56'>2024-08-24 13:04</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:5.1k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%B5%85%E5%A0%86%E4%B8%8E%E6%B7%B1%E5%A0%86"><span class="toc-text">一、浅堆与深堆</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-shallow-heap-%E6%B5%85%E5%A0%86"><span class="toc-text">1. shallow heap(浅堆)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-retained-heap-%E4%BF%9D%E7%95%99%E9%9B%86"><span class="toc-text">2. retained heap(保留集)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%A1%A5%E5%85%85%EF%BC%9A%E5%AF%B9%E8%B1%A1%E5%AE%9E%E9%99%85%E5%A4%A7%E5%B0%8F"><span class="toc-text">3. 补充：对象实际大小</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%EF%BC%9AStudentTrace"><span class="toc-text">4. 案例分析：StudentTrace</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%94%AF%E9%85%8D%E6%A0%91%EF%BC%88Dominator-Tree%EF%BC%89"><span class="toc-text">二、支配树（Dominator Tree）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F"><span class="toc-text">三、内存泄漏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%EF%BC%88memory-leak%EF%BC%89"><span class="toc-text">1. 内存泄漏（memory leak）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%EF%BC%88out-of-memory%EF%BC%89"><span class="toc-text">2. 内存溢出（out of memory）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Java%E4%B8%AD%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E7%9A%848%E7%A7%8D%E6%83%85%E5%86%B5"><span class="toc-text">3. Java中内存泄露的8种情况</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E9%9D%99%E6%80%81%E9%9B%86%E5%90%88%E7%B1%BB"><span class="toc-text">3.1 静态集合类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">3.2 单例模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%86%85%E9%83%A8%E7%B1%BB%E6%8C%81%E6%9C%89%E5%A4%96%E9%83%A8%E7%B1%BB"><span class="toc-text">3.3 内部类持有外部类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E5%90%84%E7%A7%8D%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%A6%82%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E3%80%81%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E5%92%8CIO%E8%BF%9E%E6%8E%A5%E7%AD%89"><span class="toc-text">3.4 各种连接，如数据库连接、网络连接和IO连接等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%8F%98%E9%87%8F%E4%B8%8D%E5%90%88%E7%90%86%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text">3.5 变量不合理的作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E6%94%B9%E5%8F%98%E5%93%88%E5%B8%8C%E5%80%BC"><span class="toc-text">3.6 改变哈希值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E7%BC%93%E5%AD%98%E6%B3%84%E9%9C%B2"><span class="toc-text">3.7 缓存泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-%E7%9B%91%E5%90%AC%E5%99%A8%E5%92%8C%E5%85%B6%E4%BB%96%E5%9B%9E%E8%B0%83"><span class="toc-text">3.8 监听器和其他回调</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-text">四、内存泄露案例分析</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一、浅堆与深堆"><a href="#一、浅堆与深堆" class="headerlink" title="一、浅堆与深堆"></a>一、浅堆与深堆</h1><h2 id="1-shallow-heap-浅堆"><a href="#1-shallow-heap-浅堆" class="headerlink" title="1. shallow heap(浅堆)"></a>1. shallow heap(浅堆)</h2><p>shallow heap是对象本身的大小，不包括其引用的对象。<br>对于非数组类型：shallow heap就是对象与其成员变量加在一起的大小。<br>对于数组类型：shallow heap就是数组各个元素大小之和。</p>
<h2 id="2-retained-heap-保留集"><a href="#2-retained-heap-保留集" class="headerlink" title="2. retained heap(保留集)"></a>2. retained heap(保留集)</h2><p>对象remainder heap 大小 &#x3D; 对象shallow heap大小 + 对象直接或者间接引用的对象大小（排除被GC ROOT直接引用的对象）。<br>如下图所示：</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/20/20240820-194720.png" alt="对象引用关系"></p>
<p><strong>对象引用关系</strong><br>OBJECT A 的 remainder heap &#x3D; OBJECT A 的 shallow heap<br>OBJECT B的 remainder heap &#x3D; OBJECT B 的 shallow heap + OBJECT C 的对象大小 + OBJECT E 的对象大小</p>
<p>所以对象的remainder heap其实接近进行垃圾回收时，清除该对象时所能获取的堆内存大小（有的对象可能还被其他对象引用，垃圾回收时，不能清除）。</p>
<p>下面是用mat对从服务器上面dump出来Java虚拟机内存进行解析之后的结果：</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/20/20240820-194952.png" alt="内存分析"></p>
<p><strong>Java内存解析结果</strong></p>
<p>其中，Objects为类的对象的个数。Shallow Heap是这些对象自身大小之和，Remainder Heap是这些对象自身以及这些对象直接或者间接引用的对象大小总和。</p>
<h2 id="3-补充：对象实际大小"><a href="#3-补充：对象实际大小" class="headerlink" title="3. 补充：对象实际大小"></a>3. 补充：对象实际大小</h2><p>另外一个常用的概念是对象的实际大小。这里，对象的实际大小定义为一个对象所能触及的所有对象的浅堆大小之和，也就是通常意义上我们说的对象大小。与深堆相比，似乎这个在日常开发中更为直观和被人接受，但实际上，<strong>这个概念和垃圾回收无关</strong>。</p>
<p>下图显示了一个简单的对象引用关系图，对象A引用了C和D，对象B引用了C和E。那么对象A的浅堆大小只是A本身，不含C和D，而A的实际大小为A、C、D三者之和。而A的深堆大小为A与D之和，由于对象C还可以通过对象B访问到，因此不在对象A的深堆范围内。</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/20/20240820-195149.png" alt="对象引用关系"></p>
<h2 id="4-案例分析：StudentTrace"><a href="#4-案例分析：StudentTrace" class="headerlink" title="4. 案例分析：StudentTrace"></a>4. 案例分析：StudentTrace</h2><p><strong>案例代码</strong></p>
<pre><code class="highlight java"><span class="comment">/**</span>
<span class="comment"> * 有一个学生浏览网页的记录程序，它将记录 每个学生访问过的网站地址。</span>
<span class="comment"> * 它由三个部分组成：Student、WebPage和StudentTrace三个类</span>
<span class="comment"> *</span>
<span class="comment"> *  -XX:+HeapDumpBeforeFullGC -XX:HeapDumpPath=d:\student.hprof</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentTrace</span> &#123;
    <span class="keyword">static</span> List&lt;WebPage&gt; webpages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;WebPage&gt;();


    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createWebPages</span><span class="params">()</span> &#123;
        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;
            <span class="type">WebPage</span> <span class="variable">wp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebPage</span>();
            wp.setUrl(<span class="string">&quot;http://www.&quot;</span> + Integer.toString(i) + <span class="string">&quot;.com&quot;</span>);
            wp.setContent(Integer.toString(i));
            webpages.add(wp);
        &#125;
    &#125;

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
        createWebPages();<span class="comment">//创建了100个网页</span>
        <span class="comment">//创建3个学生对象</span>
        <span class="type">Student</span> <span class="variable">st3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">3</span>, <span class="string">&quot;Tom&quot;</span>);
        <span class="type">Student</span> <span class="variable">st5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">5</span>, <span class="string">&quot;Jerry&quot;</span>);
        <span class="type">Student</span> <span class="variable">st7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">7</span>, <span class="string">&quot;Lily&quot;</span>);

        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; webpages.size(); i++) &#123;
            <span class="keyword">if</span> (i % st3.getId() == <span class="number">0</span>)
                st3.visit(webpages.get(i));
            <span class="keyword">if</span> (i % st5.getId() == <span class="number">0</span>)
                st5.visit(webpages.get(i));
            <span class="keyword">if</span> (i % st7.getId() == <span class="number">0</span>)
                st7.visit(webpages.get(i));
        &#125;
        webpages.clear();
        System.gc();

    &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">Student</span> &#123;
    <span class="keyword">private</span> <span class="type">int</span> id;
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> List&lt;WebPage&gt; history = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();

    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;
        <span class="built_in">super</span>();
        <span class="built_in">this</span>.id = id;
        <span class="built_in">this</span>.name = name;
    &#125;

    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> id;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;
        <span class="built_in">this</span>.id = id;
    &#125;

    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> name;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;
        <span class="built_in">this</span>.name = name;
    &#125;

    <span class="keyword">public</span> List&lt;WebPage&gt; <span class="title function_">getHistory</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> history;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHistory</span><span class="params">(List&lt;WebPage&gt; history)</span> &#123;
        <span class="built_in">this</span>.history = history;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(WebPage wp)</span> &#123;
        <span class="keyword">if</span> (wp != <span class="literal">null</span>) &#123;
            history.add(wp);
        &#125;
    &#125;
&#125;


<span class="keyword">class</span> <span class="title class_">WebPage</span> &#123;
    <span class="keyword">private</span> String url;
    <span class="keyword">private</span> String content;

    <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> url;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUrl</span><span class="params">(String url)</span> &#123;
        <span class="built_in">this</span>.url = url;
    &#125;

    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> content;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;
        <span class="built_in">this</span>.content = content;
    &#125;
&#125;
</code></pre>

<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/20/20240820-200332.png" alt="线程对象追踪"></p>
<p><strong>结论：</strong><br>elementData 数组的浅堆是80个字节，而 elementData 数组中的所有 WebPage 对象的深堆之和是1208个字节，所以加在一起就是 elementData 数组的深堆之和，也就是1288个字节</p>
<p><strong>解析：</strong></p>
<p>默认采用了指针压缩则为12字节，没有采用则为16字节（数组还需要加上数组长度）。</p>
<p>1.为什么有152字节和144字节：因为我们的URL和content存在两种情况<br>        URL:”<a target="_blank" rel="noopener" href="http://www.7.com"、content:"7"-----URL:"http://www.14.com"、content:"14">http://www.7.com&quot;、content:&quot;7&quot;-----URL:&quot;http://www.14.com&quot;、content:&quot;14</a>“<br>        第一种URL长度为16，底层的char数组的占用空间为(【】方括号里面整个都属于对象头，分开写方便大家理解)<br>            【普通对象头(12) + 数组长度(4)】 + 16个字符(32) &#x3D; 48字节，符合8字节对齐<br>            同理content 占用 【普通对象头(12) +数组长度(4)】+ 一个字符(2) &#x3D; 18字节,八字节对齐&#x3D;24字节<br>        第二种URL长度为17，底层的插入数组的占用空间为<br>            【普通对象头(12) + 数组长度(4)】 + 17个字符(34) &#x3D; 50字节，不符合8字节对齐，对齐为56<br>            同理content 占用 【普通对象头(12) +数组长度(4)】+ 两个字符(4) &#x3D; 20字节,八字节对齐&#x3D;24字节<br>        所以第一种总字节为48 + 24 &#x3D; 72,第二种总字节为56 + 24 &#x3D; 80<br>        因此第二种比第一种多了8字节，所以是152和144。<br>        (为什么总大小是152而不是72是因为我们只计算了String底层的char数组的区别没有计算各变量本身的浅堆,<br>        因为结构都相同，所以差别就差在内容的占用上)</p>
<p>2.为什么最终结果是1288<br>        首先ElementData数组本身的浅堆大小为<br>        【普通对象头(12) + 数组长度(4)】 + 数组内容【15个Obejct引用&#x3D;16*4】 &#x3D; 76,八字节对齐&#x3D;80字节<br>        15个Object分为13个152字节+2个144字节，总大小为&#x3D;2264字节<br>        7号和其他student重复的有0、21、42、63、84、35、70总计6个152和1一个144<br>        所以2264 - 6 * 152 - 144 &#x3D; 1208字节<br>    所以ElementData本身的浅堆80 + 仅能通过它到达的浅堆1208 &#x3D; 1288</p>
<h1 id="二、支配树（Dominator-Tree）"><a href="#二、支配树（Dominator-Tree）" class="headerlink" title="二、支配树（Dominator Tree）"></a>二、支配树（Dominator Tree）</h1><p>支配树的概念源自<strong>图论</strong>。</p>
<p>MAT提供了一个称为<strong>支配树</strong>（Dominator Tree)的对象图。支配树体现了<strong>对象实例</strong>间的支配关系。在对象引用图中，所有指向对象B的路径都经过对象A , 则认为对象A支配对象B。如果对象A是离对象B最近的一个支配对象 ，则认为对象A为对象B的<strong>直接支配者</strong>。支配树是基于<strong>对象间的引用图</strong>所建立的，它有以下基本性质：</p>
<ul>
<li>对象A的子树（所有被对象A支配的对象集合）表示对象A的保留集（retained set) , 即深堆</li>
<li>如果对象A支配对象B , 那么对象A的直接支配者也支配对象B</li>
<li>支配树的边与对象引用图的边不直接对应</li>
</ul>
<p>如下图所示：</p>
<p>左图表示<strong>对象引用图</strong>，右图表示左图所对应的<strong>支配树</strong>。</p>
<p>对象A和B由根对象直接支配，由于在到对象C的路径中，可以经过A , 也可以经过B , 因此对象C的直接支配者也是根对象。<br>对象F与对象D相互引用 ，因为到对象F的所有路径必然经过对象D , 因此，对象D是对象F的直接支配者 。<br>而到对象D的所有路径中，必然经过对象C , 即使是从对象F到对象D的引用 ，从根节点出发，也是经过对象C的，所以 ，对象D的直接支配者为对象C。</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/22/20240822-184127.png" alt="支配树"></p>
<p>同理，对象E支配对象G。到达对象H的可以通过对象D , 也可以通过对象E , 因此对象D和E都不能支配对象H , 而经过对象C既可以到达D也可以到达E , 因此<strong>对象C为对象H的直接支配者</strong>。</p>
<p>在MAT中，单击工具栏上的对象支配树按钮，可以打开<strong>对象支配树</strong>视图。</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/22/20240822-184933.png" alt="MAT通过dump文件查看对象支配树"></p>
<p>下图显示了对象支配树视图的一部分。该截图显示部分Lily学生的history队列的直接支配对象。即当Lily对象被回收，也会一并回收的所有对象。显然能被3或者5整除的网页不会出现在该列表中，因为它们同时被另外两名学生对象引用。</p>
<h1 id="三、内存泄漏"><a href="#三、内存泄漏" class="headerlink" title="三、内存泄漏"></a>三、内存泄漏</h1><h2 id="1-内存泄漏（memory-leak）"><a href="#1-内存泄漏（memory-leak）" class="headerlink" title="1. 内存泄漏（memory leak）"></a>1. 内存泄漏（memory leak）</h2><p>可达性分析算法来判断对象是否是不再使用的对象，本质都是判断一个对象是否还被引用。那么对于这种情况下，由于代码的实现不同就会出现很多种内存泄漏问题（让JVM误以为此对象还在引用中，无法回收，造成内存泄漏）。</p>
<ul>
<li>是否还被使用？是</li>
<li>是否还被需要？否</li>
</ul>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/24/20240824-135555.png" alt="内存泄漏"></p>
<p>严格来说，只有对象不会再被程序用到了，但是GC又不能回收他们的情况，才叫内存泄漏。但实际情况很多时候一些不太好的实践（或疏忽）会导致对象的生命周期变得很长甚至导致OOM，也可以叫做宽泛意义上的“内存泄漏”。</p>
<p>如下图，当Y生命周期结束的时候，X依然引用着Y，这时候，垃圾回收期是不会回收对象Y的；如果对象X还引用着生命周期比较短的A、B、C，对象A又引用着对象 a、b、c，这样就可能造成大量无用的对象不能被回收，进而占据了内存资源，造成内存泄漏，直到内存溢出。</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/24/20240824-135602.png" alt="内存泄漏示意"></p>
<p>申请了内存用完了不释放，比如一共有1024M的内存，分配了512M的内存一直不回收，那么可以用的内存只有512M了，仿佛泄露掉了一部分；通俗一点讲的话，内存泄漏就是【占着茅坑不拉shi】。</p>
<h2 id="2-内存溢出（out-of-memory）"><a href="#2-内存溢出（out-of-memory）" class="headerlink" title="2. 内存溢出（out of memory）"></a>2. 内存溢出（out of memory）</h2><p>申请内存时，没有足够的内存可以使用；通俗一点儿讲，一个厕所就三个坑，有两个站着茅坑不走的（内存泄漏），剩下最后一个坑，厕所表示接待压力很大，这时候一下子来了两个人，坑位（内存）就不够了，内存泄漏变成内存溢出了。可见，内存泄漏和内存溢出的关系：内存泄漏的增多，最终会导致内存溢出。</p>
<p><strong>泄漏的分类</strong></p>
<ul>
<li><p>经常发生：发生内存泄露的代码会被多次执行，每次执行，泄露一块内存；</p>
</li>
<li><p>偶然发生：在某些特定情况下才会发生</p>
</li>
<li><p>一次性：发生内存泄露的方法只会执行一次；</p>
</li>
<li><p>隐式泄漏：一直占着内存不释放，直到执行结束；严格的说这个不算内存泄漏，因为最终释放掉了，但是如果执行时间特别长，也可能会导致内存耗尽。</p>
</li>
</ul>
<h2 id="3-Java中内存泄露的8种情况"><a href="#3-Java中内存泄露的8种情况" class="headerlink" title="3. Java中内存泄露的8种情况"></a>3. Java中内存泄露的8种情况</h2><h3 id="3-1-静态集合类"><a href="#3-1-静态集合类" class="headerlink" title="3.1 静态集合类"></a>3.1 静态集合类</h3><p>静态集合类，如 HashMap、LinkedList 等等。如果这些容器为静态的，那么它们的生命周期与JVM程序一致，则容器中的对象在程序结束之前将不能被释放，从而造成内存泄漏。简单而言，长生命周期的对象持有短生命周期对象的引用，尽管短生命周期的对象不再使用，但是因为长生命周期对象持有它的引用而导致不能被回收。</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemoryLeak</span> &#123;
    <span class="keyword">static</span> <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">oomTests</span><span class="params">()</span>&#123;
        Object obj＝<span class="keyword">new</span> <span class="title class_">Object</span>();<span class="comment">//局部变量</span>
        list.add(obj);
    &#125;
&#125;</code></pre>



<h3 id="3-2-单例模式"><a href="#3-2-单例模式" class="headerlink" title="3.2 单例模式"></a>3.2 单例模式</h3><p>单例模式，和静态集合导致内存泄露的原因类似，因为单例的静态特性，它的生命周期和 JVM 的生命周期一样长，所以如果单例对象如果持有外部对象的引用，那么这个外部对象也不会被回收，那么就会造成内存泄漏。</p>
<h3 id="3-3-内部类持有外部类"><a href="#3-3-内部类持有外部类" class="headerlink" title="3.3 内部类持有外部类"></a>3.3 内部类持有外部类</h3><p>内部类持有外部类，如果一个外部类的实例对象的方法返回了一个内部类的实例对象。这个内部类对象被长期引用了，即使那个外部类实例对象不再被使用，但由于内部类持有外部类的实例对象，这个外部类对象将不会被垃圾回收，这也会造成内存泄漏。</p>
<h3 id="3-4-各种连接，如数据库连接、网络连接和IO连接等"><a href="#3-4-各种连接，如数据库连接、网络连接和IO连接等" class="headerlink" title="3.4 各种连接，如数据库连接、网络连接和IO连接等"></a>3.4 各种连接，如数据库连接、网络连接和IO连接等</h3><p>在对数据库进行操作的过程中，首先需要建立与数据库的连接，当不再使用时，需要调用close方法来释放与数据库的连接。只有连接被关闭后，垃圾回收器才会回收对应的对象。否则，如果在访问数据库的过程中，对Connection、Statement或ResultSet不显性地关闭，将会造成大量的对象无法被回收，从而引起内存泄漏。</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
    <span class="keyword">try</span>&#123;
        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span><span class="literal">null</span>;
        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);
        conn =DriverManager.getConnection(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);
        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span>conn.createStatement();
        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span>stmt.executeQuery(<span class="string">&quot;....&quot;</span>);
    &#125; <span class="keyword">catch</span>（Exception e）&#123;<span class="comment">//异常日志</span>
    &#125; <span class="keyword">finally</span> &#123;
        <span class="comment">// 1．关闭结果集 Statement</span>
        <span class="comment">// 2．关闭声明的对象 ResultSet</span>
        <span class="comment">// 3．关闭连接 Connection</span>
    &#125;
&#125;</code></pre>



<h3 id="3-5-变量不合理的作用域"><a href="#3-5-变量不合理的作用域" class="headerlink" title="3.5 变量不合理的作用域"></a>3.5 变量不合理的作用域</h3><p>变量不合理的作用域。一般而言，一个变量的定义的作用范围大于其使用范围，很有可能会造成内存泄漏。另一方面，如果没有及时地把对象设置为null，很有可能导致内存泄漏的发生。</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UsingRandom</span> &#123;
    <span class="keyword">private</span> String msg;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveMsg</span><span class="params">()</span>&#123;
        readFromNet();<span class="comment">//从网络中接受数据保存到msg中</span>
        saveDB();<span class="comment">//把msg保存到数据库中</span>
    &#125;
&#125;</code></pre>

<p>如上面这个伪代码，通过 readFromNet 方法把接受的消息保存在变量msg中，然后调用saveDB方法把msg的内容保存到数据库中，此时msg已经就没用了，由于msg的生命周期与对象的生命周期相同，此时msg还不能回收，因此造成了内存泄漏。实际上这个msg变量可以放在receiveMsg方法内部，当方法使用完，那么msg的生命周期也就结束，此时就可以回收了。还有一种方法，在使用完msg后，把msg设置为null，这样垃圾回收器也会回收msg的内存空间。</p>
<h3 id="3-6-改变哈希值"><a href="#3-6-改变哈希值" class="headerlink" title="3.6 改变哈希值"></a>3.6 改变哈希值</h3><p>改变哈希值，当一个对象被存储进 HashSet 集合中以后，就不能修改这个对象中的那些参与计算哈希值的字段了。</p>
<p>否则，对象修改后的哈希值与最初存储进HashSet集合中时的哈希值就不同了，在这种情况下，即使在 contains 方法使用该对象的当前引用作为的参数去HashSet集合中检索对象，也将返回找不到对象的结果，这也会导致无法从HashSet集合中单独删除当前对象，造成内存泄漏。</p>
<p>这也是 String 为什么被设置成了不可变类型，我们可以放心地把 String 存入 HashSet，或者把String 当做 HashMap 的 key 值；</p>
<p>当我们想把自己定义的类保存到散列表的时候，需要保证对象的 hashCode 不可变。</p>
<pre><code class="highlight java"><span class="comment">/**</span>
<span class="comment"> * 例1</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChangeHashCode</span> &#123;
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
        <span class="type">HashSet</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>();
        <span class="type">Person</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1001</span>, <span class="string">&quot;AA&quot;</span>);
        <span class="type">Person</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1002</span>, <span class="string">&quot;BB&quot;</span>);

        set.add(p1);
        set.add(p2);

        p1.name = <span class="string">&quot;CC&quot;</span>;<span class="comment">//导致了内存的泄漏</span>
        set.remove(p1); <span class="comment">//删除失败</span>

        System.out.println(set);

        set.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1001</span>, <span class="string">&quot;CC&quot;</span>));
        System.out.println(set);

        set.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1001</span>, <span class="string">&quot;AA&quot;</span>));
        System.out.println(set);

    &#125;
&#125;

<span class="keyword">class</span> <span class="title class_">Person</span> &#123;
    <span class="type">int</span> id;
    String name;

    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;
        <span class="built_in">this</span>.id = id;
        <span class="built_in">this</span>.name = name;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;
        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;
        <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Person)) <span class="keyword">return</span> <span class="literal">false</span>;

        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) o;

        <span class="keyword">if</span> (id != person.id) <span class="keyword">return</span> <span class="literal">false</span>;
        <span class="keyword">return</span> name != <span class="literal">null</span> ? name.equals(person.name) : person.name == <span class="literal">null</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;
        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> id;
        result = <span class="number">31</span> * result + (name != <span class="literal">null</span> ? name.hashCode() : <span class="number">0</span>);
        <span class="keyword">return</span> result;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +
                <span class="string">&quot;id=&quot;</span> + id +
                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +
                <span class="string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;</code></pre>

<pre><code class="highlight java"><span class="comment">/**</span>
<span class="comment"> * 例2</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChangeHashCode1</span> &#123;
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
        HashSet&lt;Point&gt; hs = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Point&gt;();
        <span class="type">Point</span> <span class="variable">cc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>();
        cc.setX(<span class="number">10</span>);<span class="comment">//hashCode = 41</span>
        hs.add(cc);

        cc.setX(<span class="number">20</span>);<span class="comment">//hashCode = 51  此行为导致了内存的泄漏</span>

        System.out.println(<span class="string">&quot;hs.remove = &quot;</span> + hs.remove(cc));<span class="comment">//false</span>
        hs.add(cc);
        System.out.println(<span class="string">&quot;hs.size = &quot;</span> + hs.size());<span class="comment">//size = 2</span>

        System.out.println(hs);
    &#125;

&#125;

<span class="keyword">class</span> <span class="title class_">Point</span> &#123;
    <span class="type">int</span> x;

    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getX</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> x;
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setX</span><span class="params">(<span class="type">int</span> x)</span> &#123;
        <span class="built_in">this</span>.x = x;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;
        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">prime</span> <span class="operator">=</span> <span class="number">31</span>;
        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">1</span>;
        result = prime * result + x;
        <span class="keyword">return</span> result;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;
        <span class="keyword">if</span> (<span class="built_in">this</span> == obj) <span class="keyword">return</span> <span class="literal">true</span>;
        <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;
        <span class="keyword">if</span> (getClass() != obj.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;
        <span class="type">Point</span> <span class="variable">other</span> <span class="operator">=</span> (Point) obj;
        <span class="keyword">if</span> (x != other.x) <span class="keyword">return</span> <span class="literal">false</span>;
        <span class="keyword">return</span> <span class="literal">true</span>;
    &#125;

    <span class="meta">@Override</span>
    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;
        <span class="keyword">return</span> <span class="string">&quot;Point&#123;&quot;</span> +
                <span class="string">&quot;x=&quot;</span> + x +
                <span class="string">&#x27;&#125;&#x27;</span>;
    &#125;
&#125;</code></pre>



<h3 id="3-7-缓存泄露"><a href="#3-7-缓存泄露" class="headerlink" title="3.7 缓存泄露"></a>3.7 缓存泄露</h3><p>内存泄漏的另一个常见来源是缓存，一旦你把对象引用放入到缓存中，他就很容易遗忘。比如：之前项目在一次上线的时候，应用启动奇慢直到夯死，就是因为代码中会加载一个表中的数据到缓存（内存）中，测试环境只有几百条数据，但是生产环境有几百万的数据。</p>
<p>对于这个问题，可以使用WeakHashMap代表缓存，此种Map的特点是，当除了自身有对key的引用外，此key没有其他引用那么此map会自动丢弃此值。</p>
<p>public class MapTest {<br>    static Map wMap &#x3D; new WeakHashMap();<br>    static Map map &#x3D; new HashMap();</p>
<pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTest</span> &#123;
    <span class="keyword">static</span> <span class="type">Map</span> <span class="variable">wMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WeakHashMap</span>();
    <span class="keyword">static</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;
        init();
        testWeakHashMap();
        testHashMap();
    &#125;

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;
        <span class="type">String</span> <span class="variable">ref1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;obejct1&quot;</span>);
        <span class="type">String</span> <span class="variable">ref2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;obejct2&quot;</span>);
        <span class="type">String</span> <span class="variable">ref3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;obejct3&quot;</span>);
        <span class="type">String</span> <span class="variable">ref4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;obejct4&quot;</span>);
        wMap.put(ref1, <span class="string">&quot;cacheObject1&quot;</span>);
        wMap.put(ref2, <span class="string">&quot;cacheObject2&quot;</span>);
        map.put(ref3, <span class="string">&quot;cacheObject3&quot;</span>);
        map.put(ref4, <span class="string">&quot;cacheObject4&quot;</span>);
        System.out.println(<span class="string">&quot;String引用ref1，ref2，ref3，ref4 消失&quot;</span>);

    &#125;

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testWeakHashMap</span><span class="params">()</span> &#123;
        System.out.println(<span class="string">&quot;WeakHashMap GC之前&quot;</span>);
        <span class="keyword">for</span> (Object o : wMap.entrySet()) &#123;
            System.out.println(o);
        &#125;
        <span class="keyword">try</span> &#123;
            System.gc();
            TimeUnit.SECONDS.sleep(<span class="number">5</span>);
        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
        System.out.println(<span class="string">&quot;WeakHashMap GC之后&quot;</span>);
        <span class="keyword">for</span> (Object o : wMap.entrySet()) &#123;
            System.out.println(o);
        &#125;
    &#125;

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testHashMap</span><span class="params">()</span> &#123;
        System.out.println(<span class="string">&quot;HashMap GC之前&quot;</span>);
        <span class="keyword">for</span> (Object o : map.entrySet()) &#123;
            System.out.println(o);
        &#125;
        <span class="keyword">try</span> &#123;
            System.gc();
            TimeUnit.SECONDS.sleep(<span class="number">5</span>);
        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;
            e.printStackTrace();
        &#125;
        System.out.println(<span class="string">&quot;HashMap GC之后&quot;</span>);
        <span class="keyword">for</span> (Object o : map.entrySet()) &#123;
            System.out.println(o);
        &#125;
    &#125;

&#125;</code></pre>

<p>上面代码和图示主演演示WeakHashMap如何自动释放缓存对象，当init函数执行完成后，局部变量字符串引用weakd1，weakd2，d1，d2都会消失，此时只有静态map中保存中对字符串对象的引用，可以看到，调用gc之后，HashMap的没有被回收，而WeakHashMap里面的缓存被回收了。</p>
<h3 id="3-8-监听器和其他回调"><a href="#3-8-监听器和其他回调" class="headerlink" title="3.8 监听器和其他回调"></a>3.8 监听器和其他回调</h3><p>内存泄漏第三个常见来源是监听器和其他回调，如果客户端在你实现的API中注册回调，却没有显示的取消，那么就会积聚。</p>
<p>需要确保回调立即被当作垃圾回收的最佳方法是只保存它的弱引用，例如将他们保存成为WeakHashMap中的键。</p>
<h1 id="四、内存泄露案例分析"><a href="#四、内存泄露案例分析" class="headerlink" title="四、内存泄露案例分析"></a>四、内存泄露案例分析</h1><pre><code class="highlight java"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Stack</span> &#123;
    <span class="keyword">private</span> Object[] elements;
    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_INITIAL_CAPACITY</span> <span class="operator">=</span> <span class="number">16</span>;

    <span class="keyword">public</span> <span class="title function_">Stack</span><span class="params">()</span> &#123;
        elements = <span class="keyword">new</span> <span class="title class_">Object</span>[DEFAULT_INITIAL_CAPACITY];
    &#125;

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(Object e)</span> &#123; <span class="comment">//入栈</span>
        ensureCapacity();
        elements[size++] = e;
    &#125;

    <span class="keyword">public</span> Object <span class="title function_">pop</span><span class="params">()</span> &#123; <span class="comment">//出栈</span>
        <span class="keyword">if</span> (size == <span class="number">0</span>)
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">EmptyStackException</span>();
        <span class="keyword">return</span> elements[--size];
    &#125;

    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacity</span><span class="params">()</span> &#123;
        <span class="keyword">if</span> (elements.length == size)
            elements = Arrays.copyOf(elements, <span class="number">2</span> * size + <span class="number">1</span>);
    &#125;
&#125;</code></pre>

<p>上述程序并没有明显的错误，但是这段程序有一个内存泄漏，随着GC活动的增加，或者内存占用的不断增加，程序性能的降低就会表现出来，严重时可导致内存泄漏，但是这种失败情况相对较少。</p>
<p>代码的主要问题在pop函数，下面通过这张图示展现。假设这个栈一直增长，增长后如下图所示</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/24/20240824-145444.png" alt="pop方法内存泄漏"></p>
<p>当进行大量的pop操作时，由于引用未进行置空，gc是不会释放的，如下图所示</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/24/20240824-145558.png" alt="pop方法内存泄漏2"></p>
<p>从上图中看以看出，如果栈先增长，再收缩，那么从栈中弹出的对象将不会被当作垃圾回收，即使程序不再使用栈中的这些队象，他们也不会回收，因为栈中仍然保存这对象的引用，俗称过期引用，这个内存泄露很隐蔽。</p>
<p>将代码中的pop()方法变成如下方法：</p>
<pre><code class="highlight java"><span class="keyword">public</span> Object <span class="title function_">pop</span><span class="params">()</span> &#123;
    <span class="keyword">if</span> (size == <span class="number">0</span>)
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">EmptyStackException</span>();
    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> elements[--size];
    elements[size] = <span class="literal">null</span>;
    <span class="keyword">return</span> result;
&#125;</code></pre>

<p>一旦引用过期，清空这些引用，将引用置空。</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2024/08/24/20240824-145718.png" alt="pop方法解决内存泄漏"></p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 george_95@126.com </span>
    </div>
</article>





    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'f820fe811764cacedc4f',
            clientSecret: '0ce07abb65f0e79ddb8830f32029b8a9656e0ee0',
            repo: 'georgechan95.github.io',
            owner: 'GeorgeChan95',
            admin: ['GeorgeChan95'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('15',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2016-2020 George
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
    #post .pjax article :not(pre) > code {
        color: #24292e;
        font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
        background-color: rgba(27,31,35,.05);
        border-radius: 3px;
        font-size: 85%;
        margin: 0;
        padding: .2em .4em;
    }
    
</style>







</html>
