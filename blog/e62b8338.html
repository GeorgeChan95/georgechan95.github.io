<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>015-K8S-Prometheus部署及监控告警 | George&#39;s Blog</title>
  <meta name="google-site-verification" content="RobLWkyyFziZxPJ4I887QROdX8XrYthcJwWTcuH0wwQ" />
  <meta name="msvalidate.01" content="626D541C48E5D151F52CECC2C6714BD4" />
  <meta name="360-site-verification" content="c838adf8357ca2f614d08ad5235a1717" />
  <meta name="keywords" content=" linux , Docker , Rocky , Prometheus ">
  <meta name="description" content="015-K8S-Prometheus部署及监控告警 | George&#39;s Blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="个人简介本人在合肥，从事后端开发工作。 联系方式 邮箱：&#103;&#101;&#x6f;&#114;&#x67;&#101;&#95;&#57;&#x35;&#64;&#x31;&#50;&#x36;&#46;&#x63;&#111;&#109;  邮件可能几天才看一次，如有联系，请耐心等待。">
<meta property="og:type" content="website">
<meta property="og:title" content="关于">
<meta property="og:url" content="https://georgechan95.github.io/about/index.html">
<meta property="og:site_name" content="George&#39;s Blog">
<meta property="og:description" content="个人简介本人在合肥，从事后端开发工作。 联系方式 邮箱：&#103;&#101;&#x6f;&#114;&#x67;&#101;&#95;&#57;&#x35;&#64;&#x31;&#50;&#x36;&#46;&#x63;&#111;&#109;  邮件可能几天才看一次，如有联系，请耐心等待。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-11-21T02:29:45.000Z">
<meta property="article:modified_time" content="2024-12-09T05:22:48.462Z">
<meta property="article:author" content="George">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/favicon.png">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/sublime.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="George's Blog" type="application/atom+xml">
</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<script src="/js/image-loader.js"></script>
<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>George</span>
</div>

<div class="icon">
    
        
            <a title="rss"
               href="/atom.xml"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-rss"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="github"
               href="https://github.com/GeorgeChan95"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <a title="email"
               href="mailto:george_95@126.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(117)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="设计模式">
            
            设计模式
            <small>(24)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="算法">
            
            算法
            <small>(5)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Docker">
            
            Docker
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Hexo">
            <i class="fold iconfont icon-right"></i>
            Hexo
            <small>(5)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Hexo&lt;---&gt;Typora">
            
            Typora
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JUC">
            
            JUC
            <small>(24)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JVM">
            
            JVM
            <small>(27)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="k8s">
            
            k8s
            <small>(21)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="linux">
            
            linux
            <small>(4)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="neo4j">
            
            neo4j
            <small>(3)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Python">
            
            Python
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="UML">
            
            UML
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  site_url"
               
               href="/about">关于</a>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="117">
<input type="hidden" id="yelog_site_word_count" value="577.3k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>插入排序</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>二分法</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>二进制</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>合并有序链表</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>科学上网</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>链表</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>冒泡排序</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>设计模式</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>双亲委派机制</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>算法</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>位运算</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>选择排序</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Docker</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>github</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>github pages</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Harbor</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hexo</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jenkins</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>juc</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>jvm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Loki</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>neo4j</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Pod</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Prometheus</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Python</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Rocky</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>sitemap</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>SpringBoot</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>typora</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ubuntu18</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>UML</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="全部文章 Python "
           href="/blog/7591dd09.html"
           data-tag="Python"
           data-author="" >
            <span class="post-title" title="002-安装Python开发环境">002-安装Python开发环境</span>
            <span class="post-date" title="2025-09-08 20:22:00">2025/09/08</span>
        </a>
        
        
        <a  class="全部文章 Python "
           href="/blog/95026633.html"
           data-tag="Python"
           data-author="" >
            <span class="post-title" title="001-Python语言概述">001-Python语言概述</span>
            <span class="post-date" title="2025-09-07 10:44:00">2025/09/07</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/e2c03adc.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="021-K8S-安全参数">021-K8S-安全参数</span>
            <span class="post-date" title="2025-08-23 14:43:00">2025/08/23</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/88f4f580.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="020-K8S-审计">020-K8S-审计</span>
            <span class="post-date" title="2025-08-10 14:43:00">2025/08/10</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/9bea6e2e.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="019-K8S-kubectl端口转发">019-K8S-kubectl端口转发</span>
            <span class="post-date" title="2025-08-04 23:02:00">2025/08/04</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/af9812e0.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="018-K8S-临时容器">018-K8S-临时容器</span>
            <span class="post-date" title="2025-08-03 22:01:00">2025/08/03</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/99657768.html"
           data-tag="linux,Docker,Rocky,Pod"
           data-author="" >
            <span class="post-title" title="017-K8S-网络策略NetworkPolicy">017-K8S-网络策略NetworkPolicy</span>
            <span class="post-date" title="2025-07-28 21:33:00">2025/07/28</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/c9536d9e.html"
           data-tag="linux,Docker,Rocky,Pod"
           data-author="" >
            <span class="post-title" title="016-K8S-固定Pod IP地址，基于Calico插件">016-K8S-固定Pod IP地址，基于Calico插件</span>
            <span class="post-date" title="2025-07-26 13:35:00">2025/07/26</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/e62b8338.html"
           data-tag="linux,Docker,Rocky,Prometheus"
           data-author="" >
            <span class="post-title" title="015-K8S-Prometheus部署及监控告警">015-K8S-Prometheus部署及监控告警</span>
            <span class="post-date" title="2025-07-19 16:39:00">2025/07/19</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/f8cf646f.html"
           data-tag="linux,Docker,Rocky,Loki"
           data-author="" >
            <span class="post-title" title="014-K8S-部署Loki+Promtail+Grafana实现日志监控">014-K8S-部署Loki+Promtail+Grafana实现日志监控</span>
            <span class="post-date" title="2025-07-10 21:00:00">2025/07/10</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/3fee6d19.html"
           data-tag="linux,Docker,Rocky,Harbor"
           data-author="" >
            <span class="post-title" title="013-K8S-使用Helm安装Harbor">013-K8S-使用Helm安装Harbor</span>
            <span class="post-date" title="2025-07-07 22:37:00">2025/07/07</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/b42f2c7b.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="012-新建Node节点添加到K8S集群中">012-新建Node节点添加到K8S集群中</span>
            <span class="post-date" title="2025-07-07 20:32:00">2025/07/07</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/6436eaf1.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="011-Kubernetes Ingress-Nginx">011-Kubernetes Ingress-Nginx</span>
            <span class="post-date" title="2025-06-25 19:42:00">2025/06/25</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/d8e3c7b3.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="010-Kubernetes Helm">010-Kubernetes Helm</span>
            <span class="post-date" title="2025-06-21 14:12:00">2025/06/21</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/424f1119.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="009-Kubernetes 集群安全机制">009-Kubernetes 集群安全机制</span>
            <span class="post-date" title="2025-06-14 09:18:00">2025/06/14</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/f2285a2d.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="008-Kubernetes 调度器">008-Kubernetes 调度器</span>
            <span class="post-date" title="2025-06-02 14:40:00">2025/06/02</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/ef156b88.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="007-Kubernetes 存储">007-Kubernetes 存储</span>
            <span class="post-date" title="2025-05-02 10:26:00">2025/05/02</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/970719d6.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="006-Kubernetes Service">006-Kubernetes Service</span>
            <span class="post-date" title="2025-04-28 22:10:00">2025/04/28</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/c790096a.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="005-Kubernetes控制器">005-Kubernetes控制器</span>
            <span class="post-date" title="2025-04-02 20:12:00">2025/04/02</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/79e06aab.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="004-Pod的生命周期">004-Pod的生命周期</span>
            <span class="post-date" title="2025-03-22 09:05:00">2025/03/22</span>
        </a>
        
        
        <a  class="全部文章 Docker "
           href="/blog/b01d5c62.html"
           data-tag="linux,Docker,科学上网"
           data-author="" >
            <span class="post-title" title="Docker配置网络代理实现外网镜像下载">Docker配置网络代理实现外网镜像下载</span>
            <span class="post-date" title="2025-01-08 23:00:00">2025/01/08</span>
        </a>
        
        
        <a  class="全部文章 linux "
           href="/blog/7f174b3e.html"
           data-tag="linux,科学上网,Rocky"
           data-author="" >
            <span class="post-title" title="Rocky9安装Shadowsocks实现科学上网">Rocky9安装Shadowsocks实现科学上网</span>
            <span class="post-date" title="2025-01-08 21:09:00">2025/01/08</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/b00f53e9.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="003-基于Rocky9.3系统使用kubeadm安装k8s1.29集群">003-基于Rocky9.3系统使用kubeadm安装k8s1.29集群</span>
            <span class="post-date" title="2025-01-03 22:05:00">2025/01/03</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/3c79d8d9.html"
           data-tag="linux,Docker,Rocky"
           data-author="" >
            <span class="post-title" title="002-Rocky9.3系统初始化设置和Docker安装">002-Rocky9.3系统初始化设置和Docker安装</span>
            <span class="post-date" title="2025-01-02 13:25:00">2025/01/02</span>
        </a>
        
        
        <a  class="全部文章 k8s "
           href="/blog/7e3a5200.html"
           data-tag="linux,Rocky"
           data-author="" >
            <span class="post-title" title="001-ESXi8安装Rocky9.3虚拟机">001-ESXi8安装Rocky9.3虚拟机</span>
            <span class="post-date" title="2025-01-02 09:34:00">2025/01/02</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/77d85f50.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="25-责任链模式">25-责任链模式</span>
            <span class="post-date" title="2024-12-03 21:08:00">2024/12/03</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/fcec839d.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="24-策略模式">24-策略模式</span>
            <span class="post-date" title="2024-12-02 18:16:00">2024/12/02</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/6109865a.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="23-状态模式">23-状态模式</span>
            <span class="post-date" title="2024-11-29 19:30:00">2024/11/29</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/58d4db7.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="22-解释器模式">22-解释器模式</span>
            <span class="post-date" title="2024-11-28 22:00:00">2024/11/28</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/a5cf7eb4.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="21-备忘录模式">21-备忘录模式</span>
            <span class="post-date" title="2024-11-27 21:40:00">2024/11/27</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/3148d6be.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="20-中介者模式">20-中介者模式</span>
            <span class="post-date" title="2024-11-26 20:35:00">2024/11/26</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/f06aea0b.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="19-观察者模式">19-观察者模式</span>
            <span class="post-date" title="2024-11-25 21:07:00">2024/11/25</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/7dbd9149.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="18-迭代器模式">18-迭代器模式</span>
            <span class="post-date" title="2024-11-24 00:02:00">2024/11/24</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/4fdf6e52.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="17-访问者模式">17-访问者模式</span>
            <span class="post-date" title="2024-11-23 21:55:00">2024/11/23</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/60fd53f.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="16-命令模式">16-命令模式</span>
            <span class="post-date" title="2024-11-23 20:30:00">2024/11/23</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/4930323d.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="15-模板方法模式">15-模板方法模式</span>
            <span class="post-date" title="2024-11-23 19:40:00">2024/11/23</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/e4235185.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="14-代理模式">14-代理模式</span>
            <span class="post-date" title="2024-11-21 23:16:00">2024/11/21</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/1b225c1f.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="13-享元模式">13-享元模式</span>
            <span class="post-date" title="2024-11-20 23:10:00">2024/11/20</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/906e9e8b.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="12-外观模式">12-外观模式</span>
            <span class="post-date" title="2024-11-20 22:09:00">2024/11/20</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/c456a66a.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="11-组合模式">11-组合模式</span>
            <span class="post-date" title="2024-11-16 17:00:00">2024/11/16</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/90213fc6.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="10-装饰器模式">10-装饰器模式</span>
            <span class="post-date" title="2024-11-16 14:06:00">2024/11/16</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/c7419cfa.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="09-桥接模式">09-桥接模式</span>
            <span class="post-date" title="2024-11-14 20:51:00">2024/11/14</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/f77fc055.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="08-适配器模式">08-适配器模式</span>
            <span class="post-date" title="2024-11-12 22:55:00">2024/11/12</span>
        </a>
        
        
        <a  class="全部文章 neo4j "
           href="/blog/a3b0b090.html"
           data-tag="neo4j,SpringBoot"
           data-author="" >
            <span class="post-title" title="Spring Boot对Neo4j节点关系的增删改查">Spring Boot对Neo4j节点关系的增删改查</span>
            <span class="post-date" title="2024-11-12 21:00:30">2024/11/12</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/3ab9aa56.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="07-建造者模式">07-建造者模式</span>
            <span class="post-date" title="2024-11-11 21:55:00">2024/11/11</span>
        </a>
        
        
        <a  class="全部文章 neo4j "
           href="/blog/7dc0fcde.html"
           data-tag="neo4j,SpringBoot"
           data-author="" >
            <span class="post-title" title="Spring Boot整合Neo4j实现增删改查">Spring Boot整合Neo4j实现增删改查</span>
            <span class="post-date" title="2024-11-07 19:04:30">2024/11/07</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/564adc33.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="06-原型模式">06-原型模式</span>
            <span class="post-date" title="2024-11-06 19:00:00">2024/11/06</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/effeea78.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="05-工厂模式">05-工厂模式</span>
            <span class="post-date" title="2024-11-04 21:00:00">2024/11/04</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/d7e99843.html"
           data-tag="设计模式"
           data-author="" >
            <span class="post-title" title="04-单例模式">04-单例模式</span>
            <span class="post-date" title="2024-11-04 19:00:00">2024/11/04</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/90f1850a.html"
           data-tag="设计模式,UML"
           data-author="" >
            <span class="post-title" title="03-UML类图">03-UML类图</span>
            <span class="post-date" title="2024-11-02 14:57:00">2024/11/02</span>
        </a>
        
        
        <a  class="全部文章 UML "
           href="/blog/c13304c1.html"
           data-tag="设计模式,UML"
           data-author="" >
            <span class="post-title" title="02-UML图绘制工具">02-UML图绘制工具</span>
            <span class="post-date" title="2024-11-02 09:57:00">2024/11/02</span>
        </a>
        
        
        <a  class="全部文章 linux "
           href="/blog/2e826df1.html"
           data-tag="linux,ubuntu18"
           data-author="" >
            <span class="post-title" title="Docker环境下RTSP流转RTMP和HLS">Docker环境下RTSP流转RTMP和HLS</span>
            <span class="post-date" title="2024-11-01 15:17:33">2024/11/01</span>
        </a>
        
        
        <a  class="全部文章 设计模式 "
           href="/blog/cd625bba.html"
           data-tag="设计模式,java"
           data-author="" >
            <span class="post-title" title="01-设计模式六大原则">01-设计模式六大原则</span>
            <span class="post-date" title="2024-10-31 17:00:00">2024/10/31</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/1a649f4c.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="13-JUC进阶-ReentrantReadWriteLock与StampedLock">13-JUC进阶-ReentrantReadWriteLock与StampedLock</span>
            <span class="post-date" title="2024-10-19 09:26:00">2024/10/19</span>
        </a>
        
        
        <a  class="全部文章 neo4j "
           href="/blog/5c93903a.html"
           data-tag="linux,neo4j"
           data-author="" >
            <span class="post-title" title="Docker部署Neo4j并导入CSV数据">Docker部署Neo4j并导入CSV数据</span>
            <span class="post-date" title="2024-10-17 15:00:30">2024/10/17</span>
        </a>
        
        
        <a  class="全部文章 linux "
           href="/blog/ad38e6b1.html"
           data-tag="linux,ubuntu18"
           data-author="" >
            <span class="post-title" title="Ubuntu18.04离线源环境搭建">Ubuntu18.04离线源环境搭建</span>
            <span class="post-date" title="2024-10-17 09:47:33">2024/10/17</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/3fdbf0f6.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="12-JUC进阶-从ReentrantLock到AQS源码详解">12-JUC进阶-从ReentrantLock到AQS源码详解</span>
            <span class="post-date" title="2024-10-15 19:42:07">2024/10/15</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/3e0d7592.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="11-JUC进阶-Synchronized与锁升级">11-JUC进阶-Synchronized与锁升级</span>
            <span class="post-date" title="2024-10-06 09:28:00">2024/10/06</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/4502cffa.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="10-JUC进阶-Java对象内存布局和对象头">10-JUC进阶-Java对象内存布局和对象头</span>
            <span class="post-date" title="2024-10-04 09:54:40">2024/10/04</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/4de6a39b.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="09-JUC进阶-ThreadLocal">09-JUC进阶-ThreadLocal</span>
            <span class="post-date" title="2024-10-01 20:39:10">2024/10/01</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/72329cf5.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="08-JUC进阶-常用的原子操作类(18个)">08-JUC进阶-常用的原子操作类(18个)</span>
            <span class="post-date" title="2024-09-28 13:37:09">2024/09/28</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/5e3757c1.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="07-JUC进阶-CAS">07-JUC进阶-CAS</span>
            <span class="post-date" title="2024-09-26 19:37:00">2024/09/26</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/546d628d.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="06-JUC进阶-Volatile与Java内存模型">06-JUC进阶-Volatile与Java内存模型</span>
            <span class="post-date" title="2024-09-25 19:01:01">2024/09/25</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/1f2e0014.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="05-JUC进阶-Java内存模型-JMM">05-JUC进阶-Java内存模型-JMM</span>
            <span class="post-date" title="2024-09-23 23:01:07">2024/09/23</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/19653fb9.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="04-JUC进阶-LockSupport与线程中断">04-JUC进阶-LockSupport与线程中断</span>
            <span class="post-date" title="2024-09-23 20:51:50">2024/09/23</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/219e52ea.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="03-JUC进阶-Java中的锁的解析">03-JUC进阶-Java中的锁的解析</span>
            <span class="post-date" title="2024-09-21 14:15:20">2024/09/21</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/7e2d78eb.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="02-JUC进阶-CompletableFuture">02-JUC进阶-CompletableFuture</span>
            <span class="post-date" title="2024-09-18 22:50:00">2024/09/18</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/3d102971.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="01-JUC进阶-线程基础">01-JUC进阶-线程基础</span>
            <span class="post-date" title="2024-09-18 22:32:00">2024/09/18</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/37d56d14.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="11-CompletableFuture">11-CompletableFuture</span>
            <span class="post-date" title="2024-09-16 16:12:00">2024/09/16</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/31919959.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="10-Fork/Join">10-Fork/Join</span>
            <span class="post-date" title="2024-09-16 13:10:00">2024/09/16</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/a0197c15.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="09-ThreadPool-线程池">09-ThreadPool-线程池</span>
            <span class="post-date" title="2024-09-13 20:10:08">2024/09/13</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/a6760d1f.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="08-阻塞队列BlockingQueue">08-阻塞队列BlockingQueue</span>
            <span class="post-date" title="2024-09-07 17:30:00">2024/09/07</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/838e7581.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="07-JUC辅助类CountDownLatch、CyclicBarrier、Semaphore">07-JUC辅助类CountDownLatch、CyclicBarrier、Semaphore</span>
            <span class="post-date" title="2024-09-07 13:00:00">2024/09/07</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/f60e37c5.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="06-Callable &amp; Future 接口">06-Callable &amp; Future 接口</span>
            <span class="post-date" title="2024-09-06 22:10:00">2024/09/06</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/f184587f.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="05-公平锁和非公平锁，死锁，可重入锁">05-公平锁和非公平锁，死锁，可重入锁</span>
            <span class="post-date" title="2024-09-05 20:12:00">2024/09/05</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/9a09d992.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="04-集合的线程安全">04-集合的线程安全</span>
            <span class="post-date" title="2024-09-04 21:09:05">2024/09/04</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/bd2134da.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="03-线程间通信">03-线程间通信</span>
            <span class="post-date" title="2024-09-04 20:06:00">2024/09/04</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/850dac3c.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="02-Lock接口">02-Lock接口</span>
            <span class="post-date" title="2024-08-30 19:27:00">2024/08/30</span>
        </a>
        
        
        <a  class="全部文章 JUC "
           href="/blog/4e6bd685.html"
           data-tag="java,juc"
           data-author="" >
            <span class="post-title" title="01-多线程的基本概念">01-多线程的基本概念</span>
            <span class="post-date" title="2024-08-30 19:03:01">2024/08/30</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/1b0522f4.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第二十五章-分析GC日志">第二十五章-分析GC日志</span>
            <span class="post-date" title="2024-08-28 21:36:08">2024/08/28</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/944806143.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第二十四章-JVM运行时参数">第二十四章-JVM运行时参数</span>
            <span class="post-date" title="2024-08-27 18:30:10">2024/08/27</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/490498600.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第二十三章-使用OQL语言查询对象信息">第二十三章-使用OQL语言查询对象信息</span>
            <span class="post-date" title="2024-08-24 15:02:10">2024/08/24</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/1471620196.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第二十三章-浅堆-深堆-内存泄漏">第二十三章-浅堆-深堆-内存泄漏</span>
            <span class="post-date" title="2024-08-24 13:04:37">2024/08/24</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/971417975.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第二十三章-JVM监控及诊断工具-GUI篇">第二十三章-JVM监控及诊断工具-GUI篇</span>
            <span class="post-date" title="2024-08-16 21:00:00">2024/08/16</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/2165702380.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第二十二章-JVM监控及诊断工具-命令行篇">第二十二章-JVM监控及诊断工具-命令行篇</span>
            <span class="post-date" title="2024-08-12 19:36:32">2024/08/12</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/2681163762.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第二十一章-性能监控与调优概述">第二十一章-性能监控与调优概述</span>
            <span class="post-date" title="2024-08-12 19:13:06">2024/08/12</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/3537043756.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第二十章-再谈类的加载器">第二十章-再谈类的加载器</span>
            <span class="post-date" title="2024-08-10 13:43:10">2024/08/10</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/3387211378.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十九章-类的加载过程详解">第十九章-类的加载过程详解</span>
            <span class="post-date" title="2024-08-02 19:33:27">2024/08/02</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/1107503247.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十八章-字节码指令集与解析指令">第十八章-字节码指令集与解析指令</span>
            <span class="post-date" title="2024-08-01 01:40:02">2024/08/01</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/2772873157.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十七章-使用javap指令解析class文件">第十七章-使用javap指令解析class文件</span>
            <span class="post-date" title="2024-07-22 23:54:00">2024/07/22</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/143162370.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十六章-Class文件结构">第十六章-Class文件结构</span>
            <span class="post-date" title="2024-07-15 19:54:50">2024/07/15</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/309245330.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十五章-GC日志分析">第十五章-GC日志分析</span>
            <span class="post-date" title="2024-07-13 08:34:00">2024/07/13</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/1750792302.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十四章-垃圾收集器">第十四章-垃圾收集器</span>
            <span class="post-date" title="2024-07-10 19:27:00">2024/07/10</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/blog/484946532.html"
           data-tag="算法,合并有序链表"
           data-author="" >
            <span class="post-title" title="合并两个有序链表">合并两个有序链表</span>
            <span class="post-date" title="2024-07-06 09:11:00">2024/07/06</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/blog/2929260443.html"
           data-tag="算法,链表"
           data-author="" >
            <span class="post-title" title="链表反转">链表反转</span>
            <span class="post-date" title="2024-07-05 19:45:45">2024/07/05</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/blog/1403776474.html"
           data-tag="算法,选择排序,冒泡排序,插入排序"
           data-author="" >
            <span class="post-title" title="选择-冒泡-插入排序">选择-冒泡-插入排序</span>
            <span class="post-date" title="2024-07-03 11:02:16">2024/07/03</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/blog/2561891005.html"
           data-tag="算法,二分法"
           data-author="" >
            <span class="post-title" title="二分搜索">二分搜索</span>
            <span class="post-date" title="2024-06-29 10:04:10">2024/06/29</span>
        </a>
        
        
        <a  class="全部文章 算法 "
           href="/blog/2224151177.html"
           data-tag="算法,二进制,位运算"
           data-author="" >
            <span class="post-title" title="二进制和位运算">二进制和位运算</span>
            <span class="post-date" title="2024-06-20 08:04:00">2024/06/20</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/2105268063.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十三章-垃圾回收相关概念">第十三章-垃圾回收相关概念</span>
            <span class="post-date" title="2024-01-14 14:27:00">2024/01/14</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/364508352.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十二章-垃圾回收概述和相关算法">第十二章-垃圾回收概述和相关算法</span>
            <span class="post-date" title="2024-01-06 16:28:00">2024/01/06</span>
        </a>
        
        
        <a  class="全部文章 linux "
           href="/blog/2050535563.html"
           data-tag="linux,jenkins"
           data-author="" >
            <span class="post-title" title="Jenkins的安装和搭建自动化部署平台">Jenkins的安装和搭建自动化部署平台</span>
            <span class="post-date" title="2024-01-05 16:00:00">2024/01/05</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/2388209687.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十一章-StringTable(字符串常量池)">第十一章-StringTable(字符串常量池)</span>
            <span class="post-date" title="2023-12-25 17:27:06">2023/12/25</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/3385856233.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第十章-执行引擎">第十章-执行引擎</span>
            <span class="post-date" title="2023-12-23 20:03:00">2023/12/23</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/4075763684.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第九章-对象的实例化内存布局与访问定位">第九章-对象的实例化内存布局与访问定位</span>
            <span class="post-date" title="2023-12-21 11:50:00">2023/12/21</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/3720767522.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第八章-直接内存">第八章-直接内存</span>
            <span class="post-date" title="2023-12-20 17:03:00">2023/12/20</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/105864584.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第七章-方法区">第七章-方法区</span>
            <span class="post-date" title="2023-12-14 18:24:00">2023/12/14</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/543408063.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第六章-JVM堆">第六章-JVM堆</span>
            <span class="post-date" title="2023-12-02 08:01:00">2023/12/02</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/554039338.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第五章-本地方法接口">第五章-本地方法接口</span>
            <span class="post-date" title="2023-11-30 17:55:00">2023/11/30</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/1123461525.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第四章-虚拟机栈">第四章-虚拟机栈</span>
            <span class="post-date" title="2023-11-28 20:55:00">2023/11/28</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/1626061462.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第三章-运行时数据区">第三章-运行时数据区</span>
            <span class="post-date" title="2023-11-28 19:31:00">2023/11/28</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/222077543.html"
           data-tag="java,jvm,双亲委派机制"
           data-author="" >
            <span class="post-title" title="第二章-JVM类加载子系统">第二章-JVM类加载子系统</span>
            <span class="post-date" title="2023-11-25 14:35:00">2023/11/25</span>
        </a>
        
        
        <a  class="全部文章 JVM "
           href="/blog/1897413233.html"
           data-tag="java,jvm"
           data-author="" >
            <span class="post-title" title="第一章-JVM和Java体系结构">第一章-JVM和Java体系结构</span>
            <span class="post-date" title="2023-11-25 10:00:00">2023/11/25</span>
        </a>
        
        
        <a  class="全部文章 Hexo "
           href="/blog/4179015178.html"
           data-tag="hexo,github pages,sitemap"
           data-author="" >
            <span class="post-title" title="给博客网站添加站点地图-sitemap">给博客网站添加站点地图-sitemap</span>
            <span class="post-date" title="2023-11-21 20:00:00">2023/11/21</span>
        </a>
        
        
        <a  class="全部文章 Hexo Typora "
           href="/blog/877664098.html"
           data-tag="hexo,typora,github"
           data-author="" >
            <span class="post-title" title="Typora设置图片自动上传Github">Typora设置图片自动上传Github</span>
            <span class="post-date" title="2023-11-20 20:30:00">2023/11/20</span>
        </a>
        
        
        <a  class="全部文章 Hexo "
           href="/blog/3069199997.html"
           data-tag="hexo,github pages"
           data-author="" >
            <span class="post-title" title="Hexo主题常用配置">Hexo主题常用配置</span>
            <span class="post-date" title="2023-11-20 00:00:01">2023/11/20</span>
        </a>
        
        
        <a  class="全部文章 Hexo "
           href="/blog/2016918085.html"
           data-tag="hexo,github pages"
           data-author="" >
            <span class="post-title" title="Hexo博客安装主题">Hexo博客安装主题</span>
            <span class="post-date" title="2023-11-20 00:00:01">2023/11/20</span>
        </a>
        
        
        <a  class="全部文章 Hexo "
           href="/blog/3070587776.html"
           data-tag="hexo,github pages"
           data-author="" >
            <span class="post-title" title="基于Hexo和Github Pages搭建个人博客">基于Hexo和Github Pages搭建个人博客</span>
            <span class="post-date" title="2023-11-18 15:40:20">2023/11/18</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-k8s/015-K8S-Prometheus部署及监控告警" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">015-K8S-Prometheus部署及监控告警</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="k8s">k8s</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color1">linux</a>
            
            <a class="color2">Docker</a>
            
            <a class="color1">Rocky</a>
            
            <a class="color1">Prometheus</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2025-07-24 21:06:41'>2025-07-19 16:39</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:21.9k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-text">一、简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%83%A8%E7%BD%B2-StorageClass"><span class="toc-text">二、部署 StorageClass</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85NFS"><span class="toc-text">1. 安装NFS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%AE%89%E8%A3%85-NFS-%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.1 安装 NFS 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%88%9B%E5%BB%BA%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95"><span class="toc-text">1.2 创建共享目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E7%BC%96%E8%BE%91%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95%E8%AF%BB%E5%86%99%E9%85%8D%E7%BD%AE"><span class="toc-text">1.3 编辑共享目录读写配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%90%AF%E5%8A%A8NFS%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.4 启动NFS服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E6%B5%8B%E8%AF%95-NFS-%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD"><span class="toc-text">1.5 测试 NFS 目录挂载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA-StorageClass"><span class="toc-text">2. 创建 StorageClass</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%83%A8%E7%BD%B2-Prometheus"><span class="toc-text">三、部署 Prometheus</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-text">1. 创建命名空间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BAPrometheus-ConfigMap"><span class="toc-text">2. 创建Prometheus ConfigMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%83%A8%E7%BD%B2-Prometheus"><span class="toc-text">3. 部署 Prometheus</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%85%8D%E7%BD%AE-Prometheus-%E6%8A%93%E5%8F%96-Ingress-Nginx-%E6%8C%87%E6%A0%87"><span class="toc-text">四、配置 Prometheus 抓取 Ingress-Nginx 指标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%BC%80%E5%90%AF-Ingress-nginx-%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3"><span class="toc-text">1、开启 Ingress-nginx 监听端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9-Prometheus-ConfigMap"><span class="toc-text">2. 修改 Prometheus ConfigMap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%88%9B%E5%BB%BA-node-exporter%EF%BC%8C%E7%9B%91%E6%8E%A7%E8%8A%82%E7%82%B9%E8%B5%84%E6%BA%90"><span class="toc-text">五、创建 node_exporter，监控节点资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%83%A8%E7%BD%B2-node-exporter"><span class="toc-text">1. 部署 node-exporter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9-Prometheus-ConfigMap-1"><span class="toc-text">2. 修改 Prometheus ConfigMap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%BD%BF%E7%94%A8-cAdvisor-%E7%9B%91%E6%8E%A7%E5%AE%B9%E5%99%A8%E8%B5%84%E6%BA%90%E6%8C%87%E6%A0%87"><span class="toc-text">六、使用 cAdvisor 监控容器资源指标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9-Prometheus-ConfigMap"><span class="toc-text">1. 修改 Prometheus ConfigMap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81Prometheus-%E7%9B%91%E6%8E%A7-kube-apiserver"><span class="toc-text">七、Prometheus 监控 kube-apiserver</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9-Prometheus-ConfigMap-1"><span class="toc-text">1. 修改 Prometheus ConfigMap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81Prometheus-%E9%80%9A%E8%BF%87-Service-%E7%9B%91%E6%8E%A7%E6%9C%8D%E5%8A%A1"><span class="toc-text">八、Prometheus 通过 Service 监控服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9-Prometheus-ConfigMap-2"><span class="toc-text">1. 修改 Prometheus ConfigMap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E9%83%A8%E7%BD%B2-kube-state-metrics%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8-Prometheus-%E7%9B%91%E6%8E%A7"><span class="toc-text">九、部署 kube-state-metrics，并使用 Prometheus 监控</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%83%A8%E7%BD%B2-kube-state-metrics"><span class="toc-text">1. 部署 kube-state-metrics</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E9%83%A8%E7%BD%B2-Grafana"><span class="toc-text">十、部署 Grafana</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E7%9B%91%E6%8E%A7-metrics-server"><span class="toc-text">十一、监控 metrics.server</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81alertmanager-%E9%83%A8%E7%BD%B2"><span class="toc-text">十二、alertmanager 部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA-alertmanager-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">1. 创建 alertmanager 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9-Prometheus-ConfigMap-2"><span class="toc-text">2. 修改 Prometheus ConfigMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9-Prometheus-Service"><span class="toc-text">3. 修改 Prometheus Service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%90%88%E5%B9%B6-altermanager-%E8%87%B3-prometheus-deploy-%E6%96%87%E4%BB%B6"><span class="toc-text">4. 合并 altermanager 至 prometheus deploy 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%B7%BB%E5%8A%A0%E6%8A%A5%E8%AD%A6%E6%BC%94%E7%A4%BA"><span class="toc-text">5. 添加报警演示</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>概要：</strong></p>
<p>简述 Loki 相关组件原理，并演示两种使用 Loki 监控Pod日志的部署方式：<strong>使用 yaml 资源清单部署</strong> 和 <strong>使用 Helm 部署</strong></p>
<p><strong>集群环境</strong></p>
<table>
<thead>
<tr>
<th>IP</th>
<th>Hostname</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>10.20.1.139</td>
<td>k8s-master01</td>
<td>Master节点</td>
</tr>
<tr>
<td>10.20.1.140</td>
<td>k8s-node01</td>
<td>Node节点</td>
</tr>
<tr>
<td>10.20.1.141</td>
<td>k8s-node02</td>
<td>Node节点</td>
</tr>
<tr>
<td>10.20.1.142</td>
<td>k8s-node03</td>
<td>Node节点</td>
</tr>
</tbody></table>
<h1 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h1><p>对于 Kubernetes 集群本身的监控也是非常重要的，我们需要时时刻刻了解集群的运行状态。</p>
<p>对于集群的监控一般我们需要考虑以下几个方面：</p>
<ul>
<li>Kubernetes 节点的监控：比如节点的 cpu、load、disk、memory 等指标</li>
<li>内部系统组件的状态：比如 kube-scheduler、kube-controller-manager、kubedns&#x2F;coredns 等组件的详细运行状态</li>
<li>编排级的 metrics：比如 Deployment 的状态、资源请求、调度和 API 延迟等数据指标</li>
</ul>
<p>Kubernetes 集群的监控方案目前主要有以下几种方案：</p>
<ul>
<li><p>cAdvisor : 是一个轻量级的容器监控工具，用于收集容器运行时的资源使用情况（如 CPU、内存、磁盘、网络等）以及性能统计数据。</p>
<ul>
<li><p>作用</p>
<ul>
<li>提供容器级别的资源使用和性能指标。</li>
<li>暴露这些指标，供其他监控工具（如 Metrics Server 或 Prometheus）采集。</li>
<li>内置于 Kubernetes 的 <strong>Kubelet</strong> 中，自动为集群中的每个节点收集容器数据。</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li><p><strong>轻量级</strong>：资源占用低，适合在每个节点运行。</p>
</li>
<li><p><strong>实时性</strong>：提供实时的容器性能数据。</p>
</li>
<li><p><strong>原生支持</strong>：在 Kubernetes 中默认集成到 Kubelet，无需单独部署。</p>
</li>
<li><p><strong>开放接口</strong>：通过 HTTP API 暴露指标，易于集成到其他监控系统。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>metrics-server : 是一个轻量级的、可扩展的组件，用于从 Kubernetes 集群中的节点和 Pod 收集资源使用情况（如 CPU 和内存）的指标数据，并通过 Kubernetes API 提供这些数据。</p>
<ul>
<li><p>作用</p>
<ul>
<li>提供实时的资源使用指标，供用户或工具（如 kubectl、HPA）查询。</li>
<li>支持基于资源使用情况的自动扩展决策。</li>
<li>替代了早期的 Heapster（已废弃），是 Kubernetes 生态系统中默认的监控数据收集工具。</li>
</ul>
</li>
<li><p>特点</p>
<ul>
<li><p>轻量级：Metrics Server 只存储内存中的瞬时数据，不持久化历史数据。</p>
</li>
<li><p>高效：通过 Kubernetes API 聚合层提供指标，易于集成。</p>
</li>
<li><p>可扩展：支持与更复杂的监控系统（如 Prometheus）集成。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>kube-state-metrics : 是一个服务，通过 Kubernetes API 收集集群中资源对象（如 Pod、Deployment、Service 等）的状态和元数据，并以 Prometheus 兼容的格式通过 HTTP 端点暴露这些指标。</p>
<ul>
<li><p>作用：</p>
<ul>
<li>提供 Kubernetes 资源对象的状态信息（如 Pod 运行状态、Deployment 副本数等）。</li>
<li>补充 cAdvisor 和 node_exporter 的功能，专注于 Kubernetes 对象的元数据而非系统或容器级资源使用。</li>
<li>支持 Prometheus 抓取数据，用于监控、告警和可视化。</li>
</ul>
</li>
<li><p>特点：</p>
<ul>
<li><p><strong>轻量级</strong>：以单一 Deployment 运行，资源占用低。</p>
</li>
<li><p><strong>专注于状态</strong>：提供资源对象的元数据和状态（如 Pod 是否 Running、Job 是否完成）。</p>
</li>
<li><p><strong>Prometheus 集成</strong>：通过 &#x2F;metrics 端点暴露数据，易于与 Prometheus 和 Grafana 集成。</p>
</li>
<li><p><strong>动态更新</strong>：实时监听 Kubernetes API 的资源变化。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>node_exporter : 一个 Prometheus 导出器（exporter），专门用于收集主机（节点）的系统级指标，如 CPU、内存、磁盘、网络、文件系统等，并以 Prometheus 兼容的格式通过 HTTP 端点暴露这些指标。</p>
<ul>
<li><strong>作用</strong>：<ul>
<li>提供节点级别的详细系统监控数据，弥补 Kubernetes Metrics Server 和 cAdvisor 的局限性（后者主要聚焦于容器指标）。</li>
<li>支持 Prometheus 抓取指标，用于长期存储、分析和可视化。</li>
<li>广泛用于 Kubernetes 集群、裸机或虚拟机环境的监控。</li>
</ul>
</li>
<li><strong>特点</strong>：<ul>
<li><strong>轻量级</strong>：资源占用低，适合在每个节点运行。</li>
<li><strong>模块化</strong>：支持多种收集器（collector），可按需启用或禁用。</li>
<li><strong>跨平台</strong>：主要支持 Linux，也支持部分 Unix 系统（如 macOS、FreeBSD）。</li>
<li><strong>Prometheus 集成</strong>：通过标准化的 &#x2F;metrics 端点暴露数据，易于与 Prometheus 和 Grafana 集成。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>不过 kube-state-metrics 和 metrics-server 之间还是有很大不同的，二者的主要区别如下：</p>
<ul>
<li>kube-state-metrics 主要关注的是业务相关的一些元数据，比如 Deployment、Pod、副本状态等</li>
<li>metrics-server 主要关注的是<a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/instrumentation/resource-metrics-api.md">资源度量 API</a> 的实现，比如 CPU、文件描述符、内存、请求延时等指标</li>
</ul>
<h1 id="二、部署-StorageClass"><a href="#二、部署-StorageClass" class="headerlink" title="二、部署 StorageClass"></a>二、部署 StorageClass</h1><h2 id="1-安装NFS"><a href="#1-安装NFS" class="headerlink" title="1. 安装NFS"></a>1. 安装NFS</h2><p>安装 NFS,配置存储卷自动分配 PV，用于持久化日志数据。</p>
<p>这里选用 k8s-master (10.20.1.139) 作为 nfs 服务端，其它节点作为 nfs 客户端</p>
<h3 id="1-1-安装-NFS-服务"><a href="#1-1-安装-NFS-服务" class="headerlink" title="1.1 安装 NFS 服务"></a>1.1 安装 NFS 服务</h3><blockquote>
<p>master节点、node01、node02、node03 节点都需要安装执行</p>
</blockquote>
<pre><code class="highlight bash">$ yum install -y nfs-utils rpcbind</code></pre>



<h3 id="1-2-创建共享目录"><a href="#1-2-创建共享目录" class="headerlink" title="1.2 创建共享目录"></a>1.2 创建共享目录</h3><blockquote>
<p>仅在 nfs 服务端 (master节点) 执行</p>
</blockquote>
<pre><code class="highlight bash"><span class="comment"># 创建 共享目录</span>
$ <span class="built_in">mkdir</span> -p /root/data/prometheus/

<span class="comment"># 目录提权</span>
<span class="built_in">chmod</span> 777 /root/data/prometheus/

<span class="comment"># 变更用户组</span>
<span class="built_in">chown</span> nobody /root/data/prometheus/</code></pre>



<h3 id="1-3-编辑共享目录读写配置"><a href="#1-3-编辑共享目录读写配置" class="headerlink" title="1.3 编辑共享目录读写配置"></a>1.3 编辑共享目录读写配置</h3><blockquote>
<p>仅在 nfs 服务端 (master节点) 执行</p>
</blockquote>
<pre><code class="highlight bash">$ vim /etc/exports

/root/data     10.20.1.0/24(rw,fsid=0,no_root_squash)
/root/data/prometheus       10.20.1.0/24(rw,no_root_squash,no_all_squash,no_subtree_check,<span class="built_in">sync</span>)</code></pre>

<p>这里使用的是 NFS4 服务，上面的配置表示 10.20.1.0&#x2F;24 网段的 ip 都可以与 nfs 主服务器共享 <code>/root/data/prometheus</code> 目录内容</p>
<h3 id="1-4-启动NFS服务"><a href="#1-4-启动NFS服务" class="headerlink" title="1.4 启动NFS服务"></a>1.4 启动NFS服务</h3><blockquote>
<p>集群内所有节点都需要操作</p>
</blockquote>
<pre><code class="highlight bash"> <span class="comment"># 启动服务</span>
$ systemctl start rpcbind
$ systemctl restart nfs-server.service

<span class="comment"># 设置开机自启</span>
$ systemctl <span class="built_in">enable</span> rpcbind
$ systemctl <span class="built_in">enable</span> nfs-server.service</code></pre>



<h3 id="1-5-测试-NFS-目录挂载"><a href="#1-5-测试-NFS-目录挂载" class="headerlink" title="1.5 测试 NFS 目录挂载"></a>1.5 测试 NFS 目录挂载</h3><pre><code class="highlight bash"><span class="comment"># NFS 客户端执行：创建目录</span>
$ <span class="built_in">mkdir</span> /data/test1

<span class="comment"># NFS 客户端执行：挂载目录到NFS服务端</span>
$ mount -t nfs4 10.20.1.139:/prometheus /data/test1

<span class="comment"># NFS 客户端执行：查看挂载结果</span>
$ mount | grep /data/test1
10.20.1.139:/prometheus on /data/test1 <span class="built_in">type</span> nfs4 (rw,relatime,vers=4.2,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.20.1.141,local_lock=none,addr=10.20.1.139)

<span class="comment"># NFS 客户端执行：写入数据</span>
$ <span class="built_in">echo</span> <span class="string">&quot;this is client&quot;</span> &gt; /data/test1/a.txt

<span class="comment"># NFS 服务端执行：查看数据， 结论：客户端数据已写入服务端挂载目录</span>
$ <span class="built_in">cat</span> /root/data/prometheus/a.txt 
this is client

<span class="comment"># NFS 服务端执行：写入数据</span>
$ <span class="built_in">echo</span> <span class="string">&quot;This is Server&quot;</span> &gt;&gt; /root/data/prometheus/a.txt

<span class="comment"># NFS 客户端执行：查看数据， 结论：服务端数据已写入客户端挂载目录</span>
$ <span class="built_in">cat</span> /data/test1/a.txt
this is client
This is Server</code></pre>



<p><strong>取消挂载</strong></p>
<pre><code class="highlight bash"><span class="comment"># 取消挂载</span>
umount /data/test1


<span class="comment"># 如果取消挂载出现报错，例如：</span>
$ umount /data/test1
umount.nfs4: /data/test1: device is busy
<span class="comment"># 查看目录占用进程</span>
$ fuser -m /data/test1
/data/test1:         32679c
<span class="comment"># kill 进程</span>
$ <span class="built_in">kill</span> -9 32679


<span class="comment"># 方式二：强制卸载</span>
umount -l /data/test1</code></pre>



<h2 id="2-创建-StorageClass"><a href="#2-创建-StorageClass" class="headerlink" title="2. 创建 StorageClass"></a>2. 创建 StorageClass</h2><p>资源清单：<code>prometheus-storage.yaml</code></p>
<pre><code class="highlight yaml"><span class="comment"># 1.命名空间</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">Namespace</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-storage</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 2.存储类</span>
<span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">StorageClass</span>
<span class="attr">metadata:</span>
  <span class="attr">namespace:</span> <span class="string">prometheus-storage</span>
  <span class="attr">name:</span> <span class="string">prometheus-storage</span>
<span class="comment"># provisioner: nfs-provisioner</span>
<span class="attr">provisioner:</span> <span class="string">k8s-sigs.io/nfs-subdir-external-provisioner</span> <span class="comment"># 指定动态配置器，NFS 子目录外部配置器</span>
<span class="attr">parameters:</span>
  <span class="attr">pathPattern:</span> <span class="string">$&#123;.PVC.namespace&#125;/$&#123;.PVC.name&#125;</span> <span class="comment"># 动态生成的 NFS 路径，格式为 &lt;PVC 命名空间&gt;/&lt;PVC 名称&gt;，例如 loki-storageclass/test-claim。</span>
  <span class="attr">archiveOnDelete:</span> <span class="string">&quot;true&quot;</span> <span class="comment">##删除 pv,pv内容是否备份</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 3.NFS 动态存储配置器，用于自动为 PVC 创建 PV</span>
<span class="attr">apiVersion:</span> <span class="string">apps/v1</span>
<span class="attr">kind:</span> <span class="string">Deployment</span>
<span class="attr">metadata:</span>
  <span class="attr">namespace:</span> <span class="string">prometheus-storage</span>
  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span> <span class="comment"># NFS 动态存储配置器，用于自动为 PVC 创建 PV</span>
<span class="attr">spec:</span>
  <span class="attr">replicas:</span> <span class="number">1</span>
  <span class="attr">selector:</span>
    <span class="attr">matchLabels:</span>
      <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span>
  <span class="attr">template:</span>
    <span class="attr">metadata:</span>
      <span class="attr">labels:</span>
        <span class="attr">app:</span> <span class="string">nfs-client-provisioner</span>
    <span class="attr">spec:</span>
      <span class="attr">serviceAccountName:</span> <span class="string">nfs-client-provisioner</span> <span class="comment"># 指定使用的 ServiceAccountName</span>
      <span class="attr">containers:</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span>
          <span class="attr">image:</span> <span class="string">k8s.dockerproxy.com/sig-storage/nfs-subdir-external-provisioner:v4.0.2</span>
          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>
          <span class="attr">volumeMounts:</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span> <span class="comment"># 挂载的卷名称，与 volumes 部分定义的卷对应</span>
              <span class="attr">mountPath:</span> <span class="string">/persistentvolumes</span> <span class="comment"># 将 NFS 卷挂载到容器内的 /persistentvolumes 路径，供容器读写 NFS 共享数据。</span>
          <span class="attr">env:</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span>
              <span class="attr">value:</span> <span class="string">k8s-sigs.io/nfs-subdir-external-provisioner</span> <span class="comment"># 指定配置器名称，与 StorageClass 保持一致</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_SERVER</span>
              <span class="attr">value:</span> <span class="number">10.20</span><span class="number">.1</span><span class="number">.139</span> <span class="comment"># NFS 服务器地址</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_PATH</span>
              <span class="attr">value:</span> <span class="string">/root/data/prometheus</span> <span class="comment"># NFS 共享路径</span>
      <span class="attr">volumes:</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-client-root</span> <span class="comment"># 定义一个名为 nfs-client-root 的 NFS 卷，连接到 NFS 服务器的指定地址和路径</span>
          <span class="attr">nfs:</span>
            <span class="attr">server:</span> <span class="number">10.20</span><span class="number">.1</span><span class="number">.139</span> <span class="comment"># NFS 服务器地址</span>
            <span class="attr">path:</span> <span class="string">/root/data/prometheus</span> <span class="comment"># NFS 共享路径</span>
      <span class="attr">nodeSelector:</span> <span class="comment"># 指定Pod运行的节点</span>
        <span class="attr">kubernetes.io/hostname:</span> <span class="string">k8s-node01</span>
      <span class="comment"># nodeName: k8s-node01 # 指定 Pod 运行在 k8s-node01 节点上</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 4.服务账户</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ServiceAccount</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span> <span class="comment"># SA 的名称</span>
  <span class="attr">namespace:</span> <span class="string">prometheus-storage</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 5.集群角色</span>
<span class="attr">kind:</span> <span class="string">ClusterRole</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">nfs-client-provisioner-runner</span>
<span class="attr">rules:</span>
  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]
    <span class="attr">resources:</span> [<span class="string">&quot;nodes&quot;</span>]
    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]
  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]
    <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumes&quot;</span>]
    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;delete&quot;</span>]
  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]
    <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumeclaims&quot;</span>]
    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;update&quot;</span>]
  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]
    <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>]
    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>]
  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]
    <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]
    <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 6.集群角色绑定</span>
<span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">run-nfs-client-provisioner</span>
<span class="attr">subjects:</span>
  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span> <span class="comment"># 绑定类型 ServiceAccount</span>
    <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span> <span class="comment"># ServiceAccount 的名称</span>
    <span class="attr">namespace:</span> <span class="string">prometheus-storage</span>
<span class="attr">roleRef:</span>
  <span class="attr">kind:</span> <span class="string">ClusterRole</span> <span class="comment"># 绑定的角色类型</span>
  <span class="attr">name:</span> <span class="string">nfs-client-provisioner-runner</span> <span class="comment"># 集群角色名称 nfs-client-provisioner-runner</span>
  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 角色</span>
<span class="attr">kind:</span> <span class="string">Role</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">leader-locking-nfs-client-provisioner</span> <span class="comment"># 角色的名称，表明它与 NFS 客户端存储提供者的领导者选举（leader election）机制相关。</span>
  <span class="attr">namespace:</span> <span class="string">prometheus-storage</span>
<span class="attr">rules:</span>
  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>] <span class="comment"># 空字符串表示核心 API 组（core API group），包含 Kubernetes 的基本资源，如 endpoints。</span>
    <span class="attr">resources:</span> [<span class="string">&quot;endpoints&quot;</span>]
    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>]

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># SA角色绑定</span>
<span class="attr">kind:</span> <span class="string">RoleBinding</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">run-leader-locking-nfs-client-provisioner</span>
  <span class="attr">namespace:</span> <span class="string">prometheus-storage</span>
<span class="attr">subjects:</span>
  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span> <span class="comment"># 绑定资源类型为 ServiceAccount</span>
    <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span> <span class="comment"># 绑定的ServiceAccount 名称</span>
    <span class="attr">namespace:</span> <span class="string">prometheus-storage</span>
<span class="attr">roleRef:</span>
  <span class="attr">kind:</span> <span class="string">Role</span> <span class="comment"># 绑定角色（loki-storage名称空间的角色）</span>
  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>
  <span class="attr">name:</span> <span class="string">leader-locking-nfs-client-provisioner</span> <span class="comment"># 角色的名称</span></code></pre>



<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 创建 StorageClass</span>
$ kubectl apply -f prometheus-storage.yaml

<span class="comment"># 查看 StorageClass</span>
$ kubectl get StorageClass
NAME                 PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
loki-storage         k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           <span class="literal">false</span>                  5d21h
nfs-client           k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           <span class="literal">false</span>                  6d5h
prometheus-storage   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           <span class="literal">false</span>                  11m


<span class="comment"># 查看 Pod</span>
$ kubectl get pods -n prometheus-storage -o wide
NAME                                      READY   STATUS    RESTARTS   AGE   IP               NODE         NOMINATED NODE   READINESS GATES
nfs-client-provisioner-6cb79b9755-7q2t4   1/1     Running   0          11m   192.168.85.207   k8s-node01   &lt;none&gt;           &lt;none&gt;</code></pre>





<h1 id="三、部署-Prometheus"><a href="#三、部署-Prometheus" class="headerlink" title="三、部署 Prometheus"></a>三、部署 Prometheus</h1><h2 id="1-创建命名空间"><a href="#1-创建命名空间" class="headerlink" title="1. 创建命名空间"></a>1. 创建命名空间</h2><p>资源清单：<code>kube-ops.yaml</code></p>
<pre><code class="highlight yaml"><span class="comment"># 1.命名空间</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">Namespace</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">kube-ops</span></code></pre>

<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单</span>
$ kubectl apply -f kube-ops.yaml

<span class="comment"># 查看命名空间</span>
$ kubectl get namespace | grep kube-ops
kube-ops             Active   50s</code></pre>





<h2 id="2-创建Prometheus-ConfigMap"><a href="#2-创建Prometheus-ConfigMap" class="headerlink" title="2. 创建Prometheus ConfigMap"></a>2. 创建Prometheus ConfigMap</h2><p>资源清单：<code>prometheus-cm.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">prometheus.yml:</span> <span class="string">|</span>           <span class="comment"># 使用 | 表示 YAML 中的多行文本</span>
    <span class="attr">global:</span>                   <span class="comment"># 定义 Prometheus 的全局配置，适用于所有抓取任务（除非在具体任务中被覆盖）</span>
      <span class="attr">scrape_interval:</span> <span class="string">15s</span>    <span class="comment"># 表示 prometheus 抓取指标数据的频率，默认是 15s</span>
      <span class="attr">scrape_timeout:</span> <span class="string">15s</span>     <span class="comment"># 表示 prometheus 抓取指标数据的超时时间，默认是 15s</span>
    <span class="attr">scrape_configs:</span>
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span>  <span class="comment"># 定义任务名，这里监控 prometheus 自身</span>
      <span class="attr">static_configs:</span>
      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</code></pre>

<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单</span>
$ kubectl apply -f prometheus-cm.yaml

<span class="comment"># 查看 ConfigMap</span>
$ kubectl get cm -n kube-ops
NAME                DATA   AGE
kube-root-ca.crt    1      32m
prometheus-config   1      38s</code></pre>





<h2 id="3-部署-Prometheus"><a href="#3-部署-Prometheus" class="headerlink" title="3. 部署 Prometheus"></a>3. 部署 Prometheus</h2><p>资源清单：<code>prometheus.yaml</code></p>
<pre><code class="highlight yaml"><span class="comment"># 定义 PVC</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">spec:</span>
  <span class="attr">storageClassName:</span> <span class="string">prometheus-storage</span>  <span class="comment"># 指定使用的 StorageClass</span>
  <span class="attr">accessModes:</span>
    <span class="bullet">-</span> <span class="string">ReadWriteMany</span>                     <span class="comment"># 存储卷可以被多个节点（Node）以读写模式同时挂载</span>
  <span class="attr">resources:</span>
    <span class="attr">requests:</span>
      <span class="attr">storage:</span> <span class="string">10Gi</span>                     <span class="comment"># 定义 PVC 请求的资源量，这里特指存储容量</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 创建 SA</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ServiceAccount</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 集群角色</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">ClusterRole</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
<span class="attr">rules:</span>
  <span class="bullet">-</span> <span class="attr">apiGroups:</span>
      <span class="bullet">-</span> <span class="string">&quot;&quot;</span>
    <span class="attr">resources:</span>
      <span class="bullet">-</span> <span class="string">nodes</span>
      <span class="bullet">-</span> <span class="string">services</span>
      <span class="bullet">-</span> <span class="string">endpoints</span>
      <span class="bullet">-</span> <span class="string">pods</span>
      <span class="bullet">-</span> <span class="string">nodes/proxy</span>
    <span class="attr">verbs:</span>
      <span class="bullet">-</span> <span class="string">get</span>
      <span class="bullet">-</span> <span class="string">list</span>
      <span class="bullet">-</span> <span class="string">watch</span>
  <span class="bullet">-</span> <span class="attr">apiGroups:</span>
      <span class="bullet">-</span> <span class="string">&quot;&quot;</span>
    <span class="attr">resources:</span>
      <span class="bullet">-</span> <span class="string">configmaps</span>
      <span class="bullet">-</span> <span class="string">nodes/metrics</span>
    <span class="attr">verbs:</span>
      <span class="bullet">-</span> <span class="string">get</span>
  <span class="bullet">-</span> <span class="attr">nonResourceURLs:</span>
      <span class="bullet">-</span> <span class="string">/metrics</span>
    <span class="attr">verbs:</span>
      <span class="bullet">-</span> <span class="string">get</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 集群角色绑定</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
<span class="attr">roleRef:</span>
  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>
  <span class="attr">kind:</span> <span class="string">ClusterRole</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
<span class="attr">subjects:</span>
  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span>
    <span class="attr">name:</span> <span class="string">prometheus</span>
    <span class="attr">namespace:</span> <span class="string">kube-ops</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># Deployment</span>
<span class="attr">apiVersion:</span> <span class="string">apps/v1</span>
<span class="attr">kind:</span> <span class="string">Deployment</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
  <span class="attr">labels:</span>
    <span class="attr">app:</span> <span class="string">prometheus</span>
<span class="attr">spec:</span>
  <span class="attr">replicas:</span> <span class="number">1</span>               <span class="comment"># Pod 副本数为1</span>
  <span class="attr">selector:</span>
    <span class="attr">matchLabels:</span>
      <span class="attr">app:</span> <span class="string">prometheus</span>
  <span class="attr">template:</span>
    <span class="attr">metadata:</span>
      <span class="attr">labels:</span>
        <span class="attr">app:</span> <span class="string">prometheus</span>
    <span class="attr">spec:</span>
      <span class="attr">serviceAccountName:</span> <span class="string">prometheus</span>    <span class="comment"># 指定 Pod 使用的 Kubernetes 服务账号（ServiceAccount）为 prometheus</span>
      <span class="attr">containers:</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus</span>
          <span class="attr">image:</span> <span class="string">prom/prometheus:v2.4.3</span>
          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>
          <span class="attr">command:</span>
            <span class="bullet">-</span> <span class="string">&quot;/bin/prometheus&quot;</span>         <span class="comment"># 指定容器启动时运行的命令为 /bin/prometheus，这是 Prometheus 的主可执行文件</span>
          <span class="attr">args:</span>
            <span class="bullet">-</span> <span class="string">&quot;--config.file=/etc/prometheus/prometheus.yml&quot;</span>    <span class="comment"># 指定 Prometheus 的配置文件路径为 /etc/prometheus/prometheus.yml，这个文件由 ConfigMap（prometheus-config）提供，挂载到容器内</span>
            <span class="bullet">-</span> <span class="string">&quot;--storage.tsdb.path=/prometheus&quot;</span>                 <span class="comment"># 指定 Prometheus 时间序列数据库（TSDB）的存储路径为 /prometheus，这个路径由 PVC（prometheus）提供，持久化存储数据</span>
            <span class="bullet">-</span> <span class="string">&quot;--storage.tsdb.retention=24h&quot;</span>                    <span class="comment"># 设置数据保留时间为 24 小时，意味着 Prometheus 只保留最近 24 小时的监控数据，旧数据将被删除。生产环境建议 15-30天</span>
            <span class="bullet">-</span> <span class="string">&quot;--web.enable-admin-api&quot;</span>                          <span class="comment"># 启用 Prometheus 的 Admin HTTP API，允许执行管理操作（如删除时间序列）</span>
            <span class="bullet">-</span> <span class="string">&quot;--web.enable-lifecycle&quot;</span>                          <span class="comment"># 启用生命周期 API，支持通过 HTTP 请求（如 localhost:9090/-/reload）动态重新加载配置文件。</span>
          <span class="attr">ports:</span>
            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9090</span>       <span class="comment"># 指定 Prometheus 监听端口，用于提供 Web UI 和 API</span>
              <span class="attr">protocol:</span> <span class="string">TCP</span>
              <span class="attr">name:</span> <span class="string">http</span>
          <span class="attr">volumeMounts:</span>                 <span class="comment"># 定义容器内的挂载点，将卷挂载到指定路径</span>
            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/prometheus&quot;</span>  <span class="comment"># 将名为 data 的卷挂载到容器内的 /prometheus 路径，用于存储 TSDB 数据</span>
              <span class="attr">subPath:</span> <span class="string">prometheus</span>       <span class="comment"># 表示使用卷中的子路径 prometheus，避免覆盖整个卷的其他内容</span>
              <span class="attr">name:</span> <span class="string">data</span>                <span class="comment"># 卷由 PVC（prometheus）提供</span>
            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/etc/prometheus&quot;</span>      <span class="comment"># 将名为 config-volume 的卷挂载到容器内的 /etc/prometheus 路径，用于存储配置文件</span>
              <span class="attr">name:</span> <span class="string">config-volume</span>               <span class="comment"># 由 ConfigMap（prometheus-config）提供</span>
          <span class="attr">resources:</span>
            <span class="attr">requests:</span>
              <span class="attr">cpu:</span> <span class="string">100m</span>                 <span class="comment"># 请求 100 毫核（0.1 CPU 核心），表示容器需要的最小 CPU 资源</span>
              <span class="attr">memory:</span> <span class="string">512Mi</span>             <span class="comment"># 请求 512 MiB 内存，表示容器需要的最小内存</span>
            <span class="attr">limits:</span>
              <span class="attr">cpu:</span> <span class="string">100m</span>                 <span class="comment"># 限制容器最多使用 100 毫核 CPU，防止过量占用</span>
              <span class="attr">memory:</span> <span class="string">512Mi</span>             <span class="comment"># 限制容器最多使用 512 MiB 内存，防止内存溢出</span>
      <span class="attr">securityContext:</span>                  <span class="comment"># 定义 Pod 的安全上下文，控制容器运行时的权限</span>
        <span class="attr">runAsUser:</span> <span class="number">0</span>                    <span class="comment"># 指定容器以用户 ID 0（即 root 用户）运行</span>
      <span class="attr">volumes:</span>                          <span class="comment"># 定义 Pod 使用的卷，供容器挂载</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span>
          <span class="attr">persistentVolumeClaim:</span>        <span class="comment"># 指定挂载的PVC</span>
            <span class="attr">claimName:</span> <span class="string">prometheus</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span>
          <span class="attr">configMap:</span>                    <span class="comment"># 指定挂载的 configMap</span>
            <span class="attr">name:</span> <span class="string">prometheus-config</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># Service</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">Service</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
  <span class="attr">labels:</span>
    <span class="attr">app:</span> <span class="string">prometheus</span>
<span class="attr">spec:</span>
  <span class="attr">selector:</span>
    <span class="attr">app:</span> <span class="string">prometheus</span>
  <span class="attr">type:</span> <span class="string">NodePort</span>
  <span class="attr">ports:</span>
    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-prometheus</span>  <span class="comment"># 端口名称</span>
      <span class="attr">port:</span> <span class="number">9090</span>            <span class="comment"># service 对外端口 9090</span>
      <span class="attr">targetPort:</span> <span class="string">http</span>      <span class="comment"># 内部名为 http 的端口 （9090）</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># Ingress， 安装参考：https://georgechan95.github.io/blog/6436eaf1.html</span>
<span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">Ingress</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-ui</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">spec:</span>
  <span class="attr">ingressClassName:</span> <span class="string">nginx</span>           <span class="comment"># 指定 Ingress 控制器为 nginx，由 Nginx Ingress Controller 处理</span>
  <span class="attr">rules:</span>
    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">my.prometheus.com</span>       <span class="comment"># 定义一个基于域名 my.prometheus.com 的路由规则</span>
      <span class="attr">http:</span>
        <span class="attr">paths:</span>
          <span class="bullet">-</span> <span class="attr">backend:</span>
              <span class="attr">service:</span>
                <span class="attr">name:</span> <span class="string">prometheus</span>    <span class="comment"># 流量转发到 kube-ops 命名空间中的 prometheus 服务</span>
                <span class="attr">port:</span>
                  <span class="attr">number:</span> <span class="number">9090</span>
            <span class="attr">path:</span> <span class="string">/</span>                 <span class="comment"># 匹配根路径 / 及所有以 / 开头的子路径（如 /graph, /api/v1）</span>
            <span class="attr">pathType:</span> <span class="string">Prefix</span></code></pre>



<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单</span>
$ kubectl apply -f prometheus.yaml

<span class="comment"># 查看PVC</span>
$ kubectl get pvc -n kube-ops
NAME         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS         VOLUMEATTRIBUTESCLASS   AGE
prometheus   Bound    pvc-b85318bf-0ef5-449f-ab40-200238200e10   10Gi       RWX            prometheus-storage   &lt;<span class="built_in">unset</span>&gt;                 3h15m

<span class="comment"># 查看 ServiceAccount</span>
$ kubectl get serviceaccount -n kube-ops
NAME         SECRETS   AGE
default      0         4h4m
prometheus   0         3h11m

<span class="comment"># 查看 Deployment</span>
$ kubectl get deploy -n kube-ops
NAME         READY   UP-TO-DATE   AVAILABLE   AGE
prometheus   1/1     1            1           125m

<span class="comment"># 查看 Pods</span>
$ kubectl get pods -n kube-ops
NAME                          READY   STATUS    RESTARTS   AGE
prometheus-844847f5c7-7gwck   1/1     Running   0          125m

<span class="comment"># 查看 Service</span>
$ kubectl get svc -n kube-ops
NAME         TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
prometheus   NodePort   10.102.229.198   &lt;none&gt;        9090:31676/TCP   18m

<span class="comment"># 查看 Ingress</span>
$ kubectl get ingress -n kube-ops
NAME            CLASS   HOSTS               ADDRESS   PORTS   AGE
prometheus-ui   nginx   my.prometheus.com             80      9m56s</code></pre>



<p><strong>添加Host域名映射</strong></p>
<pre><code class="highlight plaintext">10.20.1.140 my.prometheus.com</code></pre>



<p><strong>浏览器访问 Prometheus</strong></p>
<p><a target="_blank" rel="noopener" href="http://my.prometheus.com/">http://my.prometheus.com/</a></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/22/20250722-193045.png" alt="Prometheus"></p>
<h1 id="四、配置-Prometheus-抓取-Ingress-Nginx-指标"><a href="#四、配置-Prometheus-抓取-Ingress-Nginx-指标" class="headerlink" title="四、配置 Prometheus 抓取 Ingress-Nginx 指标"></a>四、配置 Prometheus 抓取 Ingress-Nginx 指标</h1><h2 id="1、开启-Ingress-nginx-监听端口"><a href="#1、开启-Ingress-nginx-监听端口" class="headerlink" title="1、开启 Ingress-nginx 监听端口"></a>1、开启 Ingress-nginx 监听端口</h2><p>这里的 ingress-nginx 使用的是 helm 安装的，安装过程见：<a href="https://georgechan95.github.io/blog/6436eaf1.html">https://georgechan95.github.io/blog/6436eaf1.html</a></p>
<p>开启 Ingress-nginx 指标监听端口，默认：10254</p>
<p><strong>编辑 <code>value.yaml</code></strong></p>
<pre><code class="highlight yaml"><span class="attr">metrics:</span>
  <span class="attr">port:</span> <span class="number">10254</span>
  <span class="attr">portName:</span> <span class="string">metrics</span>
  <span class="comment"># if this port is changed, change healthz-port: in extraArgs: accordingly</span>
  <span class="attr">enabled:</span> <span class="literal">true</span></code></pre>



<p><strong>更新 Ingress-Nginx</strong></p>
<pre><code class="highlight bash">$ helm upgrade ingress-nginx -n ingress-nginx -f values.yaml .</code></pre>



<h2 id="2-修改-Prometheus-ConfigMap"><a href="#2-修改-Prometheus-ConfigMap" class="headerlink" title="2. 修改 Prometheus ConfigMap"></a>2. 修改 Prometheus ConfigMap</h2><p>资源清单：<code>prometheus-cm.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">prometheus.yml:</span> <span class="string">|</span>           <span class="comment"># 使用 | 表示 YAML 中的多行文本</span>
    <span class="attr">global:</span>                   <span class="comment"># 定义 Prometheus 的全局配置，适用于所有抓取任务（除非在具体任务中被覆盖）</span>
      <span class="attr">scrape_interval:</span> <span class="string">15s</span>    <span class="comment"># 表示 prometheus 抓取指标数据的频率，默认是 15s</span>
      <span class="attr">scrape_timeout:</span> <span class="string">15s</span>     <span class="comment"># 表示 prometheus 抓取指标数据的超时时间，默认是 15s</span>
    <span class="attr">scrape_configs:</span>
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span>  <span class="comment"># 定义任务名，这里监控 prometheus 自身</span>
      <span class="attr">static_configs:</span>
      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx140&#x27;</span>         <span class="comment"># 10.20.1.140 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.140:10254&#x27;</span>]
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx141&#x27;</span>         <span class="comment"># 10.20.1.141 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.141:10254&#x27;</span>]
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx142&#x27;</span>         <span class="comment"># 10.20.1.142 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.142:10254&#x27;</span>]</code></pre>

<p>重新执行资源清单</p>
<p>方式一：</p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单</span>
$ kubectl apply -f prometheus-cm.yaml

$ kubectl get svc -n kube-ops
NAME         TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
prometheus   NodePort   10.102.229.198   &lt;none&gt;        9090:31676/TCP   111m

<span class="comment"># 请求uri，重新加载</span>
curl -X POST http://10.102.229.198:9090/-/reload</code></pre>



<p>方式二：</p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单</span>
$ kubectl apply -f prometheus-cm.yaml

<span class="comment"># 查看 prometheus pod</span>
$ kubectl get pods -n kube-ops
NAME                          READY   STATUS    RESTARTS   AGE
prometheus-844847f5c7-7gwck   1/1     Running   0          3h29m

<span class="comment"># 杀死重启Pod，重新加载 ConfigMap</span>
$ kubectl delete pod prometheus-844847f5c7-7gwck -n kube-ops
pod <span class="string">&quot;prometheus-844847f5c7-7gwck&quot;</span> deleted</code></pre>





<p>再次从浏览器查看 Prometheus </p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/22/20250722-205857.png" alt="抓取 Ingress-Nginx 指标"></p>
<h1 id="五、创建-node-exporter，监控节点资源"><a href="#五、创建-node-exporter，监控节点资源" class="headerlink" title="五、创建 node_exporter，监控节点资源"></a>五、创建 node_exporter，监控节点资源</h1><p>node_exporter 就是抓取用于采集服务器节点的各种运行指标，目前 node_exporter 支持几乎所有常见的监控点，比如 conntrack，cpu，diskstats，filesystem，loadavg，meminfo，netstat 等，详细的监控点列表可以参考其 <a target="_blank" rel="noopener" href="https://github.com/prometheus/node_exporter">Node_Exporter</a></p>
<p><strong>说明：</strong></p>
<p>在 Kubernetes 下，Promethues 通过与 Kubernetes API 集成，目前主要支持5中服务发现模式，分别是：Node、Service、Pod、Endpoints、Ingress</p>
<p>通过指定 <code>kubernetes_sd_configs</code> 的模式为 <code>node</code>，Prometheus 就会自动从 Kubernetes 中发现所有的 node 节点并作为当前 job 监控的目标实例，发现的节点 <code>/metrics</code> 接口是默认的 kubelet 的 HTTP 接口</p>
<p>prometheus 去发现 Node 模式的服务的时候，访问的端口默认是<strong>10250</strong>，而现在该端口下面已经没有了<code>/metrics</code>指标数据了，现在 kubelet 只读的数据接口统一通过 <strong>10255</strong> 端口进行暴露了，所以我们应该去替换掉这里的端口，但是我们是要替换成 <strong>10255</strong> 端口吗？不是的，因为我们是要去配置上面通过<code>node-exporter</code>抓取到的节点指标数据，而我们上面是不是指定了 <code>hostNetwork=true</code> ，所以在每个节点上就会绑定一个端口 <strong>9100</strong>，所以我们应该将这里的 <strong>10250</strong> 替换成 <strong>9100</strong></p>
<p>这里我们就需要使用到 Prometheus 提供的<code>relabel_configs</code>中的<code>replace</code>能力了，relabel 可以在 Prometheus 采集数据之前，通过Target 实例的 Metadata 信息，动态重新写入 Label 的值。除此之外，我们还能根据 Target 实例的 Metadata 信息选择是否采集或者忽略该 Target 实例</p>
<p>添加了一个 action 为<code>labelmap</code>，正则表达式是<code>__meta_kubernetes_node_label_(.+)</code>的配置，这里的意思就是表达式中匹配都的数据也添加到指标数据的 Label 标签中去。</p>
<p>对于 kubernetes_sd_configs 下面可用的标签如下： 可用元标签：</p>
<ul>
<li>__meta_kubernetes_node_name：节点对象的名称</li>
<li><em>_meta_kubernetes_node_label</em>：节点对象中的每个标签</li>
<li><em>_meta_kubernetes_node_annotation</em>：来自节点对象的每个注释</li>
<li><em>_meta_kubernetes_node_address</em>：每个节点地址类型的第一个地址（如果存在） *</li>
</ul>
<blockquote>
<p>关于 kubernets_sd_configs 更多信息可以查看官方文档：<a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#">kubernetes_sd_config</a></p>
</blockquote>
<p>Kubernetes 1.11+ 版本以后，kubelet 就移除了 10255 端口， metrics 接口又回到了 10250 端口，所以这里不需要替换端口，但是需要使用 https 的协议</p>
<h2 id="1-部署-node-exporter"><a href="#1-部署-node-exporter" class="headerlink" title="1. 部署 node-exporter"></a>1. 部署 node-exporter</h2><p>资源清单：<code>prometheus-node-exporter.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>
<span class="attr">kind:</span> <span class="string">DaemonSet</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">node-exporter</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
  <span class="attr">labels:</span>
    <span class="attr">name:</span> <span class="string">node-exporter</span>
<span class="attr">spec:</span>
  <span class="attr">selector:</span>
    <span class="attr">matchLabels:</span>
      <span class="attr">name:</span> <span class="string">node-exporter</span>
  <span class="attr">template:</span>
    <span class="attr">metadata:</span>
      <span class="attr">labels:</span>
        <span class="attr">name:</span> <span class="string">node-exporter</span>
    <span class="attr">spec:</span>
      <span class="attr">hostPID:</span> <span class="literal">true</span>                         <span class="comment"># 允许 Pod 使用主机节点的 PID 命名空间, Node Exporter 需要访问主机的 /proc 文件系统以收集进程相关指标（如 CPU、内存使用情况），因此需要 hostPID: true</span>
      <span class="attr">hostIPC:</span> <span class="literal">true</span>                         <span class="comment"># 允许 Pod 使用主机节点的 IPC（进程间通信）命名空间，这通常用于访问主机的共享内存或其他 IPC 机制，但在 Node Exporter 中可能不是必需，建议评估是否需要以降低安全风险。</span>
      <span class="attr">hostNetwork:</span> <span class="literal">true</span>                     <span class="comment"># Pod 使用主机节点的网络命名空间，直接绑定到主机的网络接口和端口，Node Exporter 的端口（9100）将直接绑定到主机网络，便于 Prometheus 抓取节点的指标（如通过节点 IP:9100）</span>
      <span class="attr">containers:</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">node-exporter</span>
          <span class="attr">image:</span> <span class="string">prom/node-exporter:v0.16.0</span>   <span class="comment"># Node Exporter 收集主机系统的指标（如 CPU、内存、磁盘、文件系统等）并通过 HTTP 端点（默认 /metrics）暴露</span>
          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>
          <span class="attr">ports:</span>
            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9100</span>             <span class="comment"># Node Exporter 监听 9100 端口，暴露 Prometheus 格式的指标端点（默认 /metrics）</span>
          <span class="attr">resources:</span>
            <span class="attr">requests:</span>
              <span class="attr">cpu:</span> <span class="number">0.15</span>                       <span class="comment"># 请求 0.15 CPU 核心（150 毫核），表示 Node Exporter 的最小 CPU 需求</span>
          <span class="attr">securityContext:</span>
            <span class="attr">privileged:</span> <span class="literal">true</span>                  <span class="comment"># 容器以特权模式运行，拥有对主机的广泛访问权限</span>
          <span class="attr">args:</span>
            <span class="bullet">-</span> <span class="string">--path.procfs</span>                   <span class="comment"># 指定进程文件系统路径为 /host/proc，映射到主机的 /proc，用于收集进程、CPU、内存等指标</span>
            <span class="bullet">-</span> <span class="string">/host/proc</span>
            <span class="bullet">-</span> <span class="string">--path.sysfs</span>                    <span class="comment"># 指定系统文件系统路径为 /host/sys，映射到主机的 /sys，用于收集硬件相关指标（如设备信息）</span>
            <span class="bullet">-</span> <span class="string">/host/sys</span>
            <span class="bullet">-</span> <span class="string">--collector.filesystem.ignored-mount-points</span>   <span class="comment"># 配置文件系统收集器，忽略以 /sys, /proc, /dev, /host, /etc 开头的挂载点，防止收集容器内部或无关的文件系统指标，专注于主机文件系统</span>
            <span class="bullet">-</span> <span class="string">&#x27;&quot;^/(sys|proc|dev|host|etc)($|/)&quot;&#x27;</span>
          <span class="attr">volumeMounts:</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dev</span>
              <span class="attr">mountPath:</span> <span class="string">/host/dev</span>      <span class="comment"># 挂载主机的 /dev 到容器内的 /host/dev</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">proc</span>
              <span class="attr">mountPath:</span> <span class="string">/host/proc</span>     <span class="comment"># 挂载主机的 /proc 到 /host/proc</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sys</span>
              <span class="attr">mountPath:</span> <span class="string">/host/sys</span>      <span class="comment"># 挂载主机的 /sys 到 /host/sys</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rootfs</span>
              <span class="attr">mountPath:</span> <span class="string">/rootfs</span>        <span class="comment"># 挂载主机的根文件系统（/）到 /rootfs</span>
      <span class="attr">tolerations:</span>
        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;node-role.kubernetes.io/control-plane&quot;</span>    <span class="comment"># 允许 Pod 调度到带有 node-role.kubernetes.io/control-plane 污点的节点</span>
          <span class="attr">operator:</span> <span class="string">Exists</span>
          <span class="attr">effect:</span> <span class="string">NoSchedule</span>
      <span class="attr">volumes:</span>                          <span class="comment"># 定义 Pod 使用的卷，映射主机文件系统到容器</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">proc</span>
          <span class="attr">hostPath:</span>
            <span class="attr">path:</span> <span class="string">/proc</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dev</span>
          <span class="attr">hostPath:</span>
            <span class="attr">path:</span> <span class="string">/dev</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sys</span>
          <span class="attr">hostPath:</span>
            <span class="attr">path:</span> <span class="string">/sys</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rootfs</span>
          <span class="attr">hostPath:</span>
            <span class="attr">path:</span> <span class="string">/</span></code></pre>



<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单，创建 node-exporter</span>
$ kubectl apply -f prometheus-node-exporter.yaml

<span class="comment"># 查看 Pod</span>
$ kubectl get pods -n kube-ops
NAME                          READY   STATUS    RESTARTS   AGE
node-exporter-d85s5           1/1     Running   0          165m
node-exporter-gmwln           1/1     Running   0          165m
node-exporter-kjdm9           1/1     Running   0          165m
node-exporter-vg29l           1/1     Running   0          165m
prometheus-844847f5c7-2zvbn   1/1     Running   0          17h</code></pre>





<h2 id="2-修改-Prometheus-ConfigMap-1"><a href="#2-修改-Prometheus-ConfigMap-1" class="headerlink" title="2. 修改 Prometheus ConfigMap"></a>2. 修改 Prometheus ConfigMap</h2><p>资源清单：<code>prometheus-cm.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">prometheus.yml:</span> <span class="string">|</span>           <span class="comment"># 使用 | 表示 YAML 中的多行文本</span>
    <span class="attr">global:</span>                   <span class="comment"># 定义 Prometheus 的全局配置，适用于所有抓取任务（除非在具体任务中被覆盖）</span>
      <span class="attr">scrape_interval:</span> <span class="string">15s</span>    <span class="comment"># 表示 prometheus 抓取指标数据的频率，默认是 15s</span>
      <span class="attr">scrape_timeout:</span> <span class="string">15s</span>     <span class="comment"># 表示 prometheus 抓取指标数据的超时时间，默认是 15s</span>
    <span class="attr">scrape_configs:</span>
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span>  <span class="comment"># 定义任务名，这里监控 prometheus 自身</span>
      <span class="attr">static_configs:</span>
      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]
        
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx140&#x27;</span>         <span class="comment"># 10.20.1.140 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.140:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx141&#x27;</span>         <span class="comment"># 10.20.1.141 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.141:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx142&#x27;</span>         <span class="comment"># 10.20.1.142 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.142:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-nodes&#x27;</span>        <span class="comment"># 基于Node自动发现节点，并抓取指标信息。Node Exporter：提供系统级指标，适合监控节点的硬件和操作系统状态（如磁盘 I/O、网络流量）。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]    <span class="comment"># 默认抓取节点的 Kubelet 端点（端口 10250，/metrics），但这里通过 relabel_configs 修改为 Node Exporter 的端口（9100）</span>
          <span class="attr">regex:</span> <span class="string">&#x27;(.*):10250&#x27;</span>
          <span class="attr">replacement:</span> <span class="string">&#x27;$&#123;1&#125;:9100&#x27;</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">action:</span> <span class="string">replace</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-kubelet&#x27;</span>      <span class="comment"># 基于Node发现，从 Kubelet 抓取指标信息。Kubelet：提供 Kubernetes 特定指标，如 Pod 运行状态、Kubelet 的健康状况和 API 请求统计。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># k8s 自动为pod挂载的证书文件路径,在pod内部</span>
        <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># k8s 自动为pod挂载的token文件路径，在pod内部</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>                            <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span></code></pre>



<p><strong>重新执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行更新 ConfigMap 资源清单</span>
$ kubectl apply -f prometheus-cm.yaml

<span class="comment"># 等待一会，待ConfigMap更新后，执行请求，让 Prometheus 配置热更新</span>
$ kubectl get svc -n kube-ops
NAME         TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
prometheus   NodePort   10.102.229.198   &lt;none&gt;        9090:31676/TCP   18h
$ curl -X POST http://10.102.229.198:9090/-/reload</code></pre>



<p>再次从浏览器查看 Prometheus 控制台，发现 node_exporter 和 kubelet 已被监听</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-141026.png" alt="node_exporter 和 kubelet"></p>
<h1 id="六、使用-cAdvisor-监控容器资源指标"><a href="#六、使用-cAdvisor-监控容器资源指标" class="headerlink" title="六、使用 cAdvisor 监控容器资源指标"></a>六、使用 cAdvisor 监控容器资源指标</h1><p>说到容器监控我们自然会想到 <code>cAdvisor</code>，我们前面也说过<code>cAdvisor</code>已经内置在了 kubelet 组件之中，所以我们不需要单独去安装，<code>cAdvisor</code> 的数据路径为<code>/api/v1/nodes/&lt;node&gt;/proxy/metrics</code>，同样我们这里使用 node 的服务发现模式，因为每一个节点下面都有 kubelet</p>
<h2 id="1-修改-Prometheus-ConfigMap"><a href="#1-修改-Prometheus-ConfigMap" class="headerlink" title="1. 修改 Prometheus ConfigMap"></a>1. 修改 Prometheus ConfigMap</h2><p>资源清单：<code>prometheus-cm.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">prometheus.yml:</span> <span class="string">|</span>           <span class="comment"># 使用 | 表示 YAML 中的多行文本</span>
    <span class="attr">global:</span>                   <span class="comment"># 定义 Prometheus 的全局配置，适用于所有抓取任务（除非在具体任务中被覆盖）</span>
      <span class="attr">scrape_interval:</span> <span class="string">15s</span>    <span class="comment"># 表示 prometheus 抓取指标数据的频率，默认是 15s</span>
      <span class="attr">scrape_timeout:</span> <span class="string">15s</span>     <span class="comment"># 表示 prometheus 抓取指标数据的超时时间，默认是 15s</span>
    <span class="attr">scrape_configs:</span>
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span>  <span class="comment"># 定义任务名，这里监控 prometheus 自身</span>
      <span class="attr">static_configs:</span>
      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]
        
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx140&#x27;</span>         <span class="comment"># 10.20.1.140 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.140:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx141&#x27;</span>         <span class="comment"># 10.20.1.141 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.141:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx142&#x27;</span>         <span class="comment"># 10.20.1.142 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.142:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-nodes&#x27;</span>        <span class="comment"># 基于Node自动发现节点，并抓取指标信息。Node Exporter：提供系统级指标，适合监控节点的硬件和操作系统状态（如磁盘 I/O、网络流量）。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]    <span class="comment"># 默认抓取节点的 Kubelet 端点（端口 10250，/metrics），但这里通过 relabel_configs 修改为 Node Exporter 的端口（9100）</span>
          <span class="attr">regex:</span> <span class="string">&#x27;(.*):10250&#x27;</span>
          <span class="attr">replacement:</span> <span class="string">&#x27;$&#123;1&#125;:9100&#x27;</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">action:</span> <span class="string">replace</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-kubelet&#x27;</span>      <span class="comment"># 基于Node发现，从 Kubelet 抓取指标信息。Kubelet：提供 Kubernetes 特定指标，如 Pod 运行状态、Kubelet 的健康状况和 API 请求统计。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># k8s 自动为pod挂载的证书文件路径,在pod内部</span>
        <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># k8s 自动为pod挂载的token文件路径，在pod内部</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>                            <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-cadvisor&#x27;</span>                                         <span class="comment"># 抓取任务名称为 kubernetes-cadvisor，用于监控 Kubernetes 节点的 cAdvisor 指标</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                           <span class="comment"># 指定使用 HTTPS 协议访问目标（Kubernetes API 服务器的 443 端口）</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Pod 内部的服务账号卷挂载的 CA 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌</span>
      <span class="attr">relabel_configs:</span>                                              <span class="comment"># 定义标签重写规则，修改服务发现的目标地址和路径</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                                          <span class="comment"># 规则1：将节点的标签（如 kubernetes.io/hostname）映射到 Prometheus 指标标签 </span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
        <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span>                   <span class="comment"># 规则2：将抓取目标地址设置为 kubernetes.default.svc:443，即 Kubernetes API 服务器的 ClusterIP 服务（默认命名空间 default，端口 443）</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]              <span class="comment"># 规则3：使用节点名称（__meta_kubernetes_node_name，如 node01）动态构造指标路径</span>
          <span class="attr">regex:</span> <span class="string">(.+)</span>
          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span>
          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics/cadvisor</span></code></pre>



<p><strong>重新执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行更新 ConfigMap 资源清单</span>
$ kubectl apply -f prometheus-cm.yaml

<span class="comment"># 等待一会，待ConfigMap更新后，执行请求，让 Prometheus 配置热更新</span>
$ kubectl get svc -n kube-ops
NAME         TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
prometheus   NodePort   10.102.229.198   &lt;none&gt;        9090:31676/TCP   18h
$ curl -X POST http://10.102.229.198:9090/-/reload</code></pre>



<p>再次从浏览器查看 Prometheus 控制台，发现 cAdvisor 已被监听</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-150843.png" alt="Prometheus 监听 cAdvisor"></p>
<h1 id="七、Prometheus-监控-kube-apiserver"><a href="#七、Prometheus-监控-kube-apiserver" class="headerlink" title="七、Prometheus 监控 kube-apiserver"></a>七、Prometheus 监控 kube-apiserver</h1><p><code>kube-apiserver</code> 监听在节点的 6443 端口，通过以下配置可以使 Prometheus 读取 <code>kube-apiserver</code> 的指标数据</p>
<h2 id="1-修改-Prometheus-ConfigMap-1"><a href="#1-修改-Prometheus-ConfigMap-1" class="headerlink" title="1. 修改 Prometheus ConfigMap"></a>1. 修改 Prometheus ConfigMap</h2><p>资源清单：<code>prometheus-cm.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">prometheus.yml:</span> <span class="string">|</span>           <span class="comment"># 使用 | 表示 YAML 中的多行文本</span>
    <span class="attr">global:</span>                   <span class="comment"># 定义 Prometheus 的全局配置，适用于所有抓取任务（除非在具体任务中被覆盖）</span>
      <span class="attr">scrape_interval:</span> <span class="string">15s</span>    <span class="comment"># 表示 prometheus 抓取指标数据的频率，默认是 15s</span>
      <span class="attr">scrape_timeout:</span> <span class="string">15s</span>     <span class="comment"># 表示 prometheus 抓取指标数据的超时时间，默认是 15s</span>
    <span class="attr">scrape_configs:</span>
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span>  <span class="comment"># 定义任务名，这里监控 prometheus 自身</span>
      <span class="attr">static_configs:</span>
      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]
        
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx140&#x27;</span>         <span class="comment"># 10.20.1.140 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.140:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx141&#x27;</span>         <span class="comment"># 10.20.1.141 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.141:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx142&#x27;</span>         <span class="comment"># 10.20.1.142 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.142:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-nodes&#x27;</span>        <span class="comment"># 基于Node自动发现节点，并抓取指标信息。Node Exporter：提供系统级指标，适合监控节点的硬件和操作系统状态（如磁盘 I/O、网络流量）。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]    <span class="comment"># 默认抓取节点的 Kubelet 端点（端口 10250，/metrics），但这里通过 relabel_configs 修改为 Node Exporter 的端口（9100）</span>
          <span class="attr">regex:</span> <span class="string">&#x27;(.*):10250&#x27;</span>
          <span class="attr">replacement:</span> <span class="string">&#x27;$&#123;1&#125;:9100&#x27;</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">action:</span> <span class="string">replace</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-kubelet&#x27;</span>      <span class="comment"># 基于Node发现，从 Kubelet 抓取指标信息。Kubelet：提供 Kubernetes 特定指标，如 Pod 运行状态、Kubelet 的健康状况和 API 请求统计。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># k8s 自动为pod挂载的证书文件路径,在pod内部</span>
        <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># k8s 自动为pod挂载的token文件路径，在pod内部</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>                            <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-cadvisor&#x27;</span>                                         <span class="comment"># 抓取任务名称为 kubernetes-cadvisor，用于监控 Kubernetes 节点的 cAdvisor 指标</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                           <span class="comment"># 指定使用 HTTPS 协议访问目标（Kubernetes API 服务器的 443 端口）</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Pod 内部的服务账号卷挂载的 CA 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌</span>
      <span class="attr">relabel_configs:</span>                                              <span class="comment"># 定义标签重写规则，修改服务发现的目标地址和路径</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                                          <span class="comment"># 规则1：将节点的标签（如 kubernetes.io/hostname）映射到 Prometheus 指标标签 </span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
        <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span>                   <span class="comment"># 规则2：将抓取目标地址设置为 kubernetes.default.svc:443，即 Kubernetes API 服务器的 ClusterIP 服务（默认命名空间 default，端口 443）</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]              <span class="comment"># 规则3：使用节点名称（__meta_kubernetes_node_name，如 node01）动态构造指标路径</span>
          <span class="attr">regex:</span> <span class="string">(.+)</span>
          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span>
          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics/cadvisor</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-apiservers&#x27;</span>                             <span class="comment"># 抓取任务名称为 kubernetes-apiservers，用于监控 Kubernetes API 服务器的指标，包括请求速率、延迟、错误率等（如 apiserver_request_total, apiserver_request_duration_seconds）</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span>                                           <span class="comment"># 使用 Kubernetes 服务发现，角色为 endpoints，发现集群中的所有 Endpoints 对象</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                 <span class="comment"># Kubernetes API 服务器默认通过 HTTPS（端口 443）暴露 /metrics 端点</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Prometheus Pod 内部的服务账号卷挂载的 CA 证书（位于 /var/run/secrets/kubernetes.io/serviceaccount/ca.crt）验证 API 服务器的 TLS 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌（位于 /var/run/secrets/kubernetes.io/serviceaccount/token）进行身份验证</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>, <span class="string">__meta_kubernetes_service_name</span>, <span class="string">__meta_kubernetes_endpoint_port_name</span>]    <span class="comment"># 断点所在的名称空间，断点所在的 Service， 断点端口名称</span>
          <span class="attr">action:</span> <span class="string">keep</span>                      <span class="comment"># 仅保留匹配正则表达式的端点，未匹配的端点被丢弃。</span>
          <span class="attr">regex:</span> <span class="string">default;kubernetes;https</span>   <span class="comment"># 确保 Prometheus 只抓取 default 命名空间中 kubernetes 服务的 HTTPS 端点（即 API 服务器的 /metrics）</span></code></pre>



<p><strong>重新执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行更新 ConfigMap 资源清单</span>
$ kubectl apply -f prometheus-cm.yaml

<span class="comment"># 等待一会，待ConfigMap更新后，执行请求，让 Prometheus 配置热更新</span>
$ kubectl get svc -n kube-ops
NAME         TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
prometheus   NodePort   10.102.229.198   &lt;none&gt;        9090:31676/TCP   18h
$ curl -X POST http://10.102.229.198:9090/-/reload</code></pre>



<p>再次从浏览器查看 Prometheus 控制台，发现 apiServer 已被监听</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-155007.png" alt="Prometheus 监听 apiServer"></p>
<h1 id="八、Prometheus-通过-Service-监控服务"><a href="#八、Prometheus-通过-Service-监控服务" class="headerlink" title="八、Prometheus 通过 Service 监控服务"></a>八、Prometheus 通过 Service 监控服务</h1><h2 id="1-修改-Prometheus-ConfigMap-2"><a href="#1-修改-Prometheus-ConfigMap-2" class="headerlink" title="1. 修改 Prometheus ConfigMap"></a>1. 修改 Prometheus ConfigMap</h2><p>资源清单：<code>prometheus-cm.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">prometheus.yml:</span> <span class="string">|</span>           <span class="comment"># 使用 | 表示 YAML 中的多行文本</span>
    <span class="attr">global:</span>                   <span class="comment"># 定义 Prometheus 的全局配置，适用于所有抓取任务（除非在具体任务中被覆盖）</span>
      <span class="attr">scrape_interval:</span> <span class="string">15s</span>    <span class="comment"># 表示 prometheus 抓取指标数据的频率，默认是 15s</span>
      <span class="attr">scrape_timeout:</span> <span class="string">15s</span>     <span class="comment"># 表示 prometheus 抓取指标数据的超时时间，默认是 15s</span>
    <span class="attr">scrape_configs:</span>
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span>  <span class="comment"># 定义任务名，这里监控 prometheus 自身</span>
      <span class="attr">static_configs:</span>
      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]
        
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx140&#x27;</span>         <span class="comment"># 10.20.1.140 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.140:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx141&#x27;</span>         <span class="comment"># 10.20.1.141 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.141:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx142&#x27;</span>         <span class="comment"># 10.20.1.142 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.142:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-nodes&#x27;</span>        <span class="comment"># 基于Node自动发现节点，并抓取指标信息。Node Exporter：提供系统级指标，适合监控节点的硬件和操作系统状态（如磁盘 I/O、网络流量）。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]    <span class="comment"># 默认抓取节点的 Kubelet 端点（端口 10250，/metrics），但这里通过 relabel_configs 修改为 Node Exporter 的端口（9100）</span>
          <span class="attr">regex:</span> <span class="string">&#x27;(.*):10250&#x27;</span>
          <span class="attr">replacement:</span> <span class="string">&#x27;$&#123;1&#125;:9100&#x27;</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">action:</span> <span class="string">replace</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-kubelet&#x27;</span>      <span class="comment"># 基于Node发现，从 Kubelet 抓取指标信息。Kubelet：提供 Kubernetes 特定指标，如 Pod 运行状态、Kubelet 的健康状况和 API 请求统计。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># k8s 自动为pod挂载的证书文件路径,在pod内部</span>
        <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># k8s 自动为pod挂载的token文件路径，在pod内部</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>                            <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-cadvisor&#x27;</span>                                         <span class="comment"># 抓取任务名称为 kubernetes-cadvisor，用于监控 Kubernetes 节点的 cAdvisor 指标</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                           <span class="comment"># 指定使用 HTTPS 协议访问目标（Kubernetes API 服务器的 443 端口）</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Pod 内部的服务账号卷挂载的 CA 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌</span>
      <span class="attr">relabel_configs:</span>                                              <span class="comment"># 定义标签重写规则，修改服务发现的目标地址和路径</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                                          <span class="comment"># 规则1：将节点的标签（如 kubernetes.io/hostname）映射到 Prometheus 指标标签 </span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
        <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span>                   <span class="comment"># 规则2：将抓取目标地址设置为 kubernetes.default.svc:443，即 Kubernetes API 服务器的 ClusterIP 服务（默认命名空间 default，端口 443）</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]              <span class="comment"># 规则3：使用节点名称（__meta_kubernetes_node_name，如 node01）动态构造指标路径</span>
          <span class="attr">regex:</span> <span class="string">(.+)</span>
          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span>
          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics/cadvisor</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-apiservers&#x27;</span>                             <span class="comment"># 抓取任务名称为 kubernetes-apiservers，用于监控 Kubernetes API 服务器的指标，包括请求速率、延迟、错误率等（如 apiserver_request_total, apiserver_request_duration_seconds）</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span>                                           <span class="comment"># 使用 Kubernetes 服务发现，角色为 endpoints，发现集群中的所有 Endpoints 对象</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                 <span class="comment"># Kubernetes API 服务器默认通过 HTTPS（端口 443）暴露 /metrics 端点</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Prometheus Pod 内部的服务账号卷挂载的 CA 证书（位于 /var/run/secrets/kubernetes.io/serviceaccount/ca.crt）验证 API 服务器的 TLS 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌（位于 /var/run/secrets/kubernetes.io/serviceaccount/token）进行身份验证</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>, <span class="string">__meta_kubernetes_service_name</span>, <span class="string">__meta_kubernetes_endpoint_port_name</span>]    <span class="comment"># 断点所在的名称空间，断点所在的 Service， 断点端口名称</span>
          <span class="attr">action:</span> <span class="string">keep</span>                      <span class="comment"># 仅保留匹配正则表达式的端点，未匹配的端点被丢弃。</span>
          <span class="attr">regex:</span> <span class="string">default;kubernetes;https</span>   <span class="comment"># 确保 Prometheus 只抓取 default 命名空间中 kubernetes 服务的 HTTPS 端点（即 API 服务器的 /metrics）</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-service-endpoints&#x27;</span>        <span class="comment"># 抓取任务名称为 kubernetes-service-endpoints，用于监控 Kubernetes Service 的 Endpoints 指标。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span>                             <span class="comment"># 使用 Kubernetes 服务发现，角色为 endpoints，发现集群中所有 Service 的 Endpoints 对象</span>
      <span class="attr">relabel_configs:</span>                                <span class="comment"># 定义标签重写规则，过滤和配置服务发现的目标，确保只抓取符合条件的 Service Endpoints</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scrape</span>]
          <span class="attr">action:</span> <span class="string">keep</span>                                <span class="comment"># 仅保留注解 prometheus.io/scrape: &quot;true&quot; 的 Service Endpoints，未匹配的被丢弃</span>
          <span class="attr">regex:</span> <span class="literal">true</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scheme</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 将匹配的值替换到 __scheme__ 标签，决定抓取协议（http 或 https），允许 Service 指定是否通过 HTTPS 抓取指标，适用于需要安全连接的场景</span>
          <span class="attr">target_label:</span> <span class="string">__scheme__</span>
          <span class="attr">regex:</span> <span class="string">(https?)</span>                             <span class="comment"># 匹配 http 或 https，若注解未设置，默认使用 http</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_path</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 检查 Service 的注解 prometheus.io/path，将匹配的值替换到 __metrics_path__ 标签，指定指标端点的路径</span>
          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span>
          <span class="attr">regex:</span> <span class="string">(.+)</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>, <span class="string">__meta_kubernetes_service_annotation_prometheus_io_port</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 将地址和端口组合替换到 __address__ 标签，允许 Service 指定抓取端口（如 prometheus.io/port: &quot;8080&quot;），覆盖 Endpoints 的默认端口</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">regex:</span> <span class="string">([^:]+)(?::\d+)?;(\d+)</span>
          <span class="attr">replacement:</span> <span class="string">$1:$2</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                            <span class="comment"># 将 Service 的标签（如 app=my-app）映射到 Prometheus 指标标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_service_label_(.+)</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>]      <span class="comment"># 将 Service 的命名空间（__meta_kubernetes_namespace）写入指标标签 kubernetes_namespace</span>
          <span class="attr">action:</span> <span class="string">replace</span>
          <span class="attr">target_label:</span> <span class="string">kubernetes_namespace</span>          
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_name</span>]   <span class="comment"># 将 Service 名称（__meta_kubernetes_service_name）写入指标标签 kubernetes_name</span>
          <span class="attr">action:</span> <span class="string">replace</span>
          <span class="attr">target_label:</span> <span class="string">kubernetes_name</span></code></pre>



<p><strong>重新执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行更新 ConfigMap 资源清单</span>
$ kubectl apply -f prometheus-cm.yaml

<span class="comment"># 等待一会，待ConfigMap更新后，执行请求，让 Prometheus 配置热更新</span>
$ kubectl get svc -n kube-ops
NAME         TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
prometheus   NodePort   10.102.229.198   &lt;none&gt;        9090:31676/TCP   18h
$ curl -X POST http://10.102.229.198:9090/-/reload</code></pre>



<p>再次从浏览器查看 Prometheus 控制台，发现 Service 已被监听</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-163620.png" alt="Prometheus 监听 Service"></p>
<h1 id="九、部署-kube-state-metrics，并使用-Prometheus-监控"><a href="#九、部署-kube-state-metrics，并使用-Prometheus-监控" class="headerlink" title="九、部署 kube-state-metrics，并使用 Prometheus 监控"></a>九、部署 kube-state-metrics，并使用 Prometheus 监控</h1><h2 id="1-部署-kube-state-metrics"><a href="#1-部署-kube-state-metrics" class="headerlink" title="1. 部署 kube-state-metrics"></a>1. 部署 kube-state-metrics</h2><pre><code class="highlight bash"><span class="comment"># 克隆 kube-state-metrics 仓库代码</span>
git <span class="built_in">clone</span> https://github.com/kubernetes/kube-state-metrics.git

<span class="comment"># 克隆后，进入资源清单目录</span>
<span class="built_in">cd</span> kube-state-metrics/examples/standard


<span class="comment"># 修改 service.yaml</span>
$ vim service.yaml
<span class="comment"># 添加 annotations 信息，用于被prometheus发现</span>
metadata:
  annotations:
    prometheus.io/scrape: <span class="string">&#x27;true&#x27;</span>
    prometheus.io/port: <span class="string">&quot;8080&quot;</span>


<span class="comment"># 执行所有资源清单，注意：这里是 -k 不是 -f</span>
$ kubectl apply -k .</code></pre>



<p><strong>查看部署资源</strong></p>
<pre><code class="highlight bash"><span class="comment"># 查看 Service</span>
$ kubectl get pods -n kube-system | grep kube-state-metrics
kube-state-metrics-54c8f8787f-6jnp5        1/1     Running   0              107s

<span class="comment"># 查看 Pod</span>
$ kubectl get svc -n kube-system | grep kube-state-metrics
kube-state-metrics   ClusterIP   None            &lt;none&gt;        8080/TCP,8081/TCP        119s</code></pre>

<p>部署完成后，等待一会，等待 Prometheus 抓取 kube-state-metrics 指标信息。</p>
<p>在浏览器查看 Prometheus ，kube-state-metrics 信息已经被成功抓取。</p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-195227.png" alt="Prometheus 监听 kube-state-metrics"></p>
<h1 id="十、部署-Grafana"><a href="#十、部署-Grafana" class="headerlink" title="十、部署 Grafana"></a>十、部署 Grafana</h1><p>用于展示 Prometheus 抓取保存的指标数据</p>
<p>资源清单：<code>prometheus-grafana.yaml</code></p>
<pre><code class="highlight yaml"><span class="comment"># 1.声明 PVC ，使用 StorageClass 动态创建PV</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">grafana-pvc</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">spec:</span>
  <span class="attr">accessModes:</span>
    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span>
  <span class="attr">resources:</span>
    <span class="attr">requests:</span>
      <span class="attr">storage:</span> <span class="string">5Gi</span>
  <span class="attr">storageClassName:</span> <span class="string">prometheus-storage</span> <span class="comment"># 使用 StorageClass 动态创建PV</span>
  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 2.创建Deployment</span>
<span class="attr">apiVersion:</span> <span class="string">apps/v1</span>
<span class="attr">kind:</span> <span class="string">Deployment</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">app:</span> <span class="string">grafana</span>
  <span class="attr">name:</span> <span class="string">grafana</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">spec:</span>
  <span class="attr">replicas:</span> <span class="number">1</span>
  <span class="attr">selector:</span>
    <span class="attr">matchLabels:</span>
      <span class="attr">app:</span> <span class="string">grafana</span>
  <span class="attr">template:</span>
    <span class="attr">metadata:</span>
      <span class="attr">labels:</span>
        <span class="attr">app:</span> <span class="string">grafana</span>
    <span class="attr">spec:</span>
      <span class="attr">securityContext:</span>
        <span class="attr">fsGroup:</span> <span class="number">472</span>
        <span class="attr">supplementalGroups:</span>
          <span class="bullet">-</span> <span class="number">0</span>
      <span class="attr">containers:</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grafana</span>
          <span class="attr">image:</span> <span class="string">grafana/grafana:8.3.5</span>
          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>
          <span class="attr">env:</span>                                    <span class="comment"># 设置grafana初始华用户名和密码</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SECURITY_ADMIN_USER</span>
              <span class="attr">value:</span> <span class="string">admin</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GF_SECURITY_ADMIN_PASSWORD</span>
              <span class="attr">value:</span> <span class="string">admin</span>
          <span class="attr">ports:</span>
            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">3000</span>
              <span class="attr">name:</span> <span class="string">http-grafana</span>
              <span class="attr">protocol:</span> <span class="string">TCP</span>
          <span class="attr">readinessProbe:</span>                         <span class="comment"># 就绪探测</span>
            <span class="attr">failureThreshold:</span> <span class="number">10</span>
            <span class="attr">httpGet:</span>
              <span class="attr">path:</span> <span class="string">/api/health</span>
              <span class="attr">port:</span> <span class="number">3000</span>
              <span class="attr">scheme:</span> <span class="string">HTTP</span>
            <span class="attr">initialDelaySeconds:</span> <span class="number">60</span>               <span class="comment"># 延迟 60秒探测，等待job执行完成</span>
            <span class="attr">periodSeconds:</span> <span class="number">10</span>
            <span class="attr">successThreshold:</span> <span class="number">1</span>
            <span class="attr">timeoutSeconds:</span> <span class="number">30</span>
          <span class="attr">livenessProbe:</span>                          <span class="comment"># 存活探测</span>
            <span class="attr">failureThreshold:</span> <span class="number">3</span>
            <span class="attr">httpGet:</span>
              <span class="attr">path:</span> <span class="string">/api/health</span>
              <span class="attr">port:</span> <span class="number">3000</span>
              <span class="attr">scheme:</span> <span class="string">HTTP</span>
            <span class="attr">periodSeconds:</span> <span class="number">10</span>
            <span class="attr">successThreshold:</span> <span class="number">1</span>
            <span class="attr">timeoutSeconds:</span> <span class="number">1</span>
          <span class="attr">resources:</span>
            <span class="attr">requests:</span>
              <span class="attr">cpu:</span> <span class="string">500m</span>
              <span class="attr">memory:</span> <span class="string">1024Mi</span>
            <span class="attr">limits:</span>
              <span class="attr">cpu:</span> <span class="string">1000m</span>
              <span class="attr">memory:</span> <span class="string">2048Mi</span>
          <span class="attr">volumeMounts:</span>
            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/grafana</span>
              <span class="attr">subPath:</span> <span class="string">grafana</span>
              <span class="attr">name:</span> <span class="string">grafana-pv</span>
          <span class="attr">securityContext:</span>                  <span class="comment"># 容器以用户id 472 运行</span>
            <span class="attr">runAsUser:</span> <span class="number">472</span>
      <span class="attr">volumes:</span>                              <span class="comment"># 挂载容器卷</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grafana-pv</span>
          <span class="attr">persistentVolumeClaim:</span>
            <span class="attr">claimName:</span> <span class="string">grafana-pvc</span>          <span class="comment"># 使用声明的PVC，通过 StorageClass 动态创建PV</span>
      <span class="attr">nodeSelector:</span> <span class="comment"># 指定Pod运行的节点</span>
        <span class="attr">kubernetes.io/hostname:</span> <span class="string">k8s-node02</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 3.创建Service</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">Service</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">grafana</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">spec:</span>
  <span class="attr">ports:</span>
    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">3000</span>
      <span class="attr">protocol:</span> <span class="string">TCP</span>
      <span class="attr">targetPort:</span> <span class="string">http-grafana</span>
      <span class="attr">nodePort:</span> <span class="number">30339</span>
  <span class="attr">selector:</span>
    <span class="attr">app:</span> <span class="string">grafana</span>
  <span class="attr">type:</span> <span class="string">NodePort</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 创建 job，调整 grafana 挂载目录权限</span>
<span class="attr">apiVersion:</span> <span class="string">batch/v1</span>
<span class="attr">kind:</span> <span class="string">Job</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">grafana-chown</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">spec:</span>
  <span class="attr">template:</span>
    <span class="attr">spec:</span>
      <span class="attr">restartPolicy:</span> <span class="string">Never</span>
      <span class="attr">containers:</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">grafana-chown</span>
          <span class="attr">command:</span> [<span class="string">&quot;chown&quot;</span>, <span class="string">&quot;-R&quot;</span>, <span class="string">&quot;472:472&quot;</span>, <span class="string">&quot;/var/lib/grafana&quot;</span>]
          <span class="attr">image:</span> <span class="string">busybox:1.37.0</span>
          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>
          <span class="attr">volumeMounts:</span>
            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">storage</span>
              <span class="attr">subPath:</span> <span class="string">grafana</span>
              <span class="attr">mountPath:</span> <span class="string">/var/lib/grafana</span>
      <span class="attr">volumes:</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">storage</span>
          <span class="attr">persistentVolumeClaim:</span>
            <span class="attr">claimName:</span> <span class="string">grafana-pvc</span>

<span class="meta">---</span>
<span class="meta"></span>
<span class="comment"># 4.创建 Ingress</span>
<span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span> <span class="comment"># 指定 API 版本</span>
<span class="attr">kind:</span> <span class="string">Ingress</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">grafana-ui</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">grafana</span>
<span class="attr">spec:</span>
  <span class="attr">ingressClassName:</span> <span class="string">nginx</span>       <span class="comment"># 指定此 Ingress 资源由名称为 nginx 的 IngressClass 处理</span>
  <span class="attr">rules:</span>
    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">prom.grafana.com</span>    <span class="comment"># 指定此规则适用于请求的 HTTP 主机头（Host Header）为 prom.grafana.com 的流量。客户端必须通过该域名访问</span>
      <span class="attr">http:</span>
        <span class="attr">paths:</span>
          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span>             <span class="comment"># 指定匹配的 URL 路径为 /，即根路径,表示匹配所有以 / 开头的请求</span>
            <span class="attr">pathType:</span> <span class="string">Prefix</span>    <span class="comment"># 定义路径匹配的类型为 Prefix，表示匹配以指定路径（/) 开头的所有请求</span>
            <span class="attr">backend:</span>
              <span class="attr">service:</span>
                <span class="attr">name:</span> <span class="string">grafana</span>   <span class="comment"># 指定后端服务的名称为 nginx-svc.（必须存在于同一命名空间，或通过 &lt;namespace&gt;/&lt;service-name&gt; 跨命名空间引用）</span>
                <span class="attr">port:</span>
                  <span class="attr">number:</span> <span class="number">3000</span>  <span class="comment"># 指定目标 Service 的端口为 80</span></code></pre>

<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单</span>
$ kubectl apply -f prometheus-grafana.yaml

<span class="comment"># 查看 NFS Server 挂载目录权限</span>
$ <span class="built_in">cd</span> /root/data/prometheus/kube-ops/grafana-pvc/
$ ll
total 0
drwxrwxrwx 6 472 472 77 Jul 23 20:19 grafana

<span class="comment"># 查看 Service</span>
$ kubectl get svc -n kube-ops | grep grafana
grafana      NodePort   10.109.7.30      &lt;none&gt;        3000:30339/TCP   8m33s

<span class="comment"># 查看 Pod</span>
$ kubectl get pods -n kube-ops | grep grafana
grafana-b85d687cc-gtrhh       1/1     Running     0          8m41s
grafana-chown-z55rs           0/1     Completed   0          8m41s

<span class="comment"># 查看 Job</span>
$ kubectl get job -n kube-ops | grep grafana
grafana-chown   1/1           4s         8m50s</code></pre>



<p><strong>添加 Host 域名映射</strong></p>
<pre><code class="highlight plaintext">10.20.1.140 prom.grafana.com</code></pre>



<p><strong>浏览器访问 Grafana</strong></p>
<p><a target="_blank" rel="noopener" href="http://prom.grafana.com/">http://prom.grafana.com/</a></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-204348.png" alt="浏览器访问 Grafana"></p>
<p>用户名&#x2F;密码：admin&#x2F;admin</p>
<p><strong>添加Prometheus数据源</strong></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-204501.png" alt="添加Prometheus数据"></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-204521.png" alt="添加Prometheus数据源"></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/23/20250723-204708.png" alt="配置数据源"></p>
<p><strong>导入监控配置Json文件</strong></p>
<p>文件内容如下</p>
<pre><code class="highlight json"><span class="punctuation">&#123;</span><span class="attr">&quot;__inputs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;DS_PROMETHEUS&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;prometheus&quot;</span><span class="punctuation">,</span><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;datasource&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pluginId&quot;</span><span class="punctuation">:</span><span class="string">&quot;prometheus&quot;</span><span class="punctuation">,</span><span class="attr">&quot;pluginName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Prometheus&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;__requires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;grafana&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;grafana&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Grafana&quot;</span><span class="punctuation">,</span><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="string">&quot;5.3.4&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;panel&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="string">&quot;5.0.0&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;datasource&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;prometheus&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Prometheus&quot;</span><span class="punctuation">,</span><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="string">&quot;5.0.0&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;panel&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;singlestat&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Singlestat&quot;</span><span class="punctuation">,</span><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="string">&quot;5.0.0&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;annotations&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;builtIn&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;-- Grafana --&quot;</span><span class="punctuation">,</span><span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;hide&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;iconColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgba(0, 211, 255, 1)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Annotations &amp; Alerts&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;dashboard&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;editable&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;gnetId&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;graphTooltip&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Kubernetes 指标&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;row&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">38</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;alignAsTable&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;hideEmpty&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;rightSide&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(rate(apiserver_request_total[1m]))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;一分钟平均&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(rate(apiserver_request_total[5m]))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;五分钟平均&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;ApiServer 每分钟请求数&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;time&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;cacheTimeout&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;colorBackground&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colorValue&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colors&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;#299c46&quot;</span><span class="punctuation">,</span><span class="string">&quot;rgba(237, 129, 40, 0.89)&quot;</span><span class="punctuation">,</span><span class="string">&quot;#d44a3a&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;gauge&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;maxValue&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;minValue&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdLabels&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdMarkers&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">32</span><span class="punctuation">,</span><span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;mappingType&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;mappingTypes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;value to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;range to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;maxDataPoints&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;connected&quot;</span><span class="punctuation">,</span><span class="attr">&quot;nullText&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;postfix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;postfixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;rangeMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;to&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;sparkline&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;fillColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgba(31, 118, 189, 0.18)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;full&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;lineColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgb(31, 120, 193)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;tableColumn&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;kubelet_active_pods&#123;beta_kubernetes_io_arch=\\&quot;</span>amd64\\<span class="string">&quot;,beta_kubernetes_io_os=\\&quot;</span>linux\\<span class="string">&quot;,instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;,job=\\&quot;</span>kubernetes-kubelet\\<span class="string">&quot;,kubernetes_io_arch=\\&quot;</span>amd64\\<span class="string">&quot;,kubernetes_io_hostname=\\&quot;</span>k8s-master01\\<span class="string">&quot;,kubernetes_io_os=\\&quot;</span>linux\\<span class="string">&quot;,static=\\&quot;</span>\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Master01 节点 Pod 总量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;singlestat&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;80%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="string">&quot;=&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;valueName&quot;</span><span class="punctuation">:</span><span class="string">&quot;avg&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;cacheTimeout&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;colorBackground&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colorValue&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colors&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;#299c46&quot;</span><span class="punctuation">,</span><span class="string">&quot;rgba(237, 129, 40, 0.89)&quot;</span><span class="punctuation">,</span><span class="string">&quot;#d44a3a&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;gauge&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;maxValue&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;minValue&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdLabels&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdMarkers&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">12</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">34</span><span class="punctuation">,</span><span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;mappingType&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;mappingTypes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;value to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;range to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;maxDataPoints&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;connected&quot;</span><span class="punctuation">,</span><span class="attr">&quot;nullText&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;postfix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;postfixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;rangeMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;to&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;sparkline&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;fillColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgba(31, 118, 189, 0.18)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;full&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;lineColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgb(31, 120, 193)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;tableColumn&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;kubelet_active_pods&#123;kubernetes_io_hostname=\\&quot;</span>k8s-node01\\<span class="string">&quot;,static=\\&quot;</span>\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node01 节点 Pod 总量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;singlestat&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;80%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="string">&quot;=&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;valueName&quot;</span><span class="punctuation">:</span><span class="string">&quot;avg&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;cacheTimeout&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;colorBackground&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colorValue&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colors&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;#299c46&quot;</span><span class="punctuation">,</span><span class="string">&quot;rgba(237, 129, 40, 0.89)&quot;</span><span class="punctuation">,</span><span class="string">&quot;#d44a3a&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;gauge&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;maxValue&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;minValue&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdLabels&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdMarkers&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">16</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">36</span><span class="punctuation">,</span><span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;mappingType&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;mappingTypes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;value to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;range to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;maxDataPoints&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;connected&quot;</span><span class="punctuation">,</span><span class="attr">&quot;nullText&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;postfix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;postfixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;rangeMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;to&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;sparkline&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;fillColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgba(31, 118, 189, 0.18)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;full&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;lineColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgb(31, 120, 193)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;tableColumn&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;kubelet_active_pods&#123;kubernetes_io_hostname=\\&quot;</span>k8s-node02\\<span class="string">&quot;,static=\\&quot;</span>\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node02 节点 Pod 总量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;singlestat&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;80%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="string">&quot;=&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;valueName&quot;</span><span class="punctuation">:</span><span class="string">&quot;avg&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;collapsed&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span><span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Kubernetes 物理机&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;row&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;decimals&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">9</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;alignAsTable&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;hideEmpty&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;rightSide&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;100 * (1 - avg by (instance) (rate(node_cpu_seconds_total&#123;mode=\\&quot;</span>idle\\<span class="string">&quot;, instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125;[1m])))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;hide&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Master01&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;100 * (1 - avg by (instance) (rate(node_cpu_seconds_total&#123;mode=\\&quot;</span>idle\\<span class="string">&quot;, instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125;[1m])))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;hide&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node01&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;100 * (1 - avg by (instance) (rate(node_cpu_seconds_total&#123;mode=\\&quot;</span>idle\\<span class="string">&quot;, instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125;[1m])))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;hide&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node02&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;CPU 使用量（百分比）&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;current&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">9</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;alignAsTable&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;hideEmpty&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;rightSide&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;(node_memory_MemTotal_bytes&#123;instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125; - (node_memory_MemFree_bytes&#123;instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125; + node_memory_Buffers_bytes&#123;instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125; + node_memory_Cached_bytes&#123;instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125;)) / node_memory_MemTotal_bytes&#123;instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125; * 100&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Master01 节点&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;(node_memory_MemTotal_bytes&#123;instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125; - (node_memory_MemFree_bytes&#123;instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125; + node_memory_Buffers_bytes&#123;instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125; + node_memory_Cached_bytes&#123;instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125;)) / node_memory_MemTotal_bytes&#123;instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125; * 100&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node01 节点&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;(node_memory_MemTotal_bytes&#123;instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125; - (node_memory_MemFree_bytes&#123;instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125; + node_memory_Buffers_bytes&#123;instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125; + node_memory_Cached_bytes&#123;instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125;)) / node_memory_MemTotal_bytes&#123;instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125; * 100&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;hide&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node02 节点&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;内存使用量（百分比）&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;current&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;decimals&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">16</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">9</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;node_filesystem_avail_bytes&#123;device=\\&quot;</span>/dev/mapper/rl-root\\<span class="string">&quot;,mountpoint=\\&quot;</span>/rootfs\\<span class="string">&quot;,instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Master01&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;node_filesystem_avail_bytes&#123;device=\\&quot;</span>/dev/mapper/rl-root\\<span class="string">&quot;,mountpoint=\\&quot;</span>/rootfs\\<span class="string">&quot;,instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node01&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;node_filesystem_avail_bytes&#123;device=\\&quot;</span>/dev/mapper/rl-root\\<span class="string">&quot;,mountpoint=\\&quot;</span>/rootfs\\<span class="string">&quot;,instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node02&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;存储空间剩余量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;current&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;bytes&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">12</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(rate(node_network_receive_bytes_total&#123;instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125;[1m]))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Master01 下行&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(rate(node_network_transmit_bytes_total&#123;instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;&#125;[1m]))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Master01 上行&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(rate(node_network_receive_bytes_total&#123;instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125;[1m]))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node01  下行&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(rate(node_network_transmit_bytes_total&#123;instance=\\&quot;</span>k8s-node01\\<span class="string">&quot;&#125;[1m]))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node01 上行&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;D&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(rate(node_network_receive_bytes_total&#123;instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125;[1m]))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node02 下行&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;E&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(rate(node_network_transmit_bytes_total&#123;instance=\\&quot;</span>k8s-node02\\<span class="string">&quot;&#125;[1m]))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;Node02 上行&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;F&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;网络 IO&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;time&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;collapsed&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">21</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">16</span><span class="punctuation">,</span><span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Pod&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;row&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">22</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">20</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;100 *  (sum(rate(container_cpu_usage_seconds_total&#123;namespace=\\&quot;</span>kube-system\\<span class="string">&quot;, pod=\\&quot;</span>kube-apiserver-k8s-master01\\<span class="string">&quot;&#125;[1m])) by (namespace, pod))&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;apiServer&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Pod  CPU 使用量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;time&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">22</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">22</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;sum(container_memory_usage_bytes&#123;namespace=\\&quot;</span>kube-system\\<span class="string">&quot;, pod=\\&quot;</span>kube-apiserver-k8s-master01\\<span class="string">&quot;&#125;) by (namespace, pod)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;apiServer&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Pod 内存使用量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;time&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;bytes&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;collapsed&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">29</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Ingress-Nginx&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;row&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;cacheTimeout&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;colorBackground&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colorValue&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colors&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;#299c46&quot;</span><span class="punctuation">,</span><span class="string">&quot;rgba(237, 129, 40, 0.89)&quot;</span><span class="punctuation">,</span><span class="string">&quot;#d44a3a&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;gauge&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;maxValue&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;minValue&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdLabels&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdMarkers&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">30</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">28</span><span class="punctuation">,</span><span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;mappingType&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;mappingTypes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;value to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;range to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;maxDataPoints&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;connected&quot;</span><span class="punctuation">,</span><span class="attr">&quot;nullText&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;postfix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;postfixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;rangeMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;to&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;sparkline&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;fillColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgba(31, 118, 189, 0.18)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;full&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;lineColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgb(31, 120, 193)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;tableColumn&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;nginx_ingress_controller_success&#123;job=\\&quot;</span>ingressnginx12\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;node01&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;node01 节点 Nginx-ingress 重载次数&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;singlestat&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;80%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="string">&quot;=&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;valueName&quot;</span><span class="punctuation">:</span><span class="string">&quot;avg&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;cacheTimeout&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;colorBackground&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colorValue&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;colors&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;#299c46&quot;</span><span class="punctuation">,</span><span class="string">&quot;rgba(237, 129, 40, 0.89)&quot;</span><span class="punctuation">,</span><span class="string">&quot;#d44a3a&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="attr">&quot;gauge&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;maxValue&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;minValue&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdLabels&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;thresholdMarkers&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">30</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">30</span><span class="punctuation">,</span><span class="attr">&quot;interval&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;mappingType&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;mappingTypes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;value to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;range to text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;maxDataPoints&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;connected&quot;</span><span class="punctuation">,</span><span class="attr">&quot;nullText&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;postfix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;postfixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;prefixFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;50%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;rangeMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;to&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;sparkline&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;fillColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgba(31, 118, 189, 0.18)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;full&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;lineColor&quot;</span><span class="punctuation">:</span><span class="string">&quot;rgb(31, 120, 193)&quot;</span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;tableColumn&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;nginx_ingress_controller_success&#123;job=\\&quot;</span>ingressnginx13\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;node02 节点 Nginx-ingress 重载次数&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;singlestat&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueFontSize&quot;</span><span class="punctuation">:</span><span class="string">&quot;80%&quot;</span><span class="punctuation">,</span><span class="attr">&quot;valueMaps&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;op&quot;</span><span class="punctuation">:</span><span class="string">&quot;=&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;N/A&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;valueName&quot;</span><span class="punctuation">:</span><span class="string">&quot;avg&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">32</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;nginx_ingress_controller_nginx_process_requests_total&#123;controller_class=\\&quot;</span>k8s.io/ingress-nginx\\<span class="string">&quot;,controller_namespace=\\&quot;</span>ingress\\<span class="string">&quot;,controller_pod=\\&quot;</span>ingress-nginx-controller-c5h6j\\<span class="string">&quot;,instance=\\&quot;</span><span class="number">192.168</span><span class="number">.10</span><span class="number">.12</span><span class="punctuation">:</span><span class="number">10254</span>\\<span class="string">&quot;,job=\\&quot;</span>ingressnginx12\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;node01&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;nginx_ingress_controller_nginx_process_requests_total&#123;controller_class=\\&quot;</span>k8s.io/ingress-nginx\\<span class="string">&quot;,controller_namespace=\\&quot;</span>ingress\\<span class="string">&quot;,controller_pod=\\&quot;</span>ingress-nginx-controller-c5h6j\\<span class="string">&quot;,instance=\\&quot;</span><span class="number">192.168</span><span class="number">.10</span><span class="number">.12</span><span class="punctuation">:</span><span class="number">10254</span>\\<span class="string">&quot;,job=\\&quot;</span>ingressnginx12\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;node02&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Ingress-Nginx 请求量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;time&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;collapsed&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">37</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;panels&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;NFS-StorageClass&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;row&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;aliasColors&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;bars&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;dashLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;dashes&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;datasource&quot;</span><span class="punctuation">:</span><span class="string">&quot;$&#123;DS_PROMETHEUS&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;fill&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;gridPos&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;h&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;w&quot;</span><span class="punctuation">:</span><span class="number">24</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">38</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">14</span><span class="punctuation">,</span><span class="attr">&quot;legend&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;current&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;lines&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;linewidth&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;links&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;nullPointMode&quot;</span><span class="punctuation">:</span><span class="string">&quot;null&quot;</span><span class="punctuation">,</span><span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;pointradius&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;points&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;renderer&quot;</span><span class="punctuation">:</span><span class="string">&quot;flot&quot;</span><span class="punctuation">,</span><span class="attr">&quot;seriesOverrides&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;spaceLength&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;stack&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;steppedLine&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;node_nfsd_disk_bytes_read_total&#123;beta_kubernetes_io_arch=\\&quot;</span>amd64\\<span class="string">&quot;,beta_kubernetes_io_os=\\&quot;</span>linux\\<span class="string">&quot;,instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;,job=\\&quot;</span>kubernetes-nodes\\<span class="string">&quot;,kubernetes_io_arch=\\&quot;</span>amd64\\<span class="string">&quot;,kubernetes_io_hostname=\\&quot;</span>k8s-master01\\<span class="string">&quot;,kubernetes_io_os=\\&quot;</span>linux\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;读取总量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;expr&quot;</span><span class="punctuation">:</span><span class="string">&quot;node_nfsd_disk_bytes_written_total&#123;beta_kubernetes_io_arch=\\&quot;</span>amd64\\<span class="string">&quot;,beta_kubernetes_io_os=\\&quot;</span>linux\\<span class="string">&quot;,instance=\\&quot;</span>k8s-master01\\<span class="string">&quot;,job=\\&quot;</span>kubernetes-nodes\\<span class="string">&quot;,kubernetes_io_arch=\\&quot;</span>amd64\\<span class="string">&quot;,kubernetes_io_hostname=\\&quot;</span>k8s-master01\\<span class="string">&quot;,kubernetes_io_os=\\&quot;</span>linux\\<span class="string">&quot;&#125;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;time_series&quot;</span><span class="punctuation">,</span><span class="attr">&quot;intervalFactor&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;legendFormat&quot;</span><span class="punctuation">:</span><span class="string">&quot;写入总量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;refId&quot;</span><span class="punctuation">:</span><span class="string">&quot;B&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;thresholds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;timeFrom&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;timeShift&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;NFS storageClass 读取文件总量&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tooltip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;shared&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;value_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;individual&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;graph&quot;</span><span class="punctuation">,</span><span class="attr">&quot;xaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;buckets&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span><span class="string">&quot;time&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;values&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;yaxes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;decbytes&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span><span class="string">&quot;short&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;logBase&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;max&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;min&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;show&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;yaxis&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;align&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;alignLevel&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;refresh&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;schemaVersion&quot;</span><span class="punctuation">:</span><span class="number">16</span><span class="punctuation">,</span><span class="attr">&quot;style&quot;</span><span class="punctuation">:</span><span class="string">&quot;dark&quot;</span><span class="punctuation">,</span><span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;templating&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;time&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="string">&quot;now-6h&quot;</span><span class="punctuation">,</span><span class="attr">&quot;to&quot;</span><span class="punctuation">:</span><span class="string">&quot;now&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;timepicker&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;refresh_intervals&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;5s&quot;</span><span class="punctuation">,</span><span class="string">&quot;10s&quot;</span><span class="punctuation">,</span><span class="string">&quot;30s&quot;</span><span class="punctuation">,</span><span class="string">&quot;1m&quot;</span><span class="punctuation">,</span><span class="string">&quot;5m&quot;</span><span class="punctuation">,</span><span class="string">&quot;15m&quot;</span><span class="punctuation">,</span><span class="string">&quot;30m&quot;</span><span class="punctuation">,</span><span class="string">&quot;1h&quot;</span><span class="punctuation">,</span><span class="string">&quot;2h&quot;</span><span class="punctuation">,</span><span class="string">&quot;1d&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;time_options&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;5m&quot;</span><span class="punctuation">,</span><span class="string">&quot;15m&quot;</span><span class="punctuation">,</span><span class="string">&quot;1h&quot;</span><span class="punctuation">,</span><span class="string">&quot;6h&quot;</span><span class="punctuation">,</span><span class="string">&quot;12h&quot;</span><span class="punctuation">,</span><span class="string">&quot;24h&quot;</span><span class="punctuation">,</span><span class="string">&quot;2d&quot;</span><span class="punctuation">,</span><span class="string">&quot;7d&quot;</span><span class="punctuation">,</span><span class="string">&quot;30d&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;timezone&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Kubernetes 监控&quot;</span><span class="punctuation">,</span><span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span><span class="string">&quot;Lwdu47xIk&quot;</span><span class="punctuation">,</span><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="number">33</span><span class="punctuation">&#125;</span></code></pre>

<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/24/20250724-082411.png" alt="导入监控配置Json文件"></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/24/20250724-082434.png" alt="选择json文件"></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/24/20250724-082630.png" alt="点击导入"></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/24/20250724-082736.png" alt="查看监控指标"></p>
<h1 id="十一、监控-metrics-server"><a href="#十一、监控-metrics-server" class="headerlink" title="十一、监控 metrics.server"></a>十一、监控 metrics.server</h1><p>从 Kubernetes v1.8 开始，资源使用情况的监控可以通过 Metrics API 的形式获取，例如容器 CPU 和内存使用率。这些度量可以由用户直接访问（例如，通过使用 kubectl top 命令），或者由集群中的控制器（例如，Horizontal Pod Autoscaler）使用来进行决策，具体的组件为 Metrics Server，用来替换之前的 heapster，heapster 从 1.11 开始逐渐被废弃。</p>
<p>Metrics-Server 是集群核心监控数据的聚合器。通俗地说，它存储了集群中各节点的监控数据，并且提供了 API 以供分析和使用。Metrics-Server 作为一个 Deployment 对象默认部署在 Kubernetes 集群中。不过准确地说，它是 Deployment，Service，ClusterRole，ClusterRoleBinding，APIService，RoleBinding 等资源对象的综合体。</p>
<pre><code class="highlight bash"><span class="comment"># https://github.com/kubernetes-sigs/metrics-server</span>
https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.7.0/components.yaml</code></pre>

<p>当前 K8S 版本 1.29.0 ，使用 Metrics Server 版本 0.7.0.</p>
<p>下载后的资源清单稍作修改，<strong>跳过 Kubelet TLS 验证</strong></p>
<p><code>components.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ServiceAccount</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">name:</span> <span class="string">metrics-server</span>
  <span class="attr">namespace:</span> <span class="string">kube-system</span>
<span class="meta">---</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">ClusterRole</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
    <span class="attr">rbac.authorization.k8s.io/aggregate-to-admin:</span> <span class="string">&quot;true&quot;</span>
    <span class="attr">rbac.authorization.k8s.io/aggregate-to-edit:</span> <span class="string">&quot;true&quot;</span>
    <span class="attr">rbac.authorization.k8s.io/aggregate-to-view:</span> <span class="string">&quot;true&quot;</span>
  <span class="attr">name:</span> <span class="string">system:aggregated-metrics-reader</span>
<span class="attr">rules:</span>
<span class="bullet">-</span> <span class="attr">apiGroups:</span>
  <span class="bullet">-</span> <span class="string">metrics.k8s.io</span>
  <span class="attr">resources:</span>
  <span class="bullet">-</span> <span class="string">pods</span>
  <span class="bullet">-</span> <span class="string">nodes</span>
  <span class="attr">verbs:</span>
  <span class="bullet">-</span> <span class="string">get</span>
  <span class="bullet">-</span> <span class="string">list</span>
  <span class="bullet">-</span> <span class="string">watch</span>
<span class="meta">---</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">ClusterRole</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">name:</span> <span class="string">system:metrics-server</span>
<span class="attr">rules:</span>
<span class="bullet">-</span> <span class="attr">apiGroups:</span>
  <span class="bullet">-</span> <span class="string">&quot;&quot;</span>
  <span class="attr">resources:</span>
  <span class="bullet">-</span> <span class="string">nodes/metrics</span>
  <span class="attr">verbs:</span>
  <span class="bullet">-</span> <span class="string">get</span>
<span class="bullet">-</span> <span class="attr">apiGroups:</span>
  <span class="bullet">-</span> <span class="string">&quot;&quot;</span>
  <span class="attr">resources:</span>
  <span class="bullet">-</span> <span class="string">pods</span>
  <span class="bullet">-</span> <span class="string">nodes</span>
  <span class="attr">verbs:</span>
  <span class="bullet">-</span> <span class="string">get</span>
  <span class="bullet">-</span> <span class="string">list</span>
  <span class="bullet">-</span> <span class="string">watch</span>
<span class="meta">---</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">RoleBinding</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">name:</span> <span class="string">metrics-server-auth-reader</span>
  <span class="attr">namespace:</span> <span class="string">kube-system</span>
<span class="attr">roleRef:</span>
  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>
  <span class="attr">kind:</span> <span class="string">Role</span>
  <span class="attr">name:</span> <span class="string">extension-apiserver-authentication-reader</span>
<span class="attr">subjects:</span>
<span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span>
  <span class="attr">name:</span> <span class="string">metrics-server</span>
  <span class="attr">namespace:</span> <span class="string">kube-system</span>
<span class="meta">---</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">name:</span> <span class="string">metrics-server:system:auth-delegator</span>
<span class="attr">roleRef:</span>
  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>
  <span class="attr">kind:</span> <span class="string">ClusterRole</span>
  <span class="attr">name:</span> <span class="string">system:auth-delegator</span>
<span class="attr">subjects:</span>
<span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span>
  <span class="attr">name:</span> <span class="string">metrics-server</span>
  <span class="attr">namespace:</span> <span class="string">kube-system</span>
<span class="meta">---</span>
<span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">name:</span> <span class="string">system:metrics-server</span>
<span class="attr">roleRef:</span>
  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>
  <span class="attr">kind:</span> <span class="string">ClusterRole</span>
  <span class="attr">name:</span> <span class="string">system:metrics-server</span>
<span class="attr">subjects:</span>
<span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span>
  <span class="attr">name:</span> <span class="string">metrics-server</span>
  <span class="attr">namespace:</span> <span class="string">kube-system</span>
<span class="meta">---</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">Service</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">name:</span> <span class="string">metrics-server</span>
  <span class="attr">namespace:</span> <span class="string">kube-system</span>
<span class="attr">spec:</span>
  <span class="attr">ports:</span>
  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span>
    <span class="attr">port:</span> <span class="number">443</span>
    <span class="attr">protocol:</span> <span class="string">TCP</span>
    <span class="attr">targetPort:</span> <span class="string">https</span>
  <span class="attr">selector:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
<span class="meta">---</span>
<span class="attr">apiVersion:</span> <span class="string">apps/v1</span>
<span class="attr">kind:</span> <span class="string">Deployment</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">name:</span> <span class="string">metrics-server</span>
  <span class="attr">namespace:</span> <span class="string">kube-system</span>
<span class="attr">spec:</span>
  <span class="attr">selector:</span>
    <span class="attr">matchLabels:</span>
      <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">strategy:</span>
    <span class="attr">rollingUpdate:</span>
      <span class="attr">maxUnavailable:</span> <span class="number">0</span>
  <span class="attr">template:</span>
    <span class="attr">metadata:</span>
      <span class="attr">labels:</span>
        <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
    <span class="attr">spec:</span>
      <span class="attr">containers:</span>
      <span class="bullet">-</span> <span class="attr">args:</span>
        <span class="bullet">-</span> <span class="string">--cert-dir=/tmp</span>
        <span class="bullet">-</span> <span class="string">--secure-port=10250</span>
        <span class="bullet">-</span> <span class="string">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span>
        <span class="bullet">-</span> <span class="string">--kubelet-use-node-status-port</span>
        <span class="bullet">-</span> <span class="string">--kubelet-insecure-tls</span>  <span class="comment"># 跳过 Kubelet TLS 验证</span>
        <span class="bullet">-</span> <span class="string">--metric-resolution=15s</span>
        <span class="attr">image:</span> <span class="string">registry.k8s.io/metrics-server/metrics-server:v0.7.0</span>
        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>
        <span class="attr">livenessProbe:</span>
          <span class="attr">failureThreshold:</span> <span class="number">3</span>
          <span class="attr">httpGet:</span>
            <span class="attr">path:</span> <span class="string">/livez</span>
            <span class="attr">port:</span> <span class="string">https</span>
            <span class="attr">scheme:</span> <span class="string">HTTPS</span>
          <span class="attr">periodSeconds:</span> <span class="number">10</span>
        <span class="attr">name:</span> <span class="string">metrics-server</span>
        <span class="attr">ports:</span>
        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">10250</span>
          <span class="attr">name:</span> <span class="string">https</span>
          <span class="attr">protocol:</span> <span class="string">TCP</span>
        <span class="attr">readinessProbe:</span>
          <span class="attr">failureThreshold:</span> <span class="number">3</span>
          <span class="attr">httpGet:</span>
            <span class="attr">path:</span> <span class="string">/readyz</span>
            <span class="attr">port:</span> <span class="string">https</span>
            <span class="attr">scheme:</span> <span class="string">HTTPS</span>
          <span class="attr">initialDelaySeconds:</span> <span class="number">20</span>
          <span class="attr">periodSeconds:</span> <span class="number">10</span>
        <span class="attr">resources:</span>
          <span class="attr">requests:</span>
            <span class="attr">cpu:</span> <span class="string">100m</span>
            <span class="attr">memory:</span> <span class="string">200Mi</span>
        <span class="attr">securityContext:</span>
          <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">false</span>
          <span class="attr">capabilities:</span>
            <span class="attr">drop:</span>
            <span class="bullet">-</span> <span class="string">ALL</span>
          <span class="attr">readOnlyRootFilesystem:</span> <span class="literal">true</span>
          <span class="attr">runAsNonRoot:</span> <span class="literal">true</span>
          <span class="attr">runAsUser:</span> <span class="number">1000</span>
          <span class="attr">seccompProfile:</span>
            <span class="attr">type:</span> <span class="string">RuntimeDefault</span>
        <span class="attr">volumeMounts:</span>
        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/tmp</span>
          <span class="attr">name:</span> <span class="string">tmp-dir</span>
      <span class="attr">nodeSelector:</span>
        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span>
      <span class="attr">priorityClassName:</span> <span class="string">system-cluster-critical</span>
      <span class="attr">serviceAccountName:</span> <span class="string">metrics-server</span>
      <span class="attr">volumes:</span>
      <span class="bullet">-</span> <span class="attr">emptyDir:</span> &#123;&#125;
        <span class="attr">name:</span> <span class="string">tmp-dir</span>
<span class="meta">---</span>
<span class="attr">apiVersion:</span> <span class="string">apiregistration.k8s.io/v1</span>
<span class="attr">kind:</span> <span class="string">APIService</span>
<span class="attr">metadata:</span>
  <span class="attr">labels:</span>
    <span class="attr">k8s-app:</span> <span class="string">metrics-server</span>
  <span class="attr">name:</span> <span class="string">v1beta1.metrics.k8s.io</span>
<span class="attr">spec:</span>
  <span class="attr">group:</span> <span class="string">metrics.k8s.io</span>
  <span class="attr">groupPriorityMinimum:</span> <span class="number">100</span>
  <span class="attr">insecureSkipTLSVerify:</span> <span class="literal">true</span>
  <span class="attr">service:</span>
    <span class="attr">name:</span> <span class="string">metrics-server</span>
    <span class="attr">namespace:</span> <span class="string">kube-system</span>
  <span class="attr">version:</span> <span class="string">v1beta1</span>
  <span class="attr">versionPriority:</span> <span class="number">100</span></code></pre>



<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单，部署 metrics-server</span>
$ kubectl apply -f components.yaml

<span class="comment"># 查看 Pod</span>
$ kubectl get pod -n kube-system  -o wide -w | grep metrics-server 
metrics-server-56cfc8b678-b77wb            1/1     Running   0               59s   192.168.85.217   k8s-node01     &lt;none&gt;           &lt;none&gt;</code></pre>



<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/24/20250724-104820.png" alt="metric-server 监控数据原理"></p>
<h1 id="十二、alertmanager-部署"><a href="#十二、alertmanager-部署" class="headerlink" title="十二、alertmanager 部署"></a>十二、alertmanager 部署</h1><h2 id="1-创建-alertmanager-配置文件"><a href="#1-创建-alertmanager-配置文件" class="headerlink" title="1. 创建 alertmanager 配置文件"></a>1. 创建 alertmanager 配置文件</h2><p>资源清单：<code>alertmanager-conf.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">alert-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">config.yml:</span> <span class="string">|-</span>
<span class="string">    global:</span>
<span class="string">      # 定义告警在没有新触发的情况下被标记为已解决（resolved）的时间，设置为 5 分钟。</span>
<span class="string">      resolve_timeout: 5m</span>
<span class="string">      # 配置邮件发送信息</span>
<span class="string">      smtp_smarthost: &#x27;smtp.163.com:25&#x27;             # 指定 SMTP 服务器地址和端口，用于发送邮件通知</span>
<span class="string">      smtp_from: &#x27;18326088610@163.com&#x27;              # 邮件发送者的地址，显示为发件人（From 字段）</span>
<span class="string">      smtp_auth_username: &#x27;18326088610@163.com&#x27;     # SMTP 认证用户名，与发件人地址一致</span>
<span class="string">      smtp_auth_password: &#x27;xxxxxxxxxxxxxxxx&#x27;        # SMTP 认证密码，通常是 163 邮箱的授权码（非登录密码）</span>
<span class="string">      smtp_hello: &#x27;163.com&#x27;                         # SMTP 客户端在与服务器建立连接时发送的 HELO/EHLO 域名，设置为 163.com</span>
<span class="string">      smtp_require_tls: false                       # 禁用 TLS 加密，邮件通过明文传输（端口 25 通常不加密）</span>
<span class="string">    route:    # 定义告警的路由策略，决定如何分组、处理和分发告警</span>
<span class="string">      # 这里的标签列表是接收到报警信息后的重新分组标签，例如，接收到的报警信息里面有许多具有 cluster=A 和 alertname=LatncyHigh 这样的标签的报警信息将会批量被聚合到一个分组里面</span>
<span class="string">      group_by: [&#x27;alertname&#x27;, &#x27;cluster&#x27;]</span>
<span class="string">      # 当一个新的报警分组被创建后，需要等待至少group_wait时间来初始化通知，这种方式可以确保您能有足够的时间为同一分组来获取多个警报，然后一起触发这个报警信息。</span>
<span class="string">      group_wait: 30s</span>
<span class="string">      # 当第一个报警发送后，等待&#x27;group_interval&#x27;时间来发送新的一组报警信息。</span>
<span class="string">      group_interval: 5m</span>
<span class="string">      # 如果一个报警信息已经发送成功了，等待&#x27;repeat_interval&#x27;时间来重新发送他们</span>
<span class="string">      repeat_interval: 5m</span>
<span class="string">      # 默认的receiver：如果一个报警没有被一个route匹配，则发送给默认的接收器</span>
<span class="string">      receiver: default</span>
<span class="string">      # 上面所有的属性都由所有子路由继承，并且可以在每个子路由上进行覆盖。</span>
<span class="string">      routes:</span>
<span class="string">        - receiver: email   # 匹配子路由的告警发送到 email 接收器</span>
<span class="string">          group_wait: 10s   # 子路由覆盖父路由的 group_wait，仅等待 10 秒发送通知</span>
<span class="string">          match:</span>
<span class="string">            team: node      # 仅匹配带有标签 team=node 的告警（如 Prometheus 规则中定义的 HighNodeCPU 告警）</span>
<span class="string">    receivers:              # 定义告警通知的接收器，指定通知方式和目标</span>
<span class="string">      - name: &#x27;default&#x27;</span>
<span class="string">        email_configs:</span>
<span class="string">          - to: &#x27;george_95@126.com&#x27;     # 告警邮件发送到 george_95@126.com</span>
<span class="string">            send_resolved: true         # 当告警解决时，发送“已恢复”通知邮件</span>
<span class="string">      - name: &#x27;email&#x27;                   # 自定义接收器，处理匹配 team: node 的告警</span>
<span class="string">        email_configs:</span>
<span class="string">          - to: &#x27;george_95@126.com&#x27;     # 告警邮件发送到 george_95@126.com</span>
<span class="string">            send_resolved: true         # 当告警解决时，发送“已恢复”通知邮件</span></code></pre>

<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash">$ kubectl apply -f alertmanager-conf.yaml</code></pre>



<h2 id="2-修改-Prometheus-ConfigMap-2"><a href="#2-修改-Prometheus-ConfigMap-2" class="headerlink" title="2. 修改 Prometheus ConfigMap"></a>2. 修改 Prometheus ConfigMap</h2><p><code>prometheus-cm.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">rules.yml:</span> <span class="string">|</span>          <span class="comment"># 配置Prometheus告警规则，内存使用超过 20% 就告警</span>
    <span class="attr">groups:</span>
      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-rule</span>
        <span class="attr">rules:</span>
          <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">NodeMemoryUsage</span>
            <span class="attr">expr:</span> <span class="string">(node_memory_MemTotal_bytes</span> <span class="bullet">-</span> <span class="string">(node_memory_MemFree_bytes</span> <span class="string">+</span> <span class="string">node_memory_Buffers_bytes</span> <span class="string">+</span> <span class="string">node_memory_Cached_bytes))</span> <span class="string">/</span> <span class="string">node_memory_MemTotal_bytes</span> <span class="string">*</span> <span class="number">100</span> <span class="string">&gt;</span> <span class="number">20</span>
            <span class="attr">for:</span> <span class="string">2m</span>       <span class="comment"># 告警条件需持续满足 2 分钟（2m）才会触发</span>
            <span class="attr">labels:</span>       <span class="comment"># 为告警添加标签 team=node，用于路由和分组</span>
              <span class="attr">team:</span> <span class="string">node</span>
            <span class="attr">annotations:</span>  <span class="comment"># 提供告警的附加信息，显示在通知（如邮件）中</span>
              <span class="attr">summary:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span>: High Memory usage detected&quot;</span>
              <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span>: Memory usage is above 20% (current value is: <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span>
  <span class="attr">prometheus.yml:</span> <span class="string">|</span>           <span class="comment"># 使用 | 表示 YAML 中的多行文本</span>
    <span class="attr">global:</span>                   <span class="comment"># 定义 Prometheus 的全局配置，适用于所有抓取任务（除非在具体任务中被覆盖）</span>
      <span class="attr">scrape_interval:</span> <span class="string">15s</span>    <span class="comment"># 表示 prometheus 抓取指标数据的频率，默认是 15s</span>
      <span class="attr">scrape_timeout:</span> <span class="string">15s</span>     <span class="comment"># 表示 prometheus 抓取指标数据的超时时间，默认是 15s</span>
    <span class="attr">scrape_configs:</span>
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span>  <span class="comment"># 定义任务名，这里监控 prometheus 自身</span>
      <span class="attr">static_configs:</span>
      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]
        
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx140&#x27;</span>         <span class="comment"># 10.20.1.140 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.140:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx141&#x27;</span>         <span class="comment"># 10.20.1.141 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.141:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx142&#x27;</span>         <span class="comment"># 10.20.1.142 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.142:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-nodes&#x27;</span>        <span class="comment"># 基于Node自动发现节点，并抓取指标信息。Node Exporter：提供系统级指标，适合监控节点的硬件和操作系统状态（如磁盘 I/O、网络流量）。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]    <span class="comment"># 默认抓取节点的 Kubelet 端点（端口 10250，/metrics），但这里通过 relabel_configs 修改为 Node Exporter 的端口（9100）</span>
          <span class="attr">regex:</span> <span class="string">&#x27;(.*):10250&#x27;</span>
          <span class="attr">replacement:</span> <span class="string">&#x27;$&#123;1&#125;:9100&#x27;</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">action:</span> <span class="string">replace</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-kubelet&#x27;</span>      <span class="comment"># 基于Node发现，从 Kubelet 抓取指标信息。Kubelet：提供 Kubernetes 特定指标，如 Pod 运行状态、Kubelet 的健康状况和 API 请求统计。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># k8s 自动为pod挂载的证书文件路径,在pod内部</span>
        <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># k8s 自动为pod挂载的token文件路径，在pod内部</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>                            <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-cadvisor&#x27;</span>                                         <span class="comment"># 抓取任务名称为 kubernetes-cadvisor，用于监控 Kubernetes 节点的 cAdvisor 指标</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                           <span class="comment"># 指定使用 HTTPS 协议访问目标（Kubernetes API 服务器的 443 端口）</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Pod 内部的服务账号卷挂载的 CA 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌</span>
      <span class="attr">relabel_configs:</span>                                              <span class="comment"># 定义标签重写规则，修改服务发现的目标地址和路径</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                                          <span class="comment"># 规则1：将节点的标签（如 kubernetes.io/hostname）映射到 Prometheus 指标标签 </span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
        <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span>                   <span class="comment"># 规则2：将抓取目标地址设置为 kubernetes.default.svc:443，即 Kubernetes API 服务器的 ClusterIP 服务（默认命名空间 default，端口 443）</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]              <span class="comment"># 规则3：使用节点名称（__meta_kubernetes_node_name，如 node01）动态构造指标路径</span>
          <span class="attr">regex:</span> <span class="string">(.+)</span>
          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span>
          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics/cadvisor</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-apiservers&#x27;</span>                             <span class="comment"># 抓取任务名称为 kubernetes-apiservers，用于监控 Kubernetes API 服务器的指标，包括请求速率、延迟、错误率等（如 apiserver_request_total, apiserver_request_duration_seconds）</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span>                                           <span class="comment"># 使用 Kubernetes 服务发现，角色为 endpoints，发现集群中的所有 Endpoints 对象</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                 <span class="comment"># Kubernetes API 服务器默认通过 HTTPS（端口 443）暴露 /metrics 端点</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Prometheus Pod 内部的服务账号卷挂载的 CA 证书（位于 /var/run/secrets/kubernetes.io/serviceaccount/ca.crt）验证 API 服务器的 TLS 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌（位于 /var/run/secrets/kubernetes.io/serviceaccount/token）进行身份验证</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>, <span class="string">__meta_kubernetes_service_name</span>, <span class="string">__meta_kubernetes_endpoint_port_name</span>]    <span class="comment"># 断点所在的名称空间，断点所在的 Service， 断点端口名称</span>
          <span class="attr">action:</span> <span class="string">keep</span>                      <span class="comment"># 仅保留匹配正则表达式的端点，未匹配的端点被丢弃。</span>
          <span class="attr">regex:</span> <span class="string">default;kubernetes;https</span>   <span class="comment"># 确保 Prometheus 只抓取 default 命名空间中 kubernetes 服务的 HTTPS 端点（即 API 服务器的 /metrics）</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-service-endpoints&#x27;</span>        <span class="comment"># 抓取任务名称为 kubernetes-service-endpoints，用于监控 Kubernetes Service 的 Endpoints 指标。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span>                             <span class="comment"># 使用 Kubernetes 服务发现，角色为 endpoints，发现集群中所有 Service 的 Endpoints 对象</span>
      <span class="attr">relabel_configs:</span>                                <span class="comment"># 定义标签重写规则，过滤和配置服务发现的目标，确保只抓取符合条件的 Service Endpoints</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scrape</span>]
          <span class="attr">action:</span> <span class="string">keep</span>                                <span class="comment"># 仅保留注解 prometheus.io/scrape: &quot;true&quot; 的 Service Endpoints，未匹配的被丢弃</span>
          <span class="attr">regex:</span> <span class="literal">true</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scheme</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 将匹配的值替换到 __scheme__ 标签，决定抓取协议（http 或 https），允许 Service 指定是否通过 HTTPS 抓取指标，适用于需要安全连接的场景</span>
          <span class="attr">target_label:</span> <span class="string">__scheme__</span>
          <span class="attr">regex:</span> <span class="string">(https?)</span>                             <span class="comment"># 匹配 http 或 https，若注解未设置，默认使用 http</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_path</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 检查 Service 的注解 prometheus.io/path，将匹配的值替换到 __metrics_path__ 标签，指定指标端点的路径</span>
          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span>
          <span class="attr">regex:</span> <span class="string">(.+)</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>, <span class="string">__meta_kubernetes_service_annotation_prometheus_io_port</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 将地址和端口组合替换到 __address__ 标签，允许 Service 指定抓取端口（如 prometheus.io/port: &quot;8080&quot;），覆盖 Endpoints 的默认端口</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">regex:</span> <span class="string">([^:]+)(?::\d+)?;(\d+)</span>
          <span class="attr">replacement:</span> <span class="string">$1:$2</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                            <span class="comment"># 将 Service 的标签（如 app=my-app）映射到 Prometheus 指标标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_service_label_(.+)</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>]      <span class="comment"># 将 Service 的命名空间（__meta_kubernetes_namespace）写入指标标签 kubernetes_namespace</span>
          <span class="attr">action:</span> <span class="string">replace</span>
          <span class="attr">target_label:</span> <span class="string">kubernetes_namespace</span>          
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_name</span>]   <span class="comment"># 将 Service 名称（__meta_kubernetes_service_name）写入指标标签 kubernetes_name</span>
          <span class="attr">action:</span> <span class="string">replace</span>
          <span class="attr">target_label:</span> <span class="string">kubernetes_name</span>
          
    <span class="attr">alerting:</span>               <span class="comment"># 定义 Prometheus 与 Alertmanager 的连接，用于发送告警</span>
      <span class="attr">alertmanagers:</span>        <span class="comment"># 指定 Alertmanager 实例的地址</span>
        <span class="bullet">-</span> <span class="attr">static_configs:</span>
            <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;prometheus.kube-ops.svc.cluster.local:9093&quot;</span>]   <span class="comment"># &lt;service-name&gt;.&lt;namespace&gt;.svc.&lt;cluster-domain&gt;，注意 这里Service名称是 prometheus</span></code></pre>

<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash">$ kubectl apply -f prometheus-cm.yaml</code></pre>



<h2 id="3-修改-Prometheus-Service"><a href="#3-修改-Prometheus-Service" class="headerlink" title="3. 修改 Prometheus Service"></a>3. 修改 Prometheus Service</h2><p>资源清单：<code>prometheus.yaml</code></p>
<pre><code class="highlight yaml"><span class="comment"># Service</span>
<span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">Service</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
  <span class="attr">labels:</span>
    <span class="attr">app:</span> <span class="string">prometheus</span>
<span class="attr">spec:</span>
  <span class="attr">selector:</span>
    <span class="attr">app:</span> <span class="string">prometheus</span>
  <span class="attr">type:</span> <span class="string">NodePort</span>
  <span class="attr">ports:</span>
    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus</span>  <span class="comment"># 端口名称</span>
      <span class="attr">port:</span> <span class="number">9090</span>            <span class="comment"># service 对外端口 9090</span>
      <span class="attr">targetPort:</span> <span class="number">9090</span>      <span class="comment"># 内部名为 http 的端口 （9090）</span>
    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">alertmanager</span>    <span class="comment"># altermanager 端口配置</span>
      <span class="attr">port:</span> <span class="number">9093</span>
      <span class="attr">targetPort:</span> <span class="number">9093</span></code></pre>



<h2 id="4-合并-altermanager-至-prometheus-deploy-文件"><a href="#4-合并-altermanager-至-prometheus-deploy-文件" class="headerlink" title="4. 合并 altermanager 至 prometheus deploy 文件"></a>4. 合并 altermanager 至 prometheus deploy 文件</h2><p>资源清单：<code>prometheus.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>
<span class="attr">kind:</span> <span class="string">Deployment</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
  <span class="attr">labels:</span>
    <span class="attr">app:</span> <span class="string">prometheus</span>
<span class="attr">spec:</span>
  <span class="attr">replicas:</span> <span class="number">1</span>               <span class="comment"># Pod 副本数为1</span>
  <span class="attr">selector:</span>
    <span class="attr">matchLabels:</span>
      <span class="attr">app:</span> <span class="string">prometheus</span>
  <span class="attr">template:</span>
    <span class="attr">metadata:</span>
      <span class="attr">labels:</span>
        <span class="attr">app:</span> <span class="string">prometheus</span>
    <span class="attr">spec:</span>
      <span class="attr">serviceAccountName:</span> <span class="string">prometheus</span>    <span class="comment"># 指定 Pod 使用的 Kubernetes 服务账号（ServiceAccount）为 prometheus</span>
      <span class="attr">containers:</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">alertmanager</span>
          <span class="attr">image:</span> <span class="string">prom/alertmanager:v0.28.0</span>
          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>
          <span class="attr">args:</span>
            <span class="bullet">-</span> <span class="string">&quot;--config.file=/etc/alertmanager/config.yml&quot;</span>
            <span class="bullet">-</span> <span class="string">&quot;--storage.path=/alertmanager/data&quot;</span>
          <span class="attr">ports:</span>
            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9093</span>
              <span class="attr">name:</span> <span class="string">alertmanager</span>
          <span class="attr">volumeMounts:</span>
            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/etc/alertmanager&quot;</span>
              <span class="attr">name:</span> <span class="string">alertcfg</span>
          <span class="attr">resources:</span>
            <span class="attr">requests:</span>
              <span class="attr">cpu:</span> <span class="string">300m</span>
              <span class="attr">memory:</span> <span class="string">512Mi</span>
            <span class="attr">limits:</span>
              <span class="attr">cpu:</span> <span class="string">300m</span>
              <span class="attr">memory:</span> <span class="string">512Mi</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus</span>
          <span class="attr">image:</span> <span class="string">prom/prometheus:v2.54.1</span>
          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span>
          <span class="attr">command:</span>
            <span class="bullet">-</span> <span class="string">&quot;/bin/prometheus&quot;</span>         <span class="comment"># 指定容器启动时运行的命令为 /bin/prometheus，这是 Prometheus 的主可执行文件</span>
          <span class="attr">args:</span>
            <span class="bullet">-</span> <span class="string">&quot;--config.file=/etc/prometheus/prometheus.yml&quot;</span>    <span class="comment"># 指定 Prometheus 的配置文件路径为 /etc/prometheus/prometheus.yml，这个文件由 ConfigMap（prometheus-config）提供，挂载到容器内</span>
            <span class="bullet">-</span> <span class="string">&quot;--storage.tsdb.path=/prometheus&quot;</span>                 <span class="comment"># 指定 Prometheus 时间序列数据库（TSDB）的存储路径为 /prometheus，这个路径由 PVC（prometheus）提供，持久化存储数据</span>
            <span class="bullet">-</span> <span class="string">&quot;--storage.tsdb.retention=24h&quot;</span>                    <span class="comment"># 设置数据保留时间为 24 小时，意味着 Prometheus 只保留最近 24 小时的监控数据，旧数据将被删除。生产环境建议 15-30天</span>
            <span class="bullet">-</span> <span class="string">&quot;--web.enable-admin-api&quot;</span>                          <span class="comment"># 启用 Prometheus 的 Admin HTTP API，允许执行管理操作（如删除时间序列）</span>
            <span class="bullet">-</span> <span class="string">&quot;--web.enable-lifecycle&quot;</span>                          <span class="comment"># 启用生命周期 API，支持通过 HTTP 请求（如 localhost:9090/-/reload）动态重新加载配置文件。</span>
          <span class="attr">ports:</span>
            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9090</span>       <span class="comment"># 指定 Prometheus 监听端口，用于提供 Web UI 和 API</span>
              <span class="attr">protocol:</span> <span class="string">TCP</span>
              <span class="attr">name:</span> <span class="string">http</span>
          <span class="attr">volumeMounts:</span>                 <span class="comment"># 定义容器内的挂载点，将卷挂载到指定路径</span>
            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/prometheus&quot;</span>  <span class="comment"># 将名为 data 的卷挂载到容器内的 /prometheus 路径，用于存储 TSDB 数据</span>
              <span class="attr">subPath:</span> <span class="string">prometheus</span>       <span class="comment"># 表示使用卷中的子路径 prometheus，避免覆盖整个卷的其他内容</span>
              <span class="attr">name:</span> <span class="string">data</span>                <span class="comment"># 卷由 PVC（prometheus）提供</span>
            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/etc/prometheus&quot;</span>      <span class="comment"># 将名为 config-volume 的卷挂载到容器内的 /etc/prometheus 路径，用于存储配置文件</span>
              <span class="attr">name:</span> <span class="string">config-volume</span>               <span class="comment"># 由 ConfigMap（prometheus-config）提供</span>
          <span class="attr">resources:</span>
            <span class="attr">requests:</span>
              <span class="attr">cpu:</span> <span class="string">500m</span>                 <span class="comment"># 请求 100 毫核（0.1 CPU 核心），表示容器需要的最小 CPU 资源</span>
              <span class="attr">memory:</span> <span class="string">1024Mi</span>             <span class="comment"># 请求 512 MiB 内存，表示容器需要的最小内存</span>
            <span class="attr">limits:</span>
              <span class="attr">cpu:</span> <span class="string">500m</span>                 <span class="comment"># 限制容器最多使用 100 毫核 CPU，防止过量占用</span>
              <span class="attr">memory:</span> <span class="string">1024Mi</span>             <span class="comment"># 限制容器最多使用 512 MiB 内存，防止内存溢出</span>
      <span class="attr">securityContext:</span>                  <span class="comment"># 定义 Pod 的安全上下文，控制容器运行时的权限</span>
        <span class="attr">runAsUser:</span> <span class="number">0</span>                    <span class="comment"># 指定容器以用户 ID 0（即 root 用户）运行</span>
      <span class="attr">volumes:</span>                          <span class="comment"># 定义 Pod 使用的卷，供容器挂载</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span>
          <span class="attr">persistentVolumeClaim:</span>        <span class="comment"># 指定挂载的PVC</span>
            <span class="attr">claimName:</span> <span class="string">prometheus</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span>
          <span class="attr">configMap:</span>                    <span class="comment"># 指定挂载的 configMap</span>
            <span class="attr">name:</span> <span class="string">prometheus-config</span>
        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">alertcfg</span>                <span class="comment"># 挂载AlertManager ConfigMap</span>
          <span class="attr">configMap:</span>
            <span class="attr">name:</span> <span class="string">alert-config</span></code></pre>

<p>这里要注意 prometheus 和 alertmanager 不能太旧，否则无法适配当前的 SMTP 协议。</p>
<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单，重新加载 Service 和 Deployment</span>
$ kubectl apply -f prometheus.yaml</code></pre>



<h2 id="5-添加报警演示"><a href="#5-添加报警演示" class="headerlink" title="5. 添加报警演示"></a>5. 添加报警演示</h2><p>修改 Prometheus ConfigMap，添加监控 <strong>内存使用量</strong></p>
<p>资源清单：<code>prometheus-cm.yaml</code></p>
<pre><code class="highlight yaml"><span class="attr">apiVersion:</span> <span class="string">v1</span>
<span class="attr">kind:</span> <span class="string">ConfigMap</span>
<span class="attr">metadata:</span>
  <span class="attr">name:</span> <span class="string">prometheus-config</span>
  <span class="attr">namespace:</span> <span class="string">kube-ops</span>
<span class="attr">data:</span>
  <span class="attr">rules.yml:</span> <span class="string">|</span>          <span class="comment"># 配置Prometheus告警规则，内存使用超过 20% 就告警</span>
    <span class="attr">groups:</span>
      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-rule</span>
        <span class="attr">rules:</span>
          <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">NodeMemoryUsage</span>
            <span class="attr">expr:</span> <span class="string">(node_memory_MemTotal_bytes</span> <span class="bullet">-</span> <span class="string">(node_memory_MemFree_bytes</span> <span class="string">+</span> <span class="string">node_memory_Buffers_bytes</span> <span class="string">+</span> <span class="string">node_memory_Cached_bytes))</span> <span class="string">/</span> <span class="string">node_memory_MemTotal_bytes</span> <span class="string">*</span> <span class="number">100</span> <span class="string">&gt;</span> <span class="number">20</span>
            <span class="attr">for:</span> <span class="string">2m</span>       <span class="comment"># 告警条件需持续满足 2 分钟（2m）才会触发</span>
            <span class="attr">labels:</span>       <span class="comment"># 为告警添加标签 team=node，用于路由和分组</span>
              <span class="attr">team:</span> <span class="string">node</span>
            <span class="attr">annotations:</span>  <span class="comment"># 提供告警的附加信息，显示在通知（如邮件）中</span>
              <span class="attr">summary:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span>: High Memory usage detected&quot;</span>
              <span class="attr">description:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;$labels.instance&#125;&#125;</span>: Memory usage is above 20% (current value is: <span class="template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span>
  <span class="attr">prometheus.yml:</span> <span class="string">|</span>           <span class="comment"># 使用 | 表示 YAML 中的多行文本</span>
    <span class="attr">global:</span>                   <span class="comment"># 定义 Prometheus 的全局配置，适用于所有抓取任务（除非在具体任务中被覆盖）</span>
      <span class="attr">scrape_interval:</span> <span class="string">15s</span>    <span class="comment"># 表示 prometheus 抓取指标数据的频率，默认是 15s</span>
      <span class="attr">scrape_timeout:</span> <span class="string">15s</span>     <span class="comment"># 表示 prometheus 抓取指标数据的超时时间，默认是 15s</span>
    <span class="attr">scrape_configs:</span>
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span>  <span class="comment"># 定义任务名，这里监控 prometheus 自身</span>
      <span class="attr">static_configs:</span>
      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]
        
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx140&#x27;</span>         <span class="comment"># 10.20.1.140 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.140:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx141&#x27;</span>         <span class="comment"># 10.20.1.141 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.141:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;ingressnginx142&#x27;</span>         <span class="comment"># 10.20.1.142 Ingress-nginx 指标数据抓取</span>
      <span class="attr">static_configs:</span>
        <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;10.20.1.142:10254&#x27;</span>]
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-nodes&#x27;</span>        <span class="comment"># 基于Node自动发现节点，并抓取指标信息。Node Exporter：提供系统级指标，适合监控节点的硬件和操作系统状态（如磁盘 I/O、网络流量）。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>]    <span class="comment"># 默认抓取节点的 Kubelet 端点（端口 10250，/metrics），但这里通过 relabel_configs 修改为 Node Exporter 的端口（9100）</span>
          <span class="attr">regex:</span> <span class="string">&#x27;(.*):10250&#x27;</span>
          <span class="attr">replacement:</span> <span class="string">&#x27;$&#123;1&#125;:9100&#x27;</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">action:</span> <span class="string">replace</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-kubelet&#x27;</span>      <span class="comment"># 基于Node发现，从 Kubelet 抓取指标信息。Kubelet：提供 Kubernetes 特定指标，如 Pod 运行状态、Kubelet 的健康状况和 API 请求统计。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># k8s 自动为pod挂载的证书文件路径,在pod内部</span>
        <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># k8s 自动为pod挂载的token文件路径，在pod内部</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>                            <span class="comment"># 将 Kubernetes 节点的标签（__meta_kubernetes_node_label_&lt;key&gt;）映射为 Prometheus 指标的标签</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-cadvisor&#x27;</span>                                         <span class="comment"># 抓取任务名称为 kubernetes-cadvisor，用于监控 Kubernetes 节点的 cAdvisor 指标</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">node</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                           <span class="comment"># 指定使用 HTTPS 协议访问目标（Kubernetes API 服务器的 443 端口）</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Pod 内部的服务账号卷挂载的 CA 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌</span>
      <span class="attr">relabel_configs:</span>                                              <span class="comment"># 定义标签重写规则，修改服务发现的目标地址和路径</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                                          <span class="comment"># 规则1：将节点的标签（如 kubernetes.io/hostname）映射到 Prometheus 指标标签 </span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span>
        <span class="bullet">-</span> <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">replacement:</span> <span class="string">kubernetes.default.svc:443</span>                   <span class="comment"># 规则2：将抓取目标地址设置为 kubernetes.default.svc:443，即 Kubernetes API 服务器的 ClusterIP 服务（默认命名空间 default，端口 443）</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]              <span class="comment"># 规则3：使用节点名称（__meta_kubernetes_node_name，如 node01）动态构造指标路径</span>
          <span class="attr">regex:</span> <span class="string">(.+)</span>
          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span>
          <span class="attr">replacement:</span> <span class="string">/api/v1/nodes/$&#123;1&#125;/proxy/metrics/cadvisor</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-apiservers&#x27;</span>                             <span class="comment"># 抓取任务名称为 kubernetes-apiservers，用于监控 Kubernetes API 服务器的指标，包括请求速率、延迟、错误率等（如 apiserver_request_total, apiserver_request_duration_seconds）</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span>                                           <span class="comment"># 使用 Kubernetes 服务发现，角色为 endpoints，发现集群中的所有 Endpoints 对象</span>
      <span class="attr">scheme:</span> <span class="string">https</span>                                                 <span class="comment"># Kubernetes API 服务器默认通过 HTTPS（端口 443）暴露 /metrics 端点</span>
      <span class="attr">tls_config:</span>
        <span class="attr">ca_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/ca.crt</span>         <span class="comment"># 使用 Prometheus Pod 内部的服务账号卷挂载的 CA 证书（位于 /var/run/secrets/kubernetes.io/serviceaccount/ca.crt）验证 API 服务器的 TLS 证书</span>
      <span class="attr">bearer_token_file:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount/token</span>  <span class="comment"># 使用服务账号的 Bearer 令牌（位于 /var/run/secrets/kubernetes.io/serviceaccount/token）进行身份验证</span>
      <span class="attr">relabel_configs:</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>, <span class="string">__meta_kubernetes_service_name</span>, <span class="string">__meta_kubernetes_endpoint_port_name</span>]    <span class="comment"># 断点所在的名称空间，断点所在的 Service， 断点端口名称</span>
          <span class="attr">action:</span> <span class="string">keep</span>                      <span class="comment"># 仅保留匹配正则表达式的端点，未匹配的端点被丢弃。</span>
          <span class="attr">regex:</span> <span class="string">default;kubernetes;https</span>   <span class="comment"># 确保 Prometheus 只抓取 default 命名空间中 kubernetes 服务的 HTTPS 端点（即 API 服务器的 /metrics）</span>
          
    <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-service-endpoints&#x27;</span>        <span class="comment"># 抓取任务名称为 kubernetes-service-endpoints，用于监控 Kubernetes Service 的 Endpoints 指标。</span>
      <span class="attr">kubernetes_sd_configs:</span>
        <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">endpoints</span>                             <span class="comment"># 使用 Kubernetes 服务发现，角色为 endpoints，发现集群中所有 Service 的 Endpoints 对象</span>
      <span class="attr">relabel_configs:</span>                                <span class="comment"># 定义标签重写规则，过滤和配置服务发现的目标，确保只抓取符合条件的 Service Endpoints</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scrape</span>]
          <span class="attr">action:</span> <span class="string">keep</span>                                <span class="comment"># 仅保留注解 prometheus.io/scrape: &quot;true&quot; 的 Service Endpoints，未匹配的被丢弃</span>
          <span class="attr">regex:</span> <span class="literal">true</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_scheme</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 将匹配的值替换到 __scheme__ 标签，决定抓取协议（http 或 https），允许 Service 指定是否通过 HTTPS 抓取指标，适用于需要安全连接的场景</span>
          <span class="attr">target_label:</span> <span class="string">__scheme__</span>
          <span class="attr">regex:</span> <span class="string">(https?)</span>                             <span class="comment"># 匹配 http 或 https，若注解未设置，默认使用 http</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_annotation_prometheus_io_path</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 检查 Service 的注解 prometheus.io/path，将匹配的值替换到 __metrics_path__ 标签，指定指标端点的路径</span>
          <span class="attr">target_label:</span> <span class="string">__metrics_path__</span>
          <span class="attr">regex:</span> <span class="string">(.+)</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__address__</span>, <span class="string">__meta_kubernetes_service_annotation_prometheus_io_port</span>]
          <span class="attr">action:</span> <span class="string">replace</span>                             <span class="comment"># 将地址和端口组合替换到 __address__ 标签，允许 Service 指定抓取端口（如 prometheus.io/port: &quot;8080&quot;），覆盖 Endpoints 的默认端口</span>
          <span class="attr">target_label:</span> <span class="string">__address__</span>
          <span class="attr">regex:</span> <span class="string">([^:]+)(?::\d+)?;(\d+)</span>
          <span class="attr">replacement:</span> <span class="string">$1:$2</span>
        <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span>                            <span class="comment"># 将 Service 的标签（如 app=my-app）映射到 Prometheus 指标标签</span>
          <span class="attr">regex:</span> <span class="string">__meta_kubernetes_service_label_(.+)</span>
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_namespace</span>]      <span class="comment"># 将 Service 的命名空间（__meta_kubernetes_namespace）写入指标标签 kubernetes_namespace</span>
          <span class="attr">action:</span> <span class="string">replace</span>
          <span class="attr">target_label:</span> <span class="string">kubernetes_namespace</span>          
        <span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_service_name</span>]   <span class="comment"># 将 Service 名称（__meta_kubernetes_service_name）写入指标标签 kubernetes_name</span>
          <span class="attr">action:</span> <span class="string">replace</span>
          <span class="attr">target_label:</span> <span class="string">kubernetes_name</span>
          
    <span class="attr">alerting:</span>               <span class="comment"># 定义 Prometheus 与 Alertmanager 的连接，用于发送告警</span>
      <span class="attr">alertmanagers:</span>        <span class="comment"># 指定 Alertmanager 实例的地址</span>
        <span class="bullet">-</span> <span class="attr">static_configs:</span>
            <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;prometheus.kube-ops.svc.cluster.local:9093&quot;</span>]   <span class="comment"># &lt;service-name&gt;.&lt;namespace&gt;.svc.&lt;cluster-domain&gt;</span>
              
    <span class="attr">rule_files:</span>             <span class="comment"># 指定告警规则文件路径</span>
      <span class="bullet">-</span> <span class="string">/etc/prometheus/rules.yml</span></code></pre>



<p><strong>执行资源清单</strong></p>
<pre><code class="highlight bash"><span class="comment"># 执行资源清单，重新加载 ConfigMap</span>
$ kubectl apply -f prometheus-cm.yaml

<span class="comment">#  热更新 ConfingMap</span>
$ kubectl get svc -n kube-ops
NAME         TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)                         AGE
grafana      NodePort   10.109.7.30      &lt;none&gt;        3000:30339/TCP                  19h
prometheus   NodePort   10.102.229.198   &lt;none&gt;        9090:31676/TCP,9093:31878/TCP   44h
$ curl -X POST http://10.102.229.198:9090/-/reload</code></pre>



<p><strong>浏览器访问 Prometheus 查看告警规则是否生效</strong></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/24/20250724-162449.png" alt="查看告警规则是否生效"></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/24/20250724-205334.png" alt="AlertManager触发告警"></p>
<p><img src="https://raw.githubusercontent.com/GeorgeChan95/blogimg/master/img/2025/07/24/20250724-205424.png" alt="接收到告警邮件"></p>
<p><strong>参考链接</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhangquan.me/2022/09/04/shi-yong-prometheus-jian-kong-kubernetes-ji-qun-jie-dian/">https://zhangquan.me/2022/09/04/shi-yong-prometheus-jian-kong-kubernetes-ji-qun-jie-dian/</a></p>
<p><a target="_blank" rel="noopener" href="https://cloudmessage.top/archives/prometheus-shou-dong-pei-zhi-jian-kong-kubernetesji-qun">https://cloudmessage.top/archives/prometheus-shou-dong-pei-zhi-jian-kong-kubernetesji-qun</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cyh00001/p/16725312.html">https://www.cnblogs.com/cyh00001/p/16725312.html</a></p>
<p><a target="_blank" rel="noopener" href="https://csms.tech/202212141608/#%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF">https://csms.tech/202212141608/#%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF</a></p>
</blockquote>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 george_95@126.com </span>
    </div>
</article>





    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'f820fe811764cacedc4f',
            clientSecret: '0ce07abb65f0e79ddb8830f32029b8a9656e0ee0',
            repo: 'georgechan95.github.io',
            owner: 'GeorgeChan95',
            admin: ['GeorgeChan95'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('15',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2016-2020 George
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
    #post .pjax article :not(pre) > code {
        color: #24292e;
        font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
        background-color: rgba(27,31,35,.05);
        border-radius: 3px;
        font-size: 85%;
        margin: 0;
        padding: .2em .4em;
    }
    
</style>







</html>
